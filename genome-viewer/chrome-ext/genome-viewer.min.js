function GenomeBrowser(){this.genomeViewer=new MasterSlaveGenomeViewer("id","container_map");this.karyotypeWidget=new KaryotypePanel("human","container_map_karyotype",{width:1E3,height:200,trackWidth:15})}
GenomeBrowser.prototype.draw=function(){var a=Ext.create("Ext.panel.Panel",{width:"1300",margins:"5 5 5 5",flex:3,html:'<div id = "container_map"></div>'}),b=Ext.create("Ext.panel.Panel",{width:"1300",margins:"5 5 5 5",html:'<div id = "coordinates"><form><label >Location:&nbsp;&nbsp;</label><input type="hidden" name="db" value="core"><input name="r" id="loc_r" class="location_selector" style="width:250px" value="6:133017695-133161157" type="text">&nbsp;&nbsp;<input value="Go" type="submit" class="go-button"></form></div>'}),c=
Ext.create("Ext.panel.Panel",{title:"bot",width:"100%",flex:1,split:!0,html:'<div id = "container_map_karyotype" style="padding:0 0 0 200;text-align: center;width:100%;" ></div>'}),d=function(a){"ZoomIn"==a&&genomeViewer.zoomIn();"ZoomOut"==a&&genomeViewer.zoomOut()},d=Ext.create("Ext.toolbar.Toolbar",{width:"100%",items:[{text:"Zoom In",iconCls:"add16",handler:Ext.Function.pass(d,"ZoomIn")},{text:"Zoom Out",iconCls:"add16",handler:Ext.Function.pass(d,"ZoomOut")}]}),a=Ext.create("Ext.panel.Panel",
{layout:"vbox",region:"center",margins:5,items:[d,a,b,c]}),b=Ext.create("Ext.Panel",{title:"Control",html:"&lt;empty panel&gt;",cls:"empty"}),c=Ext.create("Ext.Panel",{title:"Accordion Item 3",html:"&lt;empty panel&gt;",cls:"empty"}),d=Ext.create("Ext.Panel",{title:"Accordion Item 4",html:"&lt;empty panel&gt;",cls:"empty"}),e=Ext.create("Ext.Panel",{title:"Accordion Item 5",html:"&lt;empty panel&gt;",cls:"empty"}),b=Ext.create("Ext.panel.Panel",{region:"west",width:200,margins:"5 5 5 5",split:!0,
width:210,layout:"accordion",items:[b,c,d,e]});Ext.create("Ext.container.Viewport",{layout:"border",items:[a,b]});this.genomeViewer.draw(1,25E6);this.karyotypeWidget.getFromCellBase()};
function GenomeViewer(a,b,c){var d=this;this.id="GenomeViewer#"+Math.round(1E4*Math.random())+"#";this.menuBar=null;this.width=$(document).width();this.height=$(document).height();this.targetId=null;this.species="hsa";this.speciesName="Homo sapiens";null!=a&&(this.targetId=a);null!=b&&(this.species=b.species,this.speciesName=b.name);null!=c&&(null!=c.description&&(c.description="beta"),null!=c.menuBar&&(this.menuBar=c.menuBar),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),
null!=c.pluginsMenu&&(this.pluginsMenu=c.pluginsMenu));this.onSpeciesChange=new Event;console.log(this.width+"x"+this.height);console.log(this.targetId);console.log(this.id);this.genomeWidget=null;this.genomeWidgetProperties=new GenomeWidgetProperties(this.species,{windowSize:1E6,pixelRatio:5.0E-4,id:this.id});this.onSpeciesChange.addEventListener(function(a,b){d.species=b.species;d.speciesName=b.name;Ext.getCmp(d.id+"speciesMenuButton").setText(d.speciesName);Ext.example.msg("Species",d.speciesName+
" selected.");Ext.getCmp(d.id+"chromosomeMenuButton").menu=d._getChromosomeMenu();d.genomeWidgetProperties=new GenomeWidgetProperties(d.species,{windowSize:1E6,pixelRatio:5.0E-4,id:d.id});null!=d.targetId&&d.draw()});this.customTracksAddedCount=1;$(window).resize(function(){});this.chromosome=13;this.position=32889611}GenomeViewer.prototype.setMenuBar=function(a){this.menuBar=a};
GenomeViewer.prototype.draw=function(){null!=this.targetId&&this._getPanel(this.width,this.height);this._render(this.chromosome,this.position)};GenomeViewer.prototype._render=function(a,b){this.chromosome=a;this.position=b;var c=this.position-this.genomeWidgetProperties.windowSize,d=this.position+this.genomeWidgetProperties.windowSize;this._drawMasterGenomeViewer(this.chromosome,c,d);this.drawChromosome(a,c,d);this._setScaleLabels()};
GenomeViewer.prototype._getPanel=function(a,b){if(null==this._panel){var c=[];null!=this.menuBar&&c.push(this.menuBar);c.push(this._getNavigationBar());c.push(this._getChromosomePanel());c.push(this._getWindowSizePanel());c.push(this._getTracksPanel());c.push(this._getBottomBar());this._panel=Ext.create("Ext.panel.Panel",{renderTo:this.targetId,border:!1,width:a,height:b,cls:"x-unselectable",layout:{type:"vbox",align:"stretch"},region:"center",margins:"0 0 0 0",border:!1,items:c})}return this._panel};
GenomeViewer.prototype.setSize=function(a,b){500>a&&(a=500);2400<a&&(a=2400);this.width=a;this.height=b;this._getPanel().setSize(a,b);this.draw()};GenomeViewer.prototype._getSpeciesMenu=function(){null==this._specieMenu&&(this._specieMenu=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[]}));return this._specieMenu};
GenomeViewer.prototype.setSpecieMenu=function(a){var b=this,c=this._getSpeciesMenu();c.hide();c.removeAll();for(var d=0;d<a.length;d++)c.add({text:a[d].name,species:a[d].species,handler:function(a){b.setSpecie({name:a.text,species:a.species})}})};GenomeViewer.prototype.setSpecie=function(a){this.onSpeciesChange.notify(a)};
GenomeViewer.prototype._getChromosomeMenu=function(){var a=this,b=Ext.create("Ext.data.Store",{fields:["name"],autoLoad:!1}),c=Ext.create("Ext.view.View",{store:b,selModel:{mode:"SINGLE",listeners:{selectionchange:function(b,c){a.setChromosome(c[0].data.name);d.hide()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".chromosome-item",tpl:'<tpl for="."><div style="float:left" class="chromosome-item">{name}</div></tpl>'}),c=Ext.create("Ext.container.Container",{width:125,autoScroll:!0,
style:"background-color:#fff",items:[c]}),d=Ext.create("Ext.menu.Menu",{almacen:b,items:[c]}),e=new KaryotypeCellBaseDataAdapter(this.species);e.successed.addEventListener(function(){for(var a=[],c=0;c<e.chromosomeNames.length;c++)a.push({name:e.chromosomeNames[c]});b.loadData(a)});e.fill();return d};
GenomeViewer.prototype._showKaryotypeWindow=function(){var a=this,b=new KaryotypePanelWindow(this.species,{genomeViewer:this});b.onRendered.addEventListener(function(){b.select(a.chromosome,a.position,a.position)});b.onMarkerChanged.addEventListener(function(b,d){a.setLocation(d.chromosome,d.start)});b.draw()};
GenomeViewer.prototype._getZoomSlider=function(){var a=this;null==this._zoomSlider&&(this._zoomSlider=Ext.create("Ext.slider.Single",{id:this.id+" zoomSlider",width:200,minValue:0,hideLabel:!1,maxValue:100,value:a.genomeWidgetProperties.getZoom(),useTips:!0,increment:10,tipText:function(a){return Ext.String.format("<b>{0}%</b>",a.value)}}),this._zoomSlider.on("changecomplete",function(b,c){a._handleNavigationBar("ZOOM",c)}));return this._zoomSlider};
GenomeViewer.prototype._handleNavigationBar=function(a,b){"OptionMenuClick"==a&&(this.genomeWidget.showTranscripts=Ext.getCmp("showTranscriptCB").checked,this.genomeWidgetProperties.setShowTranscripts(Ext.getCmp("showTranscriptCB").checked),this.refreshMasterGenomeViewer());"ZOOM"==a&&this.setZoom(b);"GoToGene"==a&&this.openGeneListWidget(Ext.getCmp(this.id+"tbGene").getValue());if("+"==a){var c=this.genomeWidgetProperties.getZoom();100>c&&this.setZoom(c+10)}"-"==a&&(c=this.genomeWidgetProperties.getZoom(),
10<=c&&this.setZoom(c-10));if("Go"==a){var c=Ext.getCmp(this.id+"tbCoordinate").getValue(),d=c.split(":")[1];this.chromosome=c.split(":")[0];this.setLocation(this.chromosome,d)}"<"==a&&(Ext.getCmp(this.id+"tbCoordinate").getValue(),this.setLocation(this.chromosome,this.position-this.genomeWidgetProperties.windowSize/2));">"==a&&(Ext.getCmp(this.id+"tbCoordinate").getValue(),this.setLocation(this.chromosome,this.position+this.genomeWidgetProperties.windowSize/2))};
GenomeViewer.prototype._getNavigationBar=function(){var a=this;return Ext.create("Ext.toolbar.Toolbar",{cls:"bio-toolbar",height:35,border:0,items:[{id:this.id+"speciesMenuButton",text:this.speciesName,menu:this._getSpeciesMenu()},{id:this.id+"chromosomeMenuButton",text:"Chromosome",menu:this._getChromosomeMenu()},{text:"Karyotype",handler:function(){a._showKaryotypeWindow()}},{text:"<",margin:"0 0 0 15",handler:function(){a._handleNavigationBar("<")}},{margin:"0 0 0 5",iconCls:"icon-zoom-out",handler:function(){a._handleNavigationBar("-")}},
this._getZoomSlider(),{margin:"0 5 0 0",iconCls:"icon-zoom-in",handler:function(){a._handleNavigationBar("+")}},{text:">",handler:function(){a._handleNavigationBar(">")}},"->",{xtype:"label",text:"Position:",margins:"0 0 0 10"},{xtype:"textfield",id:this.id+"tbCoordinate",text:this.chromosome+":"+this.position,listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("Go")}}},{text:"Go",handler:function(){a._handleNavigationBar("Go")}},{xtype:"label",text:"Search:",margins:"0 0 0 10"},
{xtype:"textfield",id:this.id+"tbGene",emptyText:"gene, protein, transcript",name:"field1",listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("GoToGene")}}},{text:"Go",handler:function(){a._handleNavigationBar("GoToGene")}}]})};GenomeViewer.prototype.setChromosome=function(a){this.setLocation(a,this.position);this._setChromosomeLabel(a)};
GenomeViewer.prototype._setChromosomeLabel=function(a){document.getElementById(this._getChromosomeLabelID()).innerHTML="Chromosome&nbsp;"+a;Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+a)};GenomeViewer.prototype._getChromosomeContainerID=function(){return this.id+"container_map_one_chromosome"};GenomeViewer.prototype._getChromosomeLabelID=function(){return this.id+"chromosome_label_id"};
GenomeViewer.prototype._getChromosomePanel=function(){var a=Ext.create("Ext.container.Container",{id:this._getChromosomeLabelID(),margin:5}),b=Ext.create("Ext.container.Container",{id:this._getChromosomeContainerID(),margin:10});return Ext.create("Ext.container.Container",{height:70,layout:{type:"table",columns:2},items:[a,b]})};
GenomeViewer.prototype._getWindowSizePanel=function(){var a=Ext.create("Ext.toolbar.TextItem",{id:this.id+"windowSizeLabel",text:"window Size"});return Ext.create("Ext.container.Container",{style:"text-align:center;",height:20,items:a})};GenomeViewer.prototype._getTracksPanelID=function(){return this.id+"master"};
GenomeViewer.prototype._getTracksPanel=function(){null==this._mainPanel&&(this._mainPanel=Ext.create("Ext.panel.Panel",{autoScroll:!0,flex:1,border:!1,html:'<div height=2000px; overflow-y="scroll"; id = "'+this._getTracksPanelID()+'"></div>'}));return this._mainPanel};
GenomeViewer.prototype._getBottomBar=function(){var a=new GeneFeatureFormatter,b=new SNPFeatureFormatter,c=new LegendPanel({title:"Gene legend"}),d=new LegendPanel({title:"SNP legend"}),e=Ext.create("Ext.draw.Component",{id:this.id+"scaleLabel",width:100,height:20,items:[{type:"text",text:"Scale number",fill:"#000000",x:10,y:5,width:5,height:20},{type:"rect",fill:"#000000",x:0,y:0,width:2,height:20},{type:"rect",fill:"#000000",x:2,y:12,width:100,height:3},{type:"rect",fill:"#000000",x:101,y:0,width:2,
height:20}]}),f=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"uxTaskbar",winMgr:new Ext.ZIndexManager,enableOverflow:!0,cls:"bio-hiddenbar",height:28,flex:1}),a=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-hiddenbar",width:300,height:28,items:[e,"-",c.getButton(a.getBioTypeColors()),d.getButton(b.getBioTypeColors()),"->"]});return Ext.create("Ext.container.Container",{layout:"hbox",cls:"bio-botbar x-unselectable",height:30,items:[f,a]})};
GenomeViewer.prototype.openListWidget=function(a,b,c,d,e,f){var g=this,h=new CellBaseDataAdapter(this.species);h.successed.addEventListener(function(){var a=new GenomicListWidget({title:e,gridFields:f,genomeViewer:g});a.draw(h.dataset.toJSON(),c);a.onSelected.addEventListener(function(a,b){null!=b&&null!=b.chromosome&&g.setLocation(b.chromosome,b.start)});a.onTrackAddAction.addEventListener(function(a,b){null!=b&&g.addTrackFromFeatures(b)})});h.fill(a,b,c,d)};
GenomeViewer.prototype.openGeneListWidget=function(a){this.openListWidget("feature","gene",a.toString(),"info","Gene List")};GenomeViewer.prototype.openTranscriptListWidget=function(a){this.openListWidget("feature","transcript",a.toString(),"info","Transcript List","externalName,stableId,biotype,chromosome,start,end,strand,description".split(","))};
GenomeViewer.prototype.openExonListWidget=function(a){var b=this,c=new CellBaseDataAdapter(this.species);c.successed.addEventListener(function(){var d=new GenomicListWidget({title:"Exon List",gridFields:["stableId","chromosome","start","end","strand"]}),e=[];e.push(c.dataset.toJSON());d.draw(e,a);d.onSelected.addEventListener(function(a,c){null!=c&&null!=c.chromosome&&b.setLocation(c.chromosome,c.start)})});c.fill("feature","exon",a.toString(),"info")};
GenomeViewer.prototype.openSNPListWidget=function(a){this.openListWidget("feature","snp",a.toString(),"info","SNP List","name,variantAlleles,ancestralAllele,mapWeight,position,sequence".split(","))};GenomeViewer.prototype.openGOListWidget=function(a){var b=this,c=new CellBaseDataAdapter(this.species);c.successed.addEventListener(function(){for(var a=[],e=0;e<c.dataset.toJSON()[0].length;e++)a.push(c.dataset.toJSON()[0][e].displayId);b.openGeneListWidget(a)});c.fill("feature","id",a.toString(),"xref?dbname=ensembl_gene&")};
GenomeViewer.prototype.drawChromosome=function(a){this._setChromosomeLabel(a);DOM.removeChilds(this._getChromosomeContainerID());var b=this.width-100;this.chromosomeFeatureTrack=new ChromosomeFeatureTrack(this.id+"chr",document.getElementById(this._getChromosomeContainerID()),this.species,{top:5,bottom:20,left:10,right:b-100,width:b,height:40,label:!0,vertical:!1,rounded:4});var c=this,d=new RegionCellBaseDataAdapter(this.species,{resource:"cytoband"});d.successed.addEventListener(function(){c.chromosomeFeatureTrack.draw(d.dataset);
c.chromosomeFeatureTrack.click.addEventListener(function(a,b){c.setLocation(c.chromosome,b)})});d.fill(a,1,26E7,"cytoband")};GenomeViewer.prototype._setScaleLabels=function(){var a=Math.floor(100/this.genomeWidgetProperties.getPixelRatio())+" nt ";Ext.getCmp(this.id+"scaleLabel").surface.items.items[0].setAttributes({text:a},!0);a="Viewing "+10*Math.floor(100/this.genomeWidgetProperties.getPixelRatio())+" nts ";Ext.getCmp(this.id+"windowSizeLabel").setText(a)};
GenomeViewer.prototype.setZoom=function(a){this.genomeWidgetProperties.setZoom(a);this.position=this.genomeWidget.getMiddlePoint();this._getZoomSlider().setValue(a);this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.genomeWidgetProperties.getPixelRatio());this._setScaleLabels();this.refreshMasterGenomeViewer()};
GenomeViewer.prototype.setLocation=function(a,b){this.chromosome=a;this.position=Math.ceil(b);this.refreshMasterGenomeViewer();this.drawChromosome(this.chromosome,1,26E6)};GenomeViewer.prototype._setPositionField=function(a,b){NaN==b&&(b=1E6);0>b?Ext.getCmp(this.id+"tbCoordinate").setValue(a+":0"):Ext.getCmp(this.id+"tbCoordinate").setValue(a+":"+Math.ceil(b))};
GenomeViewer.prototype.refreshMasterGenomeViewer=function(){this.genomeWidget.clear();this.updateRegionMarked(this.chromosome,this.position);this._drawMasterGenomeViewer()};GenomeViewer.prototype._getWindowsSize=function(){return this.genomeWidgetProperties.getWindowSize(this.genomeWidgetProperties.getZoom())};
GenomeViewer.prototype._drawMasterGenomeViewer=function(){var a=this;this._getPanel().setLoading("Retrieving data");this.genomeWidget=new GenomeWidget(this.id+"master",this._getTracksPanelID(),{pixelRatio:this.genomeWidgetProperties.getPixelRatio(),width:this.width-15,height:2E3});var b=this.genomeWidgetProperties.getZoom();if(0<this.genomeWidgetProperties.getTrackByZoom(b).length){for(var c=0;c<this.genomeWidgetProperties.getTrackByZoom(b).length;c++){var d=this.genomeWidgetProperties.getTrackByZoom(b)[c];
d.top=d.originalTop;d.height=d.originalHeight;d.clear();this.genomeWidgetProperties.getDataAdapterByZoom(b)[c].datasets={};this.genomeWidget.addTrack(d,this.genomeWidgetProperties.getDataAdapterByZoom(b)[c])}b=Math.ceil(this.position-this._getWindowsSize());c=Math.ceil(this.position+this._getWindowsSize());0>b&&(b=0);this.genomeWidget.onMarkerChange.addEventListener(function(b,c){a.updateRegionMarked(a.chromosome,c.middle)});this.genomeWidget.onRender.addEventListener(function(){a._getPanel().setLoading(!1);
a.genomeWidget.trackCanvas.selectPaintOnRules(a.position)});this._setPositionField(this.chromosome,this.position);this.genomeWidget.draw(this.chromosome,b,c)}else a._getPanel().setLoading("No tracks to display")};GenomeViewer.prototype.updateRegionMarked=function(a,b){var c=this.genomeWidgetProperties.windowSize/2,d=b-c;0>d&&(d=0);this.chromosomeFeatureTrack.select(d,b+c)};
GenomeViewer.prototype.loadDASTrack=function(a,b){if(void 0==this.genomeWidgetProperties.tracks[a]){var c=new DasRegionDataAdapter({url:b});this.genomeWidgetProperties.addCustomTrackByZoom(0,50,new FeatureTrack("vcf",null,this.species,{top:10,left:0,height:10,title:a,opacity:0.9,titleFontSize:9,forceColor:"purple",label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:100,allowDuplicates:!0,backgroundColor:"#FCFFFF",isAvalaible:!1}),c);this.genomeWidgetProperties.addCustomTrackByZoom(60,100,new FeatureTrack("vcf",
null,this.species,{top:10,left:0,height:10,title:a,titleFontSize:9,forceColor:"#000000",label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:100,allowDuplicates:!0,backgroundColor:"#FCFFFF",isAvalaible:!1}),c)}};
GenomeViewer.prototype.addFeatureTrack=function(a,b){this._getPanel().setLoading();if(null!=b){this.genomeWidgetProperties.addCustomTrackByZoom(0,0,new HistogramFeatureTrack("vcf",null,this.species,{top:20,left:0,height:20,featureHeight:18,title:a,titleFontSize:9,titleWidth:70,label:!1,forceColor:"purple",intervalSize:5E5}),b);this.genomeWidgetProperties.addCustomTrackByZoom(10,20,new HistogramFeatureTrack("vcf",null,this.species,{top:20,left:0,height:20,featureHeight:18,title:a,titleFontSize:9,titleWidth:70,
label:!1,forceColor:"purple",intervalSize:15E4}),b);var c=new FeatureTrack("vcf",null,this.species,{top:10,left:0,height:10,title:a,label:!1,avoidOverlapping:!0,pixelSpaceBetweenBlocks:1,allowDuplicates:!0});this.genomeWidgetProperties.addCustomTrackByZoom(30,80,c,b);c=new FeatureTrack("vcf",null,this.species,{top:10,left:0,height:10,title:a,label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:75,allowDuplicates:!0});this.genomeWidgetProperties.addCustomTrackByZoom(90,90,c,b);this.genomeWidgetProperties.addCustomTrackByZoom(100,
100,new SNPFeatureTrack("vcf",null,this.species,{top:10,left:0,height:20,title:a,featureHeight:10,label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:75,allowDuplicates:!0}),b);this._drawMasterGenomeViewer()}};GenomeViewer.prototype.addTrackFromFeatures=function(a,b){var c=new LocalRegionDataAdapter;c.loadFromFeatures(a);null==b&&(b="");this.addFeatureTrack(b.substr(0,20)+" #"+this.customTracksAddedCount,c);this.customTracksAddedCount++};
GenomeViewer.prototype.addTrackFromFeaturesList=function(a){for(var b=[],c=0;c<a.features.length;c++)for(var d=0;d<a.features[c].length;d++)b.push(a.features[c][d]);this.addTrackFromFeatures(b,a.trackName)};VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;VCFFileWidget.prototype.draw=FileWidget.prototype.draw;VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;
VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;function VCFFileWidget(a){null==a&&(a={});a.title="VCF";a.tags=["vcf"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget;this.chartWidgetQuality=new ChartWidget({height:300})}VCFFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"]),this.chartWidgetQuality.getChart(["features","quality"])]};
VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=new VCFFileDataAdapter;this._fileLoad(b);b.loadFromFile(a)};
VCFFileWidget.prototype._fileLoad=function(a){var b=this;a.onRead.addEventListener(function(a){b.dataAdapter=new VCFLocalRegionDataAdapter;b.dataAdapter.loadFromFileDataAdapter(a);var a=[],d;for(d in b.dataAdapter.featuresByChromosome)a.push({features:b.dataAdapter.featuresByChromosome[d].length,chromosome:d});d=[];for(var e in b.dataAdapter.qualitycontrol)d.push({features:b.dataAdapter.qualitycontrol[e],quality:e});b.chartWidgetByChromosome.getStore().loadData(a);b.chartWidgetQuality.getStore().loadData(d);
b.panel.setLoading(!1);b.featureCountLabel.setText("Features count: "+b.dataAdapter.features.length,!1);b.btnOk.enable()})};VCFFileWidget.prototype.loadFileFromServer=function(a){var b=new VCFFileDataAdapter;this._fileLoad(b);b.loadFromContent(a.data)};SIFNetworkFileWidget.prototype.draw=NetworkFileWidget.prototype.draw;function SIFNetworkFileWidget(a){null==a&&(a={});a.title="Import a Network SIF file";NetworkFileWidget.prototype.constructor.call(this,a)}
SIFNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"SIF network file",flex:1,buttonText:"Browse local",listeners:{change:function(){var b=new InteractomeSIFFileDataAdapter,c=document.getElementById(a.fileUpload.fileInputEl.id).files[0];b.loadFromFile(c);b.onRead.addEventListener(function(b){try{a.content=b;var c=b.dataset.getVerticesCount(),f=b.dataset.getEdgesCount(),g=(new SIFFileDataAdapter).toSIF(b.dataset),
h=new TabularFileDataAdapter;h.parse(g);a.gridStore.loadData(h.getLines());a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1);a.countLabel.setText('vertices:<span class="info">'+c+'</span> edges:<span class="info">'+f+"</span>",!1)}catch(i){a.infoLabel.setText('<span class="err">File not valid </span>'+i,!1)}})}}})};
function FileWidget(a){var b=this;this.targetId=null;this.id="FileWidget_"+Math.round(1E5*Math.random());this.wum=!0;this.tags=[];this.args=a;null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title,this.id=this.title+this.id),null!=a.wum&&(this.wum=a.wum),null!=a.tags&&(this.tags=a.tags));this.dataAdapter=null;this.onOk=new Event(this);this.browserData=new BrowserDataWidget;this.browserData.onSelect.addEventListener(function(a,d){b.trackNameField.setValue(d.filename);
b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.panel.setLoading()});this.browserData.adapter.onReadData.addEventListener(function(a,d){b.trackNameField.setValue(d.filename);b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.loadFileFromServer(d)})}FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()};FileWidget.prototype.getFileFromServer=function(){};
FileWidget.prototype.loadFileFromLocal=function(){};FileWidget.prototype.getChartItems=function(){return[]};
FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.fileName);a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1);a.loadFileFromLocal(b)}}}})};
FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{html:'<span class="dis">No file loaded</span>'});b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add(this.getFileUpload());this.panel=Ext.create("Ext.panel.Panel",{border:!1,cls:"panel-border-top panel-border-bottom",title:"Previsualization",items:this.getChartItems(),bbar:b});
this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});b=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,handler:function(){a.browserData.draw($.cookie("bioinfo_sid"),a.tags)}}),c.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?this.sessionInitiated():
this.sessionFinished());this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{html:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'});c.add(["->",this.fileNameLabel]);this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.onOk.notify({title:a.getTitleName(),dataAdapter:a.dataAdapter});a.openDialog.close()}});this.openDialog=Ext.create("Ext.ux.Window",{title:"Open "+this.title+" file",
taskbar:Ext.getCmp(this.args.genomeViewer.id+"uxTaskbar"),width:800,resizable:!1,items:[c,this.panel,b],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()};FileWidget.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};FileWidget.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GFFFileWidget.prototype.draw=FileWidget.prototype.draw;GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;
function GFFFileWidget(a){null==a&&(a={});a.title="GFF";a.tags=["gff"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget}GFFFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=new GFFFileDataAdapter;this._fileLoad(b);b.loadFromFile(a)};
GFFFileWidget.prototype._fileLoad=function(a){var b=this;a.onRead.addEventListener(function(a){b.dataAdapter=new GFFLocalRegionDataAdapter;b.dataAdapter.loadFromFileDataAdapter(a);var a=[],d;for(d in b.dataAdapter.featuresByChromosome)a.push({features:b.dataAdapter.featuresByChromosome[d].length,chromosome:d});b.chartWidgetByChromosome.getStore().loadData(a);b.panel.setLoading(!1);b.featureCountLabel.setText("Features count: "+b.dataAdapter.features.length,!1);b.btnOk.enable()})};
GFFFileWidget.prototype.loadFileFromServer=function(a){var b=new GFFFileDataAdapter;this._fileLoad(b);b.loadFromContent(a.data)};BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;BEDFileWidget.prototype.draw=FileWidget.prototype.draw;BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;
function BEDFileWidget(a){null==a&&(a={});a.title="BED";a.tags=["bed"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget}BEDFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=new BEDFileDataAdapter;this._fileLoad(b);b.loadFromFile(a)};
BEDFileWidget.prototype._fileLoad=function(a){var b=this;a.onRead.addEventListener(function(a){b.dataAdapter=new BEDLocalRegionDataAdapter;b.dataAdapter.loadFromFileDataAdapter(a);var a=[],d;for(d in b.dataAdapter.featuresByChromosome)a.push({features:b.dataAdapter.featuresByChromosome[d].length,chromosome:d});b.chartWidgetByChromosome.getStore().loadData(a);b.panel.setLoading(!1);b.featureCountLabel.setText("Features count: "+b.dataAdapter.features.length,!1);b.btnOk.enable()})};
BEDFileWidget.prototype.loadFileFromServer=function(a){var b=new BEDFileDataAdapter;this._fileLoad(b);b.loadFromContent(a.data)};
function NetworkFileWidget(a){this.targetId=null;this.id="NetworkFileWidget-"+Math.round(1E7*Math.random());this.title="Open a Network JSON file";this.width=600;this.height=300;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.dataAdapter=null;this.onOk=new Event(this);this.previewId=this.id+"-preview"}
NetworkFileWidget.prototype.getTitleName=function(){return Ext.getCmp(this.id+"_title").getValue()};
NetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"JSON network file",flex:1,buttonText:"Browse local",listeners:{change:function(){var b=new FileDataAdapter,c=document.getElementById(a.fileUpload.fileInputEl.id).files[0];b.read(c);b.onRead.addEventListener(function(b,c){try{a.content=c.content;var f=JSON.parse(c.content),g=new GraphDataset;g.loadFromJSON(f.dataset);var h=g.getVerticesCount(),
i=g.getEdgesCount(),k=(new SIFFileDataAdapter).toSIF(g),j=new TabularFileDataAdapter;j.parse(k);a.gridStore.loadData(j.getLines());a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1);a.countLabel.setText('vertices:<span class="info">'+h+'</span> edges:<span class="info">'+i+"</span>",!1)}catch(l){a.infoLabel.setText('<span class="err">File not valid </span>'+l,!1)}})}}})};
NetworkFileWidget.prototype.draw=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});b.add(this.getFileUpload());this.infoLabel=Ext.create("Ext.toolbar.TextItem",{html:"Please select a network saved File"});this.countLabel=Ext.create("Ext.toolbar.TextItem");var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add([this.infoLabel,"->",this.countLabel]);this.gridStore=Ext.create("Ext.data.Store",{fields:["0","1","2"]});this.grid=
Ext.create("Ext.grid.Panel",{border:!1,flex:1,store:this.gridStore,columns:[{header:"Node",dataIndex:"0",flex:1},{header:"Node",dataIndex:"1",flex:1},{header:"Node",dataIndex:"2",flex:1}],features:[{ftype:"grouping"}],tbar:b,bbar:c});this.panel=Ext.create("Ext.window.Window",{title:this.title,width:this.width,height:this.height,resizable:!1,layout:{type:"vbox",align:"stretch"},items:[this.grid],buttons:[{text:"Ok",handler:function(){a.onOk.notify(a.content);a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],
listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show()};function UrlWidget(a){this.id="UrlWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.title="Custom url";this.width=500;this.height=400;null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.onAdd=new Event(this)}
UrlWidget.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,flex:1,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}});this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasRegionDataAdapter({url:a.urlField.getValue()});
b.successed.addEventListener(function(){a.contentArea.setValue(b.xml);a.form.setLoading(!1)});b.onError.addEventListener(function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin");a.form.setLoading(!1)});b.fill(1,1,1)}});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",flex:1});this.panelSettings=Ext.create("Ext.panel.Panel",
{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,items:[this.trackNameField]});this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height});this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false"});this.infobar.add(this.urlField);this.infobar.add(this.checkButton);this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,this.panelSettings]});this.panel=Ext.create("Ext.ux.Window",
{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.onAdd.notify({name:a.trackNameField.getValue(),url:a.urlField.getValue()});a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})};
function MasterSlaveGenomeViewer(a,b,c){this.targetId=b;this.id=a+Math.random();this.width=1300;this.masterHeight=this.slaveHeight=this.height=700;this.masterWindowSize=1E6;null!=c&&(null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),null!=c.masterHeight&&(this.masterHeight=c.height),null!=c.slaveHeight&&(this.slaveHeight=c.height));this.pixelRatio=5.0E-4;this.zoomLevels=[];for(a=1;10>=a;a++)this.zoomLevels[a]=this.pixelRatio*2*a;this.zoomLevels[0.1]=this.pixelRatio;this.genomeWidget=
null;this.markerChanged=new Event(this)}MasterSlaveGenomeViewer.prototype.getZoomFactor=function(a){return this.zoomLevels[a/10]};MasterSlaveGenomeViewer.prototype.getMasterId=function(){return this.id+"_master"};MasterSlaveGenomeViewer.prototype.getSlaveId=function(){return this.id+"_slave"};MasterSlaveGenomeViewer.prototype.getMasterStart=function(){return this.position-this.masterWindowSize};MasterSlaveGenomeViewer.prototype.getMasterEnd=function(){return this.position+this.masterWindowSize};
MasterSlaveGenomeViewer.prototype.init=function(){};MasterSlaveGenomeViewer.prototype.goTo=function(a,b){this.clear();this.chromosome=a;this.position=b;this._drawMaster();this._drawSlave(this.position)};MasterSlaveGenomeViewer.prototype.zoomIn=function(){this.position=this.genomeWidget.trackCanvas.getMiddlePoint();this.pixelRatio*=1.5;this.clear();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.pixelRatio);console.log("PIXEL RATIO "+this.pixelRatio)};
MasterSlaveGenomeViewer.prototype.zoom=function(a){this.pixelRatio=50<a?this.pixelRatio*1.5*(a/4/10):this.pixelRatio/(1.5*(a/4/10));this.pixelRatio=this.getZoomFactor(a);this.position=this.genomeWidget.trackCanvas.getMiddlePoint();this.clear();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.pixelRatio)};
MasterSlaveGenomeViewer.prototype.zoomOut=function(){this.position=this.genomeWidget.trackCanvas.getMiddlePoint();this.pixelRatio/=1.5;this.clear();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.pixelRatio);console.log("PIXEL RATIO "+this.pixelRatio)};MasterSlaveGenomeViewer.prototype.clear=function(){this.genomeWidget.clear();this._drawMaster()};
MasterSlaveGenomeViewer.prototype._createMaster=function(){var a=new GenomeWidget(this.id+"master",this.getMasterId(),{pixelRatio:this.pixelRatio,width:this.width,height:this.height,showTranscripts:this.showTranscripts,showExons:this.showExons,showSNPTrack:this.showSNPTrack});if(null!=this.genomeWidget){a.trackList=this.genomeWidget.trackList;a.dataAdapterList=this.genomeWidget.dataAdapterList;for(var b=0;b<a.dataAdapterList.length;b++)a.dataAdapterList.preloadSuccess=new Event,a.dataAdapterList.successed=
new Event}return a};MasterSlaveGenomeViewer.prototype._drawMaster=function(){this.genomeWidget=this._createMaster();this.genomeWidget.draw(this.chromosome,this.getMasterStart(),this.getMasterEnd());this._attachMasterEvents()};MasterSlaveGenomeViewer.prototype._attachMasterEvents=function(){var a=this;this.genomeWidget.onClick.addEventListener(function(){});this.genomeWidget.markerChanged.addEventListener(function(b,c){a.updateSlave(c);a.chromosome=a.genomeWidget.chromosome;a.position=c;a.markerChanged.notify()})};
MasterSlaveGenomeViewer.prototype.addTrackMaster=function(a,b){this.genomeWidget=this._createMaster();this.genomeWidget.addTrack(a,b);this._attachMasterEvents()};MasterSlaveGenomeViewer.prototype._drawSlave=function(a){DOM.removeChilds(this.getSlaveId());this.detailViewer=new SequenceGenomeWidget(this.id+"detail",this.getSlaveId(),{width:this.width});this.detailViewer.draw(this.chromosome,a-100,a+100)};
MasterSlaveGenomeViewer.prototype.draw=function(a,b){this.chromosome=a;this.position=b;this.init();this._drawMaster();this._drawSlave(this.position)};MasterSlaveGenomeViewer.prototype.updateSlave=function(a){this._drawSlave(a);this.detailViewer.trackCanvas._goToCoordinateX(a-this.detailViewer.trackCanvas.width/this.detailViewer.trackCanvas.pixelRatio/2)};
function KaryotypePanelWindow(a,b){var c=this;this.id="KaryotypePanelWindow_"+Math.random();this.karyotypeWidget=new KaryotypePanel(this.getKaryotypePanelId(),a,{top:10,width:1E3,height:300,trackWidth:15});this.karyotypeCellBaseDataAdapter=new KaryotypeCellBaseDataAdapter(a);this.args=b;this.onRendered=new Event;this.onMarkerChanged=new Event;this.karyotypeCellBaseDataAdapter.successed.addEventListener(function(){c.karyotypeWidget.onRendered.addEventListener(function(){c.onRendered.notify()});c.karyotypeWidget.onClick.addEventListener(function(a,
b){c.onMarkerChanged.notify(b)});c.karyotypeWidget.draw(c.karyotypeCellBaseDataAdapter.chromosomeNames,c.karyotypeCellBaseDataAdapter.dataset.json)})}KaryotypePanelWindow.prototype.select=function(a,b,c){this.karyotypeWidget.select(a,b,c)};KaryotypePanelWindow.prototype.mark=function(a){this.karyotypeWidget.mark(a)};KaryotypePanelWindow.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
KaryotypePanelWindow.prototype.getKaryotypePanel=function(){if(null==this.karyotypePanel){var a=Ext.create("Ext.toolbar.TextItem",{html:'<span class="dis">Click on chromosome to go</span>'}),b=Ext.create("Ext.toolbar.Toolbar",{dock:"top"});b.add(a);this.karyotypePanel=Ext.create("Ext.panel.Panel",{height:350,maxHeight:350,border:!1,bodyPadding:15,padding:"0 0 0 0",html:'<div id="'+this.getKaryotypePanelId()+'" ><div>',dockedItems:[b]})}return this.karyotypePanel};
KaryotypePanelWindow.prototype.render=function(){var a=this;this.panel=Ext.create("Ext.ux.Window",{title:"Karyotype",resizable:!1,taskbar:Ext.getCmp(this.args.genomeViewer.id+"uxTaskbar"),constrain:!0,animCollapse:!0,width:1050,height:412,minWidth:300,minHeight:200,layout:"fit",items:[this.getKaryotypePanel()],buttonAlign:"center",buttons:[{text:"Close",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}});this.karyotypeCellBaseDataAdapter.fill()};
KaryotypePanelWindow.prototype.getKaryotypePanelId=function(){return this.id+"_karyotypePanel"};function KaryotypePanel(a,b,c){this.id=a+Math.round(1E4*Math.random());this.targetId=a;this.species=b;this.width=500;this.height=300;null!=c&&(null!=c.height&&(this.height=c.height),null!=c.width&&(this.width=c.width),null!=c.trackWidth&&(this.trackWidth=c.trackWidth));this.onClick=new Event(this);this.onRendered=new Event(this);this.onMarkerClicked=new Event(this)}
KaryotypePanel.prototype.getTrackId=function(a){return this.id+"_track_"+a};KaryotypePanel.prototype.init=function(){this.containerTable=DOM.createNewElement("table",DOM.select(this.targetId),[["id",this.id+"_table"],["width",this.width],["height",this.height]]);tr=DOM.createNewElement("tr",this.containerTable,[["width",this.width],["style","vertical-align:bottom"]]);for(var a=0;a<this.features.length;a++)DOM.createNewElement("td",tr,[["style","vertical-align:bottom"],["id",this.getTrackId(a)]])};
KaryotypePanel.prototype.drawFeatures=function(){var a=this,b=this.width/this.features.length;this.panels={};for(var c=0;c<this.features.length;c++){var d=this.chromosomeSize[c]*this.height-10,d=new ChromosomeFeatureTrack(this.id+"chr"+this.chromosomesNames[c],document.getElementById(this.getTrackId(c)),this.species,{top:10,bottom:d,left:12,right:25,width:b,height:this.chromosomeSize[c]*this.height,labelChromosome:!0,label:!0,vertical:!0,rounded:2,backgroundcolor:"yellow"});a.panels[this.chromosomesNames[c]]=
d;var e=new DataSet;e.loadFromJSON([this.features[c]]);d.draw(e);a.panels[this.chromosomesNames[c]].click.addEventListener(function(b,c){var d=(c.end-c.start)/2+c.start;a.select(c.chromosome,d,d+2E6);a.onClick.notify(c)});a.panels[this.chromosomesNames[c]].onMarkerClicked.addEventListener(function(b,c){a.onMarkerClicked.notify(c)})}this.onRendered.notify()};
KaryotypePanel.prototype.select=function(a,b,c){for(var d=0;d<this.chromosomesNames.length;d++)this.panels[this.chromosomesNames[d]].deselect();this.panels[a].select(b,c)};KaryotypePanel.prototype.mark=function(a,b){for(var c=0;c<a.length;c++)null!=this.panels[a[c].chromosome]&&this.panels[a[c].chromosome].mark(a[c],b)};KaryotypePanel.prototype.unmark=function(){for(var a in this.panels)this.panels[a].unmark()};
KaryotypePanel.prototype.draw=function(a,b){this.features=b;this.chromosomesNames=a;this.chromosomeSize=[];for(var c=this.maxChromosomeSize=0;c<this.features.length;c++)this.chromosomeSize.push(this.features[c][this.features[c].length-1].end),this.maxChromosomeSize<this.features[c][this.features[c].length-1].end&&(this.maxChromosomeSize=this.features[c][this.features[c].length-1].end);for(c=0;c<this.features.length;c++)this.chromosomeSize[c]/=this.maxChromosomeSize;this.init();this.drawFeatures()};
function TooltipPanel(a){this.id="TooltipPanel"+Math.round(1E7*Math.random());this.targetId=null;this.width=100;this.height=60;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}TooltipPanel.prototype.getPanel=function(a){null==this.panel&&(this.panel=Ext.create("Ext.tip.Tip",{html:this._getItemInfo(a)}));return this.panel};TooltipPanel.prototype.destroy=function(){this.panel.destroy()};
TooltipPanel.prototype._getItemInfo=function(a){var b="";if(a instanceof GeneFeatureFormatter||a instanceof TranscriptFeatureFormatter||a instanceof ExonFeatureFormatter||a instanceof SNPFeatureFormatter||a instanceof TfbsFeatureFormatter)b='<span class="ssel">'+a.getName()+'</span><br>start: <span class="emph">'+a.start+'</span><br>end:  <span class="emph">'+a.end+'</span><br>length: <span class="info">'+(a.end-a.start+1)+"</span><br>";a instanceof VCFFeatureFormatter&&(b='<span class="ssel">'+a.getName()+
"</span><br>");return b};
function KaryotypeHorizontalMarkerWidget(){this.id="GV_";this.width=600;this.height=700;this.tabPanelHeight=250;this.topPanelHeight=600;this.genomeWidget=new GenomeWidget("id","container_map",{width:100,height:this.topPanelHeight});this.genomeWidgetProperties=new GenomeWidgetProperties({windowSize:1E6,pixelRatio:1.0E-5});this.genomeWidgetProperties.addTrackByZoom(100,100,new SequenceFeatureTrack(this.id+"sequence",this.tracksPanel,{top:0,left:0,right:this.width,width:this.width,height:20,featureHeight:12,
avoidOverlapping:!1,backgroundColor:"#FFFFFF"}),new RegionCellBaseDataAdapter({resource:"sequence"}));this.genomeWidgetProperties.addTrackByZoom(0,0,new CytobandFeatureTrack(this.id+"_cytoband",this.tracksPanel,{top:0,left:0,height:20,title:"Cytoband",titleFontSize:9,label:!1,featureHeight:8,opacity:1,backgroundColor:"#FFFFFF"}),new RegionCellBaseDataAdapter({resource:"cytoband"}));this.genomeWidgetProperties.addTrackByZoom(10,100,new CytobandFeatureTrack(this.id+"_cytoband",this.tracksPanel,{top:0,
left:0,height:20,title:"Cytoband",titleFontSize:9,label:!0,featureHeight:8,opacity:1,backgroundColor:"#FFFFFF"}),new RegionCellBaseDataAdapter({resource:"cytoband"}));var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:20,featureHeight:18,queueHeight:18,title:"GENES",titleFontSize:9,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"blue",intervalSize:1E6});this.genomeWidgetProperties.addTrackByZoom(0,
0,a,new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:20,featureHeight:18,queueHeight:18,title:"GENES",titleFontSize:9,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"blue",intervalSize:1E5});this.genomeWidgetProperties.addTrackByZoom(10,10,a,new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));this.genomeWidgetProperties.addTrackByZoom(20,
40,new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:10,featureHeight:7,queueHeight:10,title:"GENES",titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1}),new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));this.genomeWidgetProperties.addTrackByZoom(50,60,new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:10,featureHeight:7,queueHeight:10,title:"GENES",
titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!1}),new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));this.genomeWidgetProperties.addTrackByZoom(70,90,new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:10,featureHeight:6,queueHeight:10,title:"GENES",titleFontSize:9,labelFontSize:8,showTranscripts:!0,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,
showDetailGeneLabel:!0}),new GeneRegionCellBaseDataAdapter)}KaryotypeHorizontalMarkerWidget.prototype.draw=function(a,b){this.chromosome=a;this.position=b;var c=Ext.create("Ext.panel.Panel",{layout:"vbox",region:"center",margins:"0 0 0 5",items:[this.getTopPanel()]});Ext.create("Ext.container.Viewport",{layout:"border",items:[c]});this._drawMasterKaryotypeHorizontalMarkerWidget(this.chromosome,this.position-this.genomeWidgetProperties.windowSize,this.position+this.genomeWidgetProperties.windowSize)};
KaryotypeHorizontalMarkerWidget.prototype.getMasterId=function(){return this.id+"_master"};KaryotypeHorizontalMarkerWidget.prototype.zoom=function(){this.position=this.genomeWidget.getMiddlePoint();this.refreshMasterKaryotypeHorizontalMarkerWidget();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.genomeWidgetProperties.getPixelRatio())};KaryotypeHorizontalMarkerWidget.prototype.goTo=function(a,b){this.chromosome=a;this.position=b;this.refreshMasterKaryotypeHorizontalMarkerWidget()};
KaryotypeHorizontalMarkerWidget.prototype.refreshMasterKaryotypeHorizontalMarkerWidget=function(){this.genomeWidget.clear();this._drawMasterKaryotypeHorizontalMarkerWidget()};KaryotypeHorizontalMarkerWidget.prototype.addMasterTrack=function(a,b){this.genomeWidgetProperties.getCustomTracks().push(a);this.genomeWidgetProperties.getCustomDataAdapters().push(b);this._drawMasterKaryotypeHorizontalMarkerWidget()};
KaryotypeHorizontalMarkerWidget.prototype._drawMasterKaryotypeHorizontalMarkerWidget=function(){this.genomeWidget=new GenomeWidget(this.id+"master",this.getMasterId(),{pixelRatio:2.0E-6,width:this.width,height:this.height});for(var a=0;a<this.genomeWidgetProperties.getCustomTracks().length;a++)this.genomeWidgetProperties.getCustomTracks()[a].top=this.genomeWidgetProperties.getCustomTracks()[a].originalTop,this.genomeWidgetProperties.getCustomTracks()[a].height=this.genomeWidgetProperties.getCustomTracks()[a].originalHeight,
this.genomeWidgetProperties.getCustomTracks()[a].clear(),this.genomeWidgetProperties.getCustomDataAdapters()[a].datasets={},this.genomeWidget.addTrack(this.genomeWidgetProperties.getCustomTracks()[a],this.genomeWidgetProperties.getCustomDataAdapters()[a]);for(var b=this.genomeWidgetProperties.getZoom(),a=0;a<this.genomeWidgetProperties.getTrackByZoom(b).length;a++){var c=this.genomeWidgetProperties.getTrackByZoom(b)[a];c.top=c.originalTop;c.height=c.originalHeight;c.clear();this.genomeWidgetProperties.getDataAdapterByZoom(b)[a].datasets=
{};this.genomeWidget.addTrack(c,this.genomeWidgetProperties.getDataAdapterByZoom(b)[a])}a=Math.ceil(this.position-this.genomeWidgetProperties.windowSize);b=Math.ceil(this.position+this.genomeWidgetProperties.windowSize);0>a&&(a=0);this.genomeWidget.draw(this.chromosome,a,b)};KaryotypeHorizontalMarkerWidget.prototype.getTopPanel=function(){return Ext.create("Ext.panel.Panel",{width:this.width,height:this.topPanelHeight,margins:"0 5 2 5",html:'<div id = "'+this.getMasterId()+'"></div>'})};
function GenomeWidgetProperties(a,b){this.args=b;this.species=a;this.windowSize=1E7;this.minWindowSize=100;this.maxWindowSize=1E8;this._pixelRatio=5.0E-4;this.showTranscripts=!1;this._zoom=0;this.labelSize=this.labelHeight=10;this.featureHeight=4;null!=b&&(null!=b.windowSize&&(this.windowSize=b.windowSize),null!=b.id&&(this.id=b.id),null!=b._pixelRatio&&(this._pixelRatio=b._pixelRatio),null!=b.showTrancsripts&&(this.showTrancsripts=b.showTranscripts),null!=b.showExons&&(this.showExons=b.showExons));
this._zoomLevels={};this._windowSizeLevels={};this._zoomTracks={};this._zoomDataAdapters={};for(var c=0;100>=c;c+=10)this._zoomTracks[c]=[],this._zoomDataAdapters[c]=[];this.tracks={};this.customTracks=[];this.customDataAdapters=[];this.init()}GenomeWidgetProperties.prototype.getWindowSize=function(a){return this._windowSizeLevels[a]};
GenomeWidgetProperties.prototype.init=function(){this._zoomLevels[0]=5.0E-6;this._zoomLevels[10]=2.0E-5;this._zoomLevels[20]=8.0E-4;this._zoomLevels[30]=8.0E-4;this._zoomLevels[40]=0.0032;this._zoomLevels[50]=0.0064;this._zoomLevels[60]=0.0128;this._zoomLevels[70]=0.0256;this._zoomLevels[80]=0.0512;this._zoomLevels[90]=0.1024;this._zoomLevels[100]=10;this._windowSizeLevels[0]=13E7;this._windowSizeLevels[10]=4E7;this._windowSizeLevels[20]=75E4;this._windowSizeLevels[30]=75E4;this._windowSizeLevels[40]=
187500;this._windowSizeLevels[50]=93750;this._windowSizeLevels[60]=46875;this._windowSizeLevels[70]=23437.5;this._windowSizeLevels[80]=11718.75;this._windowSizeLevels[90]=5859.375;this._windowSizeLevels[100]=100;this._zoom=40;this._pixelRatio=this._zoomLevels[this._zoom];this.windowSize=this._windowSizeLevels[this._zoom];for(var a=0;100>=a;a+=10){var b=new RuleFeatureTrack(this.id+"_ruleTrack",this.tracksPanel,this.species,{top:10,left:0,height:20,expandRuleHeight:1500,labelHeight:this.labelHeight,
featureHeight:this.featureHeight,floating:!0});this.addTrackByZoom(a,a,b,new RuleRegionDataAdapter({pixelRatio:this._zoomLevels[a]}))}this.addNativeTracks()};GenomeWidgetProperties.prototype.setLabelHeight=function(a){for(var b in this._zoomTracks)for(var c=this._zoomTracks[b],d=0;d<c.length;d++)c[d].labelHeight=a,c[d].labelSize=a};
GenomeWidgetProperties.prototype.addCustomTrackByZoom=function(a,b,c,d){c.titleWidth=5<c.titleName.length?5*c.titleName.length:25;this.customTracks.push(c);!1==c instanceof HistogramFeatureTrack&&!1==c instanceof SNPFeatureTrack&&(c.labelHeight=this.labelHeight,c.featureHeight=this.featureHeight);this.addTrackByZoom(a,b,c,d)};GenomeWidgetProperties.prototype.addTrackByZoom=function(a,b,c,d){for(null==this.tracks[c.titleName]&&(this.tracks[c.titleName]=!0);a<=b;a+=10)this._zoomTracks[a].push(c),this._zoomDataAdapters[a].push(d)};
GenomeWidgetProperties.prototype.getTrackByZoom=function(a){for(var b=[],c=0;c<this._zoomTracks[a].length;c++)!0==this.tracks[this._zoomTracks[a][c].titleName]&&b.push(this._zoomTracks[a][c]);return b};GenomeWidgetProperties.prototype.getDataAdapterByZoom=function(a){for(var b=[],c=0;c<this._zoomTracks[a].length;c++)!0==this.tracks[this._zoomTracks[a][c].titleName]&&b.push(this._zoomDataAdapters[a][c]);return b};GenomeWidgetProperties.prototype.getPixelRatio=function(){return this._zoomLevels[this.getZoom()]};
GenomeWidgetProperties.prototype.setZoom=function(a){this._zoom=a;this._pixelRatio=this.getPixelRatioByZoomLevel(this.getZoom());this.windowSize=this._windowSizeLevels[a]};GenomeWidgetProperties.prototype.getZoom=function(){return this._zoom};GenomeWidgetProperties.prototype.getPixelRatioByZoomLevel=function(a){return 100==a?10:this._zoomLevels[a]};GenomeWidgetProperties.prototype.getCustomTracks=function(){return this.customTracks};GenomeWidgetProperties.prototype.getCustomDataAdapters=function(){return this.customDataAdapters};
GenomeWidgetProperties.prototype.addNativeTracks=function(){this.addSequenceTracks();this.addSNPTracks();this.addCytobandTracks();this.addMultifeatureTracks();this.addTFBSTracks();this.addHistoneTracks();this.addPolymeraseTracks();this.addOpenChromatinTracks();this.addMirnaTargetTracks();this.addConservedRegionsTracks();this.tracks.SNP=!1;this.tracks.Sequence=!1;this.tracks.Cytoband=!1;this.tracks.Histone=!1;this.tracks["Open Chromatin"]=!1;this.tracks.Polymerase=!1;this.tracks.TFBS=!1;this.tracks["miRNA targets"]=
!1;this.tracks["Conserved regions"]=!1};
GenomeWidgetProperties.prototype.addSNPTracks=function(){var a=new SNPFeatureTrack(this.id+"snp",this.tracksPanel,this.species,{top:5,left:0,label:!0,title:"SNP",height:20,isAvalaible:!1});this.addTrackByZoom(0,80,a,new RegionCellBaseDataAdapter(this.species,{resource:"snp"}));a=new SNPFeatureTrack(this.id+"snp",this.tracksPanel,this.species,{top:5,left:0,label:!1,title:"SNP",height:20,labelHeight:this.labelHeight,featureHeight:10,labelSize:this.labelSize,pixelSpaceBetweenBlocks:150,avoidOverlapping:!1,
backgroundColor:"#FFFFFF"});this.addTrackByZoom(90,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"snp"}));a=new SNPFeatureTrack(this.id+"snp",this.tracksPanel,this.species,{top:5,left:0,label:!0,title:"SNP",height:20,labelHeight:this.labelHeight,featureHeight:10,labelSize:this.labelSize,pixelSpaceBetweenBlocks:150,avoidOverlapping:!0,backgroundColor:"#FFFFFF"});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"snp"}))};
GenomeWidgetProperties.prototype.addSequenceTracks=function(){var a=new SequenceFeatureTrack(this.id+"sequence",this.tracksPanel,this.species,{top:20,title:"Sequence",height:15,featureHeight:12,avoidOverlapping:!1,backgroundColor:"#FFFFFF",isAvalaible:!1});this.addTrackByZoom(0,90,a,new RegionCellBaseDataAdapter(this.species));a=new SequenceFeatureTrack(this.id+"sequence",this.tracksPanel,this.species,{top:20,title:"Sequence",height:15,featureHeight:12,avoidOverlapping:!1,backgroundColor:"#FFFFFF"});
this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"sequence"}))};
GenomeWidgetProperties.prototype.addCytobandTracks=function(){this.addTrackByZoom(0,0,new FeatureTrack(this.id+"_cytoband",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Cytoband",allowDuplicates:!0,label:!1}),new RegionCellBaseDataAdapter(this.species,{resource:"cytoband"}));this.addTrackByZoom(10,100,new FeatureTrack(this.id+"_cytoband",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,
featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Cytoband",allowDuplicates:!0,label:!0}),new RegionCellBaseDataAdapter(this.species,{resource:"cytoband"}))};
GenomeWidgetProperties.prototype.addMirnaTargetTracks=function(){var a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"miRNA targets",allowDuplicates:!1,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0,isAvalaible:!1});this.addTrackByZoom(0,70,a,new RegionCellBaseDataAdapter(this.species,{resource:"mirnatarget"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,
this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"miRNA targets",allowDuplicates:!1,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0,showLabelsOnMiddleMarker:!0});this.addTrackByZoom(80,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"mirnatarget"}))};
GenomeWidgetProperties.prototype.addOpenChromatinTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Open Chromatin",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:5E5});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));
a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Open Chromatin",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));a=new HistogramFeatureTrack(this.id+"_multiTrack",
this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Open Chromatin",titleFontSize:9,titleWidth:100,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,
title:"Open Chromatin",allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Open Chromatin",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0,showLabelsOnMiddleMarker:!0});
this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}))};
GenomeWidgetProperties.prototype.addPolymeraseTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Polymerase",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:5E5});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));
a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Polymerase",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,
this.species,{top:20,left:0,height:20,featureHeight:18,title:"Polymerase",titleFontSize:9,titleWidth:70,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Polymerase",
allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Polymerase",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,
{resource:"regulatory?type=Polymerase"}))};
GenomeWidgetProperties.prototype.addHistoneTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:40,featureHeight:40,title:"Histone",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08"});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE&histogram=true&interval=250000"}));a=
new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:40,featureHeight:40,title:"Histone",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE&histogram=true&interval=125000"}));a=new HistogramFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Histone",titleFontSize:9,titleWidth:70,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,
title:"Histone",allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Histone",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,
{resource:"regulatory?type=HISTONE"}))};
GenomeWidgetProperties.prototype.addTFBSTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"TFBS",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:5E5});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new HistogramFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"TFBS",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,
title:"TFBS",titleFontSize:9,titleWidth:70,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"TFBS",allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,
90,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"TFBS",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}))};
GenomeWidgetProperties.prototype.addConservedRegionsTracks=function(){var a=new FeatureTrack(this.id+"_conservedregion",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,allowDuplicates:!0,label:!1,titleWidth:92,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0,title:"Conserved regions"});this.addTrackByZoom(0,50,a,new RegionCellBaseDataAdapter(this.species,{resource:"conservedregion"}));a=new FeatureTrack(this.id+"_conservedregion",
this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,allowDuplicates:!0,label:!0,titleWidth:92,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0,title:"Conserved regions"});this.addTrackByZoom(60,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"conservedregion"}))};
GenomeWidgetProperties.prototype.addMultifeatureTracks=function(){this.addTrackByZoom(0,10,new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:40,featureHeight:40,title:"Gene/Transcript",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"blue"}),new RegionCellBaseDataAdapter(this.species,{resource:"gene?histogram=true&interval=250000"}));
var a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,isAvalaible:!0});this.addTrackByZoom(20,20,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!1}));a=new MultiFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:7*this.labelSize,showDetailGeneLabel:!1,isAvalaible:!0});this.addTrackByZoom(30,40,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!1}));this.addTrackByZoom(50,60,new MultiFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0}),new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!1}));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,
labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!0,showExonLabel:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0});this.addTrackByZoom(70,70,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!0}));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,
featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!0,showExonLabel:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0});this.addTrackByZoom(80,80,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!0}));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:10,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,
labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,labelFontSize:8,showTranscripts:!0,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0});this.addTrackByZoom(90,90,a,new GeneRegionCellBaseDataAdapter(this.species));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:10,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",
titleWidth:70,titleFontSize:9,labelFontSize:8,showTranscripts:!0,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0,showLabelsOnMiddleMarker:!0,showExonLabel:!0,onMouseOverShitExonTranscriptLabel:!0});this.addTrackByZoom(100,100,a,new GeneRegionCellBaseDataAdapter(this.species))};
function GenomeWidget(a,b,c){this.id=a;this.targetId=b;this.pixelRatio=0.0010;this.width=100;this.height=500;this.end=this.start=this.chromosome=null;this.viewBoxModule=7E6;this.allowDragging=!0;null!=c&&(null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),null!=c.pixelRatio&&(this.pixelRatio=c.pixelRatio),null!=c.viewBoxModule&&(this.viewBoxModule=c.viewBoxModule),null!=c.allowDragging&&(this.allowDragging=c.allowDragging));this.trackList=[];this.dataAdapterList=[];this.trackCanvas=
null;this.onMarkerChange=new Event(this);this.onClick=new Event(this);this.onRender=new Event(this);this.onMove=new Event(this)}GenomeWidget.prototype.clear=function(){this.trackCanvas.clear()};GenomeWidget.prototype.init=function(){DOM.removeChilds(this.targetId);this.tracksPanel=DOM.createNewElement("div",document.getElementById(this.targetId),[["id","detail_tracks_container"]])};
GenomeWidget.prototype.getviewBoxModule=function(){for(var a=this.viewBoxModule,b=2E6;this.end*this.pixelRatio%a<this.start*this.pixelRatio%a;)b+=b,a=parseFloat(a)+b;return a};GenomeWidget.prototype.getMiddlePoint=function(){return this.trackCanvas.getMiddlePoint()};GenomeWidget.prototype.addTrack=function(a,b){this.trackList.push(a);this.dataAdapterList.push(b)};
GenomeWidget.prototype.draw=function(a,b,c){this.chromosome=a;this.start=b;this.end=c;var d=this;this.init();this.trackCanvas=new TrackCanvas(this.id+"_canvas",document.getElementById(this.targetId),{top:0,left:0,right:this.width,width:this.width,height:this.height,start:this.start,end:this.end,backgroundColor:"#FFCCFF",pixelRatio:this.pixelRatio,viewBoxModule:this.getviewBoxModule(),allowDragging:this.allowDragging});this.trackCanvas.init();this.trackCanvas.afterDrag.addEventListener(function(){});
this.trackCanvas.onMove.addEventListener(function(a,b){d.onMarkerChange.notify(b)});for(a=0;a<this.trackList.length;a++)this.trackList[a].viewBoxModule=this.getviewBoxModule(),this.trackList[a].pixelRatio=this.pixelRatio,this.trackList[a].targetID=document.getElementById(this.targetId),this.trackCanvas.addTrack(this.trackList[a],this.dataAdapterList[a]);d=this;this.trackCanvas.onRender.addEventListener(function(){d.onRender.notify()});this.trackCanvas.draw(this.chromosome,this.start,this.end)};
function LegendPanel(a){this.width=200;this.height=250;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}
LegendPanel.prototype.getColorItems=function(a){panelsArray=[];for(var b in a){var c=Ext.create("Ext.draw.Component",{width:15,height:15,items:[{type:"rect",fill:a[b],x:0,y:0,width:15,height:15}]}),d=b.replace(/_/gi," "),d=d.charAt(0).toUpperCase()+d.slice(1),c=Ext.create("Ext.panel.Panel",{height:15,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[c,{xtype:"tbtext",text:d,margin:"1 0 0 3"}]});panelsArray.push(c)}return panelsArray};
LegendPanel.prototype.getPanel=function(a){null==this.panel&&(a=this.getColorItems(a),this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:a,width:this.width,height:20*a.length}));return this.panel};LegendPanel.prototype.getButton=function(a){null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{items:[this.getPanel(a)]}}));return this.button};
function LegendWidget(a){this.height=this.width=300;this.title="Legend";null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.legendPanel=new LegendPanel}
LegendWidget.prototype.draw=function(a){var b=this;null==this.panel&&(a=this.legendPanel.getPanel(a),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:a.width+10,height:a.height+70,items:[a],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]}));this.panel.show()};
function GeneBlockManager(){this.data={};this.data.queues=[];this.data.queues[0]=[];this.data.transcriptQueueCount={};this.data.transcriptQueue=[]}GeneBlockManager.prototype.getGenesTrackCount=function(){return this.data.queues.length};GeneBlockManager.prototype.getFeaturesFromGeneTrackIndex=function(a){return this.data.queues[a]};GeneBlockManager.prototype.toJSON=function(){return this.data};
GeneBlockManager.prototype.init=function(a){this.data.features=a;for(var a=this.data.features,b=0;b<a.length;b++){var c=this._searchSpace(a[b],this.data.queues);this.data.queues[c].push(a[b]);null==this.data.transcriptQueue[c]&&this.data.transcriptQueue.push([]);this.data.TranscriptQueuesTest=[];for(var d=0;d<a[b].transcript.length;d++){var e={start:a[b].transcript[d].exon[0].start,end:a[b].transcript[d].exon[a[b].transcript[d].exon.length-1].end},f=this._searchSpace(e,this.data.TranscriptQueuesTest);
this.data.TranscriptQueuesTest[f].push(e);null==this.data.transcriptQueue[c][f]&&this.data.transcriptQueue[c].push([]);this.data.transcriptQueue[c][f].push(a[b].transcript[d])}}return this.data.queues[c].length};GeneBlockManager.prototype._overlapBlocks=function(a,b){return a.start<=b.end&&a.end>=b.start?!0:!1};
GeneBlockManager.prototype._searchSpace=function(a,b){for(var c=0;c<b.length;c++){for(var d=[],e=0;e<b[c].length;e++)d.push(this._overlapBlocks(a,b[c][e]));if(-1==d.valueOf(d).indexOf(!0))return c}b.push([]);return b.length-1};GeneBlockManager.prototype.loadFromJSON=DataSet.prototype.loadFromJSON;GeneBlockManager.prototype.loadFromFile=DataSet.prototype.loadFromFile;GeneBlockManager.prototype.loadFromURL=DataSet.prototype.loadFromURL;function GeneBlockManager(){this.data={}}
GeneBlockManager.prototype.getGenesTrackCount=function(){return this.data.queues.length};GeneBlockManager.prototype.getFeaturesFromGeneTrackIndex=function(a){return this.data.queues[a]};GeneBlockManager.prototype.toJSON=function(){return this.data};GeneBlockManager.prototype.validate=function(){return!0};GeneBlockManager.prototype.sort=function(a,b){return b.end-b.start-(a.end-a.start)};
GeneBlockManager.prototype.toDatasetFormatter=function(a){var b=[];try{for(var c=0;c<a.length;c++){var d=new GeneFeatureFormatter(a[c]);b.push(d);if(null!=a[c].transcript)for(var e=a[c].transcript,f=0;f<e.length;f++)null==d.transcript&&(d.transcript=[]),d.transcript.push(new TranscriptFeatureFormatter(a[c].transcript[f]))}}catch(g){alert("ERROR: GeneBlockManager: "+g)}return b};
