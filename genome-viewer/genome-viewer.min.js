function TrackCanvas(a,b,c){this.tracksGroup=null;this.targetID=b.id;this.args=c;this.top=0;this.left=100;this.right=900;this.width=1100;this.height=50;this.startViewBox=c.start;this.endViewBox=c.end;this.trackList=[];this.trackRendered=[];this.trackRenderedName=[];this.regionAdapterList=[];this.pixelRatio=5;this.zoom=1;this.viewBoxModule=700;this.isDragging=this.allowDragging=!1;this.dragPoint=null;this.backgroundColor="#FFFFFF";this.titleColor="#000000";this.title=this.overflow=!1;this.titleName=
null;this.titleFontSize=10;this.enableMovingY=!1;this.isBeenRenderized=this.allowLabelMoving=!0;null!=c&&(null!=c.top&&(this.top=c.top),null!=c.left&&(this.left=c.left),null!=c.right&&(this.right=c.right),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),null!=c.backgroundColor&&(this.backgroundColor=c.backgroundColor),null!=c.titleFontSize&&(this.titleFontSize=c.titleFontSize),null!=c.allowDragging&&(this.allowDragging=c.allowDragging),null!=c.titleColor&&(this.titleColor=
c.titleColor),null!=c.title&&(this.title=!0,this.titleName=c.title),null!=c.overflow&&(this.overflow=c.overflow),null!=c.pixelRatio&&(this.pixelRatio=c.pixelRatio),null!=c.viewBoxModule&&(this.viewBoxModule=c.viewBoxModule),null!=c.zoom&&(this.zoom=c.zoom));this.textLines=[];this.id=a;this.idMain=this.id+"_Main";this.moveY=0;this.onMove=new Event(this);this.afterDrag=new Event(this);this.onRender=new Event(this)}
TrackCanvas.prototype.createSVGDom=function(a,b){var c=DOM.select(a);this._svg=SVG.createSVGCanvas(c,[["viewBox","0 10 "+this.width+" "+this.height],["preserveAspectRatio","none"],["id",b],["height",this.height],["width",this.width],["background-color","green"]]);this.tracksGroup=SVG.drawGroup(this._svg,[["id",this.idMain],["transform","scale("+this.zoom+")"]]);SVG.drawRectangle(0,0,this.viewBoxModule,this.height,this.tracksGroup,[["fill","white"]]);return this._svg};
TrackCanvas.prototype.mouseClick=function(){alert("click")};TrackCanvas.prototype.mouseMove=function(a){this.allowDragging&&(this._dragging(a),this.moveLabelsFeatureSelected())};TrackCanvas.prototype.moveLabelsFeatureSelected=function(){if(this.allowLabelMoving)for(var a=0;a<this.trackList.length;a++)this.trackList[a].showLabelsOnMiddleMarker&&this.trackList[a].drawLabelAtPosition(this.getMiddlePoint(),this.regionAdapterList[a].getFeaturesByPosition(this.getMiddlePoint()))};
TrackCanvas.prototype.mouseDown=function(a){this.allowDragging&&this._startDragging(a)};TrackCanvas.prototype.mouseUp=function(a){this.allowDragging&&this._afterDrag(a)};
TrackCanvas.prototype.init=function(){this._svg=this.createSVGDom(this.targetID,this.id,this.width,this.height,this.backgroundColor);var a=this;this._svg.addEventListener("mousemove",function(b){a.mouseMove(b,a)},!1);this._svg.addEventListener("mousedown",function(b){a.mouseDown(b,a)},!1);this._svg.addEventListener("mouseup",function(b){a.mouseUp(b,a)},!1)};
TrackCanvas.prototype._getTrackFromInternalRegionId=function(a){for(var b=0;b<this.regionAdapterList.length;b++)if(null!=this.regionAdapterList[b]&&this.regionAdapterList[b].internalId==a)return this.trackList[b];return null};
TrackCanvas.prototype._formatData=function(a){a instanceof DasRegionDataAdapter&&console.log("regionAdapter instanceof DasRegionDataAdapter");if(a instanceof GeneRegionCellBaseDataAdapter){var b=new GeneBlockManager;a.dataset.json=b.toDatasetFormatter(a.dataset.json)}if(a instanceof VCFLocalRegionDataAdapter){for(var b=[],c=0;c<a.dataset.json[0].length;c++)b.push(new VCFFeatureFormatter(a.dataset.json[0][c]));a.dataset.json=b}if(a instanceof GFFLocalRegionDataAdapter){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new GFFFeatureFormatter(a.dataset.json[0][c]));
a.dataset.json=b}if(a instanceof BEDLocalRegionDataAdapter){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new BEDFeatureFormatter(a.dataset.json[0][c]));a.dataset.json=b}if(a instanceof RuleRegionDataAdapter){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new MarkerRuleFeatureFormatter(a.dataset.json[0][c]));a.dataset.json=b}if(a instanceof RegionCellBaseDataAdapter){b=[];if(-1!=a.resource.toLowerCase().indexOf("histogram=true"))return a;if("gene"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new GeneFeatureFormatter(a.dataset.json[0][c]))}if("tfbs"==
a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new TfbsFeatureFormatter(a.dataset.json[0][c]))}if("mirnatarget"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new MiRNAFeatureFormatter(a.dataset.json[0][c]))}if("regulatory?type=open chromatin"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new GenericFeatureFormatter(a.dataset.json[0][c]))}if("regulatory?type=HISTONE"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new GenericFeatureFormatter(a.dataset.json[0][c]))}if("regulatory?type=Polymerase"==
a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new GenericFeatureFormatter(a.dataset.json[0][c]))}if("snp"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new SNPFeatureFormatter(a.dataset.json[0][c]))}if("cytoband"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new CytobandFeatureFormatter(a.dataset.json[0][c]))}if("transcript"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new TranscriptFeatureFormatter(a.dataset.json[0][c]))}if("exon"==
a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new ExonFeatureFormatter(a.dataset.json[0][c]))}if("conservedregion"==a.resource){b=[];for(c=0;c<a.dataset.json[0].length;c++)b.push(new GenericFeatureFormatter(a.dataset.json[0][c]))}if("sequence"==a.resource){b=[];for(c=0;c<a.dataset.json[0].sequence.length;c++){var d=a.dataset.json[0].start+c+1;b.push(new SequenceFormatter({start:d,end:d,base:a.dataset.json[0].sequence[c]}))}}a.dataset.json=b}return a};
TrackCanvas.prototype._trackRendered=function(){for(var a=0;a<this.trackRendered.length;a++)if(!1==this.trackRendered[a]){this.trackRendered[a]=!0;break}};TrackCanvas.prototype._areAllTracksRendered=function(){for(var a=0;a<this.trackRendered.length;a++)if(!1==this.trackRendered[a])return!1;return!0};
TrackCanvas.prototype._drawTrack=function(a,b,c,d,e){var f=this;d.viewBoxModule=this.viewBoxModule;d.isAvalaible?(e.successed.addEventListener(function(){f._formatData(e);f.trackRenderedName.push(e);f._trackRendered();f._areAllTracksRendered()&&f.drawRules(a,b,c)}),e.preloadSuccess.addEventListener(function(a){a=f._getTrackFromInternalRegionId(a.internalId);e=f._formatData(e);a.appendFeatures(e.dataset)}),this.onMove.addEventListener(function(b,c){c.middle=Math.ceil(c.middle)+1;e.setIntervalView(a,
Math.ceil(c.middle));e instanceof RuleRegionDataAdapter&&f.selectPaintOnRules(c.middle)}),e.fill(a,b,c,e.resource)):(f.trackRenderedName.push(e),f._trackRendered())};TrackCanvas.prototype.selectPaintOnRules=function(a){for(var b=0;b<this.getRuleTracks().length;b++)1>this.pixelRatio?this.getRuleTracks()[b].select(a):this.getRuleTracks()[b].select(a,{width:this.pixelRatio})};
TrackCanvas.prototype.getRuleTracks=function(){for(var a=[],b=0;b<this.trackList.length;b++)this.trackList[b]instanceof RuleFeatureTrack&&a.push(this.trackList[b]);return a};TrackCanvas.prototype.getMiddlePoint=function(){return Math.ceil(this.middle)+1};
TrackCanvas.prototype.drawRules=function(){for(var a=0;a<this.trackList.length;a++){var b=this._getTopTrack(this.trackList[a]);this.trackList[a].draw(this.regionAdapterList[a].dataset,this.tracksGroup,b);this._drawTitle(a)}this._goToCoordinateX(this.start);this.onRender.notify()};
TrackCanvas.prototype._drawTitle=function(a){if(null!=this.trackList[a].title){var b=this.start+this.width/this.pixelRatio/2;null==b?this.trackList[a].drawTitle(10):this.trackList[a].drawTitle(b-this.width/2/this.pixelRatio+1)}};
TrackCanvas.prototype.draw=function(a,b,c){this.start=b;this.end=c;this.chromosome=a;this.startViewBox=b*this.pixelRatio%this.viewBoxModule;this.endViewBox=c*this.pixelRatio%this.viewBoxModule;for(var d=0;d<this.regionAdapterList.length;d++){var e=this.trackList[d],f=this.regionAdapterList[d];f.successed=new Event(f);f.preloadSuccess=new Event(f);this._drawTrack(a,b,c,e,f)}};TrackCanvas.prototype.clear=function(){DOM.removeChilds(this.targetID)};
TrackCanvas.prototype.addTrack=function(a,b){this.trackList.push(a);this.trackRendered.push(!1);this.regionAdapterList.push(b)};TrackCanvas.prototype._getTopTrack=function(a){for(var b=this.top,c=0;c<this.trackList.length;c++){if(this.trackList[c].internalId==a.internalId)return b+this.trackList[c].top;b=b+this.trackList[c].height+this.trackList[c].originalTop}return b};
TrackCanvas.prototype._goToCoordinateX=function(a){this.start=a;this._svg.setAttribute("viewBox",this.start*this.pixelRatio%this.viewBoxModule+" 10 "+this.width+" "+this.height);this.isBeenRenderized?(this.middle=this.start+(this.end-this.start)/2,this.isBeenRenderized=!1):this.middle=this.start+this.width/this.pixelRatio/2;this.onMove.notify({chromosome:this.chromosome,start:this.start,end:this.end,middle:this.middle})};
TrackCanvas.prototype._moveCoordinateX=function(a){for(var b=0;b<this.trackList.length;b++)null!=this.trackList[b].title&&this.trackList[b].moveTitle(-a);this._goToCoordinateX(Math.ceil(this.start+a/this.pixelRatio))};TrackCanvas.prototype._moveCoordinateY=function(a){a=-1*a+this.moveY;if(a<this.top){this.tracksGroup.setAttribute("transform","translate(0, "+a+")");this.realMove=a;for(var b=0;b<this.trackList.length;b++)this.trackList[b].floating&&this.trackList[b].moveY(-a)}else this.realMove=0};
TrackCanvas.prototype._startDragging=function(a){this.isDragging=!0;a=this._getSVGCoordenates(a);this.dragPoint={x:a.x,y:a.y}};TrackCanvas.prototype._afterDrag=function(){this.isDragging=!1;this.dragPoint=null;this.moveY=this.realMove;this.afterDrag.notify(this.middle)};TrackCanvas.prototype.setZoom=function(a){this.zoom=a;this.tracksGroup.setAttribute("transform","scale("+a+")");this._goToCoordinateX(this.startViewBox)};
TrackCanvas.prototype._dragging=function(a){if(this.isDragging){var a=this._getSVGCoordenates(a),b=this.dragPoint.y-a.y;this._moveCoordinateX(this.dragPoint.x-a.x);this.enableMovingY&&this._moveCoordinateY(Math.ceil(b))}};TrackCanvas.prototype._getSVGCoordenates=function(a){var b=this._svg.createSVGPoint();b.x=a.clientX;b.y=a.clientY;a=this._svg.getScreenCTM(document.documentElement);return b=b.matrixTransform(a.inverse())};
function CytobandFeatureTrack(a,b,c){FeatureTrack.prototype.constructor.call(this,a,b,c);this.forceColor=this.opacity=null;null!=c&&(null!=c.opacity&&(this.opacity=c.opacity),null!=c.forceColor&&(this.forceColor=c.forceColor));this.positions={}}CytobandFeatureTrack.prototype._renderLabel=FeatureTrack.prototype._renderLabel;CytobandFeatureTrack.prototype.isFeatureDuplicated=FeatureTrack.prototype.isFeatureDuplicated;CytobandFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;
CytobandFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;CytobandFeatureTrack.prototype.render=FeatureTrack.prototype.render;CytobandFeatureTrack.prototype.init=FeatureTrack.prototype.init;CytobandFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;CytobandFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;CytobandFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;CytobandFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;
CytobandFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;CytobandFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;CytobandFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;CytobandFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;CytobandFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;CytobandFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;CytobandFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;
CytobandFeatureTrack.prototype._render=FeatureTrack.prototype._render;CytobandFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;CytobandFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;CytobandFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;CytobandFeatureTrack.prototype._updateTop=FeatureTrack.prototype._updateTop;
CytobandFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;CytobandFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;CytobandFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;CytobandFeatureTrack.prototype.moveY=FeatureTrack.prototype.moveY;CytobandFeatureTrack.prototype.drawFeaturesInQueue=FeatureTrack.prototype.drawFeaturesInQueue;CytobandFeatureTrack.prototype._setTextAttributes=FeatureTrack.prototype._setTextAttributes;
CytobandFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._setAttributes;CytobandFeatureTrack.prototype._drawFeature=FeatureTrack.prototype._drawFeature;CytobandFeatureTrack.prototype.appendFeatures=FeatureTrack.prototype.appendFeatures;CytobandFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
function Track(a,b,c){this.args=c;this.labelNodeGroup=this.mainNodeGroup=this.trackNodeGroup=null;this.internalId=Math.round(1E7*Math.random());null!=b&&(this.targetID=b.id);this.top=0;this.left=100;this.right=900;this.width=1100;this.height=50;this.originalTop=this.top;this.maxHeight=this.originalHeight=this.height;null!=c?(this.start=c.start,this.end=c.end):this.start=0;this.pixelRatio=5;this.backgroundColor="#FFFFFF";this.titleColor="#000000";this.overflow=!1;this.titleName=this.title=null;this.titleFontSize=
10;this.titleWidth=50;this.titleHeight=12;this.floating=!1;this.repeatLabel=null;this.isAvalaible=!0;this.isNotAvalaibleMessage="This level of zoom isn't appropiate for this track";this.labelFontSize=null;null!=c&&(null!=c.left&&(this.left=c.left),null!=c.top&&(this.originalTop=this.top=c.top),null!=c.left&&(this.left=c.left),null!=c.right&&(this.right=c.right),null!=c.width&&(this.width=c.width),null!=c.floating&&(this.floating=c.floating),null!=c.height&&(this.maxHeight=this.originalHeight=this.height=
c.height),null!=c.backgroundColor&&(this.backgroundColor=c.backgroundColor),null!=c.titleWidth&&(this.titleWidth=c.titleWidth),null!=c.titleFontSize&&(this.titleFontSize=c.titleFontSize),null!=c.titleHeight&&(this.titleHeight=c.titleHeight),null!=c.titleColor&&(this.titleColor=c.titleColor),null!=c.title&&(this.title=!0,this.titleName=c.title),null!=c.overflow&&(this.overflow=c.overflow),null!=c.pixelRatio&&(this.pixelRatio=c.pixelRatio),null!=c.labelFontSize&&(this.labelFontSize=c.labelFontSize),
null!=c.repeatLabel&&(this.repeatLabel=c.repeatLabel),null!=c.isAvalaible&&(this.isAvalaible=c.isAvalaible),null!=c.isNotAvalaibleMessage&&(this.isNotAvalaibleMessage=c.isNotAvalaibleMessage));this.id=a;this.idTrack=this.id+"_Features";this.idNames=this.id+"_Names";this.idMain=this.id+"_Main";this.idBackground=this.id+"_background";this.idTitleGroup=this.id+"_title_group";this.click=new Event(this)}Track.prototype._getViewBoxCoordenates=function(){return"0 10 "+this.width+" "+this.height};
Track.prototype.createSVGDom=function(a){null==this._svg&&(this._svg=SVG.createSVGCanvas(DOM.select(this.targetID),[["viewBox",this._getViewBoxCoordenates()],["preserveAspectRatio","none"],["id",a],["height",this.height],["width",this.width]]));this.mainNodeGroup=SVG.drawGroup(this._svg,[["id",this.idMain]]);this.backgroundNodeGroup=SVG.drawGroup(this.mainNodeGroup,[["id",this.idBackground]]);this.trackNodeGroup=SVG.drawGroup(this.mainNodeGroup,[["id",this.idTrack]]);this.labelNodeGroup=SVG.drawGroup(this.mainNodeGroup,
[["id",this.idNames]]);this.titleNodeGroup=SVG.drawGroup(this.mainNodeGroup,[["id",this.idTitleGroup]]);this.drawBackground();return this._svg};Track.prototype.drawBackground=function(){};Track.prototype.getBackgroundNode=function(){return this.backgroundNode};Track.prototype.init=function(){this._svg=this.createSVGDom(this.id,this.width,this.height,this.backgroundColor)};Track.prototype.clear=function(){if(null!=this.mainNodeGroup)for(;0<this.mainNodeGroup.childNodes.length;)this.mainNodeGroup.removeChild(this.mainNodeGroup.childNodes[0])};
Track.prototype._getSVGCoordenates=function(a){var b=this._svg.createSVGPoint();b.x=a.clientX;b.y=a.clientY;a=this._svg.getScreenCTM(document.documentElement);return b=b.matrixTransform(a.inverse())};
function MultiFeatureTrack(a,b,c,d){FeatureTrack.prototype.constructor.call(this,a,b,c,d);this.queueHeight=14;this.pixelSpaceBetweenBlocks=80;this.avoidOverlapping=this.showTranscripts=!0;this.onMouseOverShitExonTranscriptLabel=this.showExonLabel=this.showDetailGeneLabel=!1;this.extraSpaceProducedByLabelAbove=6;this.geneBlockManager=null;this.labelHeight=12;this.separatorBetweenQueue=4;this.labelSize=18;null!=d&&(null!=d.showExonLabel&&(this.showExonLabel=d.showExonLabel),null!=d.onMouseOverShitExonTranscriptLabel&&
(this.onMouseOverShitExonTranscriptLabel=d.onMouseOverShitExonTranscriptLabel),null!=d.queueHeight&&(this.queueHeight=d.queueHeight),null!=d.labelSize&&(this.labelSize=d.labelSize),null!=d.labelHeight&&(this.labelHeight=d.labelHeight),null!=d.pixelSpaceBetweenBlocks&&(this.pixelSpaceBetweenBlocks=d.pixelSpaceBetweenBlocks),null!=d.showTranscripts&&(this.showTranscripts=d.showTranscripts),null!=d.labelsNearEye&&(this.labelsNearEye=d.labelsNearEye),null!=d.showDetailGeneLabel&&(this.showDetailGeneLabel=
d.showDetailGeneLabel));this.queues=[];this.queues.push([])}MultiFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;MultiFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;MultiFeatureTrack.prototype.init=FeatureTrack.prototype.init;MultiFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;MultiFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;MultiFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;
MultiFeatureTrack.prototype.select=FeatureTrack.prototype.select;MultiFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;MultiFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;MultiFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;MultiFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;MultiFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;MultiFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;
MultiFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;MultiFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;MultiFeatureTrack.prototype.mouseUp=FeatureTrack.prototype.mouseUp;MultiFeatureTrack.prototype.mouseClick=FeatureTrack.prototype.mouseClick;MultiFeatureTrack.prototype.mouseDown=FeatureTrack.prototype.mouseDown;MultiFeatureTrack.prototype._addFeatures=FeatureTrack.prototype._addFeatures;
MultiFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;MultiFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;MultiFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;MultiFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;MultiFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;
MultiFeatureTrack.prototype._renderLabel=function(a,b,c,d){return SVG.drawText(a,b,c,this.labelNodeGroup,d)};
MultiFeatureTrack.prototype._setTextAttributes=function(a){var b=[["fill","black"],["id",this.id+"_"+a.id],["cursor","pointer"],["font-size",this.labelSize]];a instanceof TranscriptFeatureFormatter&&this.showExonLabel&&b.push(["opacity",0]);a instanceof ExonFeatureFormatter&&this.onMouseOverShitExonTranscriptLabel&&b.push(["opacity",0]);a instanceof ExonFeatureFormatter&&!this.showExonLabell&&b.push(["opacity",0]);return b};
MultiFeatureTrack.prototype.drawLabelAtPosition=function(a,b){for(var c=[],d=[],e=0;e<b.length;e++)null!=b[e+1]&&b[e+1]instanceof ExonFeatureFormatter?d.push(b[e].getId()):c.push(b[e].getId());for(e=0;e<this.labelNodeGroup.childElementCount;e++){this.labelNodeGroup.childNodes[e].setAttribute("opacity",0);for(var f=0;f<c.length;f++)-1!=c[f].indexOf(this.labelNodeGroup.childNodes[e].getAttribute("id").replace(this.id+"_",""))&&(this.labelNodeGroup.childNodes[e].setAttribute("x",this._convertGenomePositionToPixelPosition(a)),
this.labelNodeGroup.childNodes[e].setAttribute("opacity",1));for(f=0;f<d.length;f++)-1!=d[f].indexOf(this.labelNodeGroup.childNodes[e].getAttribute("id").replace(this.id+"_",""))&&this.labelNodeGroup.childNodes[e].setAttribute("opacity",0)}};
MultiFeatureTrack.prototype._updateTop=function(){var a=this.height;this.avoidOverlapping&&(a=this.label?(this.featureHeight+this.labelHeight+this.separatorBetweenQueue)*this.queues.length:this.featureHeight*this.queues.length);this.maxHeight<a&&(this.maxHeight=a,this.onMaximumHeightChanged.notify());null!=this.backgroundNode&&this.backgroundNode.setAttribute("height",this.maxHeight);this.height=this.maxHeight};MultiFeatureTrack.prototype.appendFeatures=function(a){this.drawFeatures(a.toJSON())};
MultiFeatureTrack.prototype.clear=function(){if(null!=this.mainNodeGroup)for(;0<this.mainNodeGroup.childNodes.length;)this.mainNodeGroup.removeChild(this.mainNodeGroup.childNodes[0]);this.featuresID={};this.maxHeight=this.originalHeight};
MultiFeatureTrack.prototype._addFeatures=function(a){null==this.geneBlockManager&&(this.geneBlockManager=new GeneBlockManager);this.features=0!=a.toJSON().lenth&&!a.toJSON()[0]instanceof GeneFeatureFormatter?this.geneBlockManager.toDatasetFormatter(a.toJSON()):a.toJSON();this.featuresIndex={}};
MultiFeatureTrack.prototype._setAttributes=function(a,b){var c=[["id",this.id+"_"+a.name],["style","cursor:pointer"]];c.push(["fill-opacity",a.getDefault().getOpacity()]);c.push(["stroke",a.getDefault().getStroke()]);c.push(["stroke-width",a.getDefault().getStrokeWidth()]);c.push(["stroke-opacity",a.getDefault().getStrokeOpacity()]);null!=b?b||c.push(["fill","white"]):null==this.forceColor?c.push(["fill",a.getDefault().getFill()]):c.push(["fill",this.forceColor]);return c};
MultiFeatureTrack.prototype._searchSpace=function(a,b){for(var c=b;c<this.queues.length;c++){for(var d=[],e=0;e<this.queues[c].length;e++){var f=this.queues[c][e];d.push(this._overlapBlocks(a,f));d.push(this._overlapBlocks(f,a))}if(-1==d.valueOf(d).indexOf(!0))return c}this.queues.push([]);return this.queues.length-1};MultiFeatureTrack.prototype.isFeatureDuplicated=function(a){return null!=this.featuresID[a.id]};
MultiFeatureTrack.prototype._render=function(){this.init();this.isAvalaible&&null!=this.features&&this.drawFeatures(this.features);this.queues=[];this.queues.push([])};
MultiFeatureTrack.prototype.drawFeatures=function(a){0<a.length&&!1==a[0]instanceof GeneFeatureFormatter&&(a=(new GeneBlockManager).toDatasetFormatter(a));for(var b=0;b<a.length;b++){var c=a[b];if(!this.allowDuplicates)if(this.isFeatureDuplicated(a[b]))continue;else this.featuresID[a[b].id]=!0;if(c instanceof GeneFeatureFormatter){var d=this._searchSpace(c,0);this.queues[d].push(c);this.drawFeaturesInQueue(c,d);if(null!=c.transcript&&this.showTranscripts)for(var e=0;e<c.transcript.length;e++){var f=
c.transcript[e],g=this._searchSpace(f,Math.ceil(d)+1);this.queues[g].push(f);this.drawFeaturesInQueue(f,g);for(var h=0;h<f.exon.length;h++)this.drawFeaturesInQueue(f.exon[h],g,f)}}}this._updateTop()};
MultiFeatureTrack.prototype.drawFeaturesInQueue=function(a,b,c){var d=(a.end-a.start+1)*this.pixelRatio,e=(a.start-1)*this.pixelRatio,f=this.top+b*this.featureHeight;this.label&&(f=this.top+b*(this.featureHeight+this.labelHeight+this.separatorBetweenQueue));if(null==c)this._drawFeature(e%this.viewBoxModule,f,Math.ceil(d),this._setAttributes(a),a);else{var b=e%this.viewBoxModule,e=this._setAttributes(a),g=this._setAttributes(a,!1);if(c.feature.codingRegionStart<=a.start&&c.feature.codingRegionEnd>=
a.end)this._drawFeature(b,f,Math.ceil(d),e,a);else if(a.start>=c.feature.codingRegionEnd||a.end<=c.feature.codingRegionStart)this._drawFeature(b,f,Math.ceil(d),g,a);else{var d=this._convertGenomePositionToPixelPosition(c.feature.codingRegionStart),h=this._convertGenomePositionToPixelPosition(c.feature.codingRegionEnd),i=this._convertGenomePositionToPixelPosition(a.start),j=this._convertGenomePositionToPixelPosition(a.end+1);a.start<=c.feature.codingRegionStart&&a.end<=c.feature.codingRegionEnd?(this._drawFeature(i,
f,d-b,g,a),this._drawFeature(d,f,j-d,e,a)):a.start>=c.feature.codingRegionStart&&a.end>=c.feature.codingRegionEnd?(this._drawFeature(h,f,j-h,g,a),this._drawFeature(i,f,h-i,e,a)):a.start<=c.feature.codingRegionStart&&a.end>=c.feature.codingRegionEnd&&(this._drawFeature(i,f,d-i,g,a),this._drawFeature(h,f,j-h,g,a),this._drawFeature(d,f,h-d,e,a))}}};
MultiFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){var f=this;e instanceof TranscriptFeatureFormatter?SVG.drawLine(a,b+this.featureHeight/2,a+Math.ceil(c),b+this.featureHeight/2,this.trackNodeGroup,this._setAttributes(e)):(c=SVG.drawRectangle(Math.ceil(a),Math.ceil(b),c,this.featureHeight,this.trackNodeGroup,d),c.addEventListener("mouseover",function(a){f._featureOver(e,this,a)},!0),c.addEventListener("mouseout",function(a){f._featureOut(e,this,a)},!0),c.addEventListener("click",function(a){f.clickOn(e,
this,a)},!0));this.label&&(c=this.getLabel(e),null!=c&&(a=this._renderLabel(Math.ceil(a),Math.ceil(b)+(this.featureHeight+this.labelHeight),c,this._setTextAttributes(e)),a.addEventListener("mouseover",function(a){f._featureOver(e,this,a)},!0),a.addEventListener("mouseout",function(a){f._featureOut(e,this,a)},!0),a.addEventListener("click",function(a){f.clickOn(e,this,a)},!0)))};
MultiFeatureTrack.prototype.getLabel=function(a){var b=a.label;return a instanceof GeneFeatureFormatter&&this.showDetailGeneLabel?a.getDetailLabel():a instanceof ExonFeatureFormatter?this.showExonLabel?a.label:"":a instanceof TranscriptFeatureFormatter?a.label:b};MultiFeatureTrack.prototype.clickOn=function(a){a instanceof TranscriptFeatureFormatter&&(new TranscriptInfoWidget(null,this.species)).draw(a);a instanceof GeneFeatureFormatter&&(new GeneInfoWidget(null,this.species)).draw(a);this.onClick.notify(a)};
MultiFeatureTrack.prototype._featureOut=function(a,b){b.setAttribute("stroke-width","0.5");b.setAttribute("opacity",this.lastOpacity);this.tooltippanel.destroy()};MultiFeatureTrack.prototype._featureOver=function(a,b,c){this.lastOpacity=b.getAttribute("opacity");b.setAttribute("stroke-width","1");b.setAttribute("opacity","0.6");this.tooltippanel=new TooltipPanel;this.tooltippanel.getPanel(a).showAt(c.clientX,c.clientY)};
function ExonFeatureTrack(a,b,c){FeatureTrack.prototype.constructor.call(this,a,b,c);this.drawBlocks=!0;this.sizeBetweenBlocks=90}ExonFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;ExonFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;ExonFeatureTrack.prototype.render=FeatureTrack.prototype.render;ExonFeatureTrack.prototype.init=FeatureTrack.prototype.init;ExonFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;
ExonFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;ExonFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;ExonFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;ExonFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;ExonFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;ExonFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;ExonFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;
ExonFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;ExonFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;ExonFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;ExonFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;ExonFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;ExonFeatureTrack.prototype.mouseUp=FeatureTrack.prototype.mouseUp;ExonFeatureTrack.prototype.mouseClick=FeatureTrack.prototype.mouseClick;
ExonFeatureTrack.prototype.mouseDown=FeatureTrack.prototype.mouseDown;ExonFeatureTrack.prototype._render=FeatureTrack.prototype._render;ExonFeatureTrack.prototype._addFeatures=FeatureTrack.prototype._addFeatures;ExonFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._addFeatures;ExonFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;ExonFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;
ExonFeatureTrack.prototype.addFeatures=function(a){this.drawFeatures(a[0])};ExonFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON()[0];this.featuresIndex={}};ExonFeatureTrack.prototype._setAttributes=function(a){a=[["fill",this.getFeatureColor(a)],["id",this.id+"_"+a.start],["font-size","10"]];a.push(["opacity","1"]);a.push(["stroke","black"]);a.push(["stroke-width","0.5"]);return a};ExonFeatureTrack.prototype.getFeatureColor=function(){return"red"};
ExonFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){SVG.drawRectangle(Math.ceil(a),Math.ceil(b),c,this.featureHeight,this.trackNodeGroup,d).addEventListener("mouseover",function(){console.log(e)},!1)};function TranscriptFeatureTrack(a,b,c){FeatureTrack.prototype.constructor.call(this,a,b,c);this.drawBlocks=!0;this.sizeBetweenBlocks=90}TranscriptFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;TranscriptFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;
TranscriptFeatureTrack.prototype.render=FeatureTrack.prototype.render;TranscriptFeatureTrack.prototype.init=FeatureTrack.prototype.init;TranscriptFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;TranscriptFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;TranscriptFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;TranscriptFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;
TranscriptFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;TranscriptFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;TranscriptFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;TranscriptFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;TranscriptFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;TranscriptFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;
TranscriptFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;TranscriptFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;TranscriptFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;TranscriptFeatureTrack.prototype.mouseUp=FeatureTrack.prototype.mouseUp;TranscriptFeatureTrack.prototype.mouseClick=FeatureTrack.prototype.mouseClick;TranscriptFeatureTrack.prototype.mouseDown=FeatureTrack.prototype.mouseDown;
TranscriptFeatureTrack.prototype._render=FeatureTrack.prototype._render;TranscriptFeatureTrack.prototype._addFeatures=FeatureTrack.prototype._addFeatures;TranscriptFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._addFeatures;TranscriptFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;TranscriptFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;
TranscriptFeatureTrack.prototype.addFeatures=function(a){this.drawFeatures(a[0])};TranscriptFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON()[0];this.featuresIndex={}};TranscriptFeatureTrack.prototype._setAttributes=function(a){a=[["fill",this.getFeatureColor(a)],["id",this.id+"_"+a.start],["font-size","10"]];a.push(["opacity","1"]);a.push(["stroke","black"]);a.push(["stroke-width","0.5"]);return a};
TranscriptFeatureTrack.prototype._setExonAttributes=function(a){this.getFeatureColor(a);a=[["fill","red"],["id",this.id+"_"+a.start],["font-size","10"]];a.push(["opacity","1"]);a.push(["stroke","black"]);a.push(["stroke-width","0.5"]);return a};TranscriptFeatureTrack.prototype.getFeatureColor=function(){return"orange"};
TranscriptFeatureTrack.prototype._setTextAttributes=function(a){this.getFeatureColor(a);a=[["fill","black"],["id",this.id+"_"+a.start],["font-size",this.titleFontSize]];a.push(["opacity","1"]);return a};TranscriptFeatureTrack.prototype._drawExon=function(){};
TranscriptFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){if(null!=e.exon){a=null;c=this.featureHeight/2;for(d=0;d<e.exon.length;d++){var f=this._convertGenomePositionToPixelPosition(e.exon[d].start),g=this._getFeatureWidth(e.exon[d]);SVG.drawRectangle(Math.ceil(f),Math.ceil(b),g,this.featureHeight,this.trackNodeGroup,this._setExonAttributes(e.exon[d]));0==d?(a=this._convertGenomePositionToPixelPosition(e.exon[d].start),SVG.drawText(Math.ceil(a)+3,Math.ceil(b)+this.height-2,e.externalName,
this.trackNodeGroup,this._setTextAttributes(e))):SVG.drawLine(a,b+c,Math.ceil(f),b+c,this.trackNodeGroup,this._setExonAttributes(e.exon[d]));a=f+g}}};
function RuleFeatureTrack(a,b,c,d){FeatureTrack.prototype.constructor.call(this,a,b,c,d);this.horizontalRuleDrawn=!1;this.expandRuleHeight=this.ruleHeight=this.height;this.horizontalRuleTop=this.height-2;null!=d&&(null!=d.expandRuleHeight&&(this.ruleHeight=d.expandRuleHeight),null!=d.space&&(this.space=d.space));this.allowDuplicates=!0;this.quarter=(this.end-this.start)/4;this.selectedMiddleLine=null}RuleFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;
RuleFeatureTrack.prototype.render=FeatureTrack.prototype.render;RuleFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;RuleFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;RuleFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;RuleFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;RuleFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;RuleFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;
RuleFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;RuleFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;RuleFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;RuleFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;RuleFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;RuleFeatureTrack.prototype.mouseUp=FeatureTrack.prototype.mouseUp;RuleFeatureTrack.prototype.mouseClick=FeatureTrack.prototype.mouseClick;
RuleFeatureTrack.prototype.mouseDown=FeatureTrack.prototype.mouseDown;RuleFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;RuleFeatureTrack.prototype._render=FeatureTrack.prototype._render;RuleFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;RuleFeatureTrack.prototype._updateTop=FeatureTrack.prototype._updateTop;RuleFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;
RuleFeatureTrack.prototype.isFeatureDuplicated=FeatureTrack.prototype.isFeatureDuplicated;RuleFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;RuleFeatureTrack.prototype.init=FeatureTrack.prototype.init;RuleFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;RuleFeatureTrack.prototype.moveY=FeatureTrack.prototype.moveY;RuleFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._setAttributes;RuleFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;
RuleFeatureTrack.prototype.drawFeaturesInQueue=FeatureTrack.prototype.drawFeaturesInQueue;RuleFeatureTrack.prototype.appendFeatures=function(a){this.drawFeatures(a.toJSON())};RuleFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.horizontalRuleDrawn=!1};RuleFeatureTrack.prototype.getFeatureColor=function(){return"#000000"};
RuleFeatureTrack.prototype.select=function(a,b){var c=1;null!=b&&null!=b.width&&(c=b.width);null!=this.selectedMiddleLine&&this.selectedMiddleLine.parentNode.removeChild(this.selectedMiddleLine);null!=this.textMiddleLine&&this.textMiddleLine.parentNode.removeChild(this.textMiddleLine);if(null!=this.trackNodeGroup){var d=this._convertGenomePositionToPixelPosition(a);this.selectedMiddleLine=SVG.drawRectangle(d,this.top+this.horizontalRuleTop,c,this.ruleHeight+1E4,this.trackNodeGroup,[["fill","green"],
["stroke-width","1"],["opacity",0.5]]);this.textMiddleLine=SVG.drawText(Math.ceil(d)-15,this.top+this.horizontalRuleTop,this._prettyNumber(a),this.trackNodeGroup,[["font-size","9"],["fill","green"]])}};
RuleFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){null!=this.trackNodeGroup&&(e.isLabeled?(SVG.drawText(Math.ceil(a)+2,b+10,this._prettyNumber(e.start),this.labelNodeGroup,[["font-size","10"]]),SVG.drawLine(Math.ceil(a),b,Math.ceil(a),this.ruleHeight+1E4,this.trackNodeGroup,[["stroke","#000000"],["opacity",e.getDefault().getOpacity()]])):SVG.drawLine(Math.ceil(a),b+this.horizontalRuleTop,Math.ceil(a),this.ruleHeight+1E4,this.trackNodeGroup,[["stroke","#000000"],["opacity",e.getDefault().getOpacity()]]),
this.horizontalRuleDrawn||(a=this.viewBoxModule,26E7*this.pixelRatio<this.viewBoxModule&&(a=26E7*this.pixelRatio),SVG.drawRectangle(0,b,a,this.height,this.trackNodeGroup,[["fill","gray"],["stroke","#000000"],["opacity",0.5]]),this.horizontalRuleDrawn=!0))};RuleFeatureTrack.prototype._prettyNumber=function(a){a=Math.ceil(a)+"";x=a.split(".");x1=x[0];x2=1<x.length?"."+x[1]:"";for(a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return x1+x2};GeneBoxFeatureTrack.prototype.createSVGDom=Track.prototype.createSVGDom;
GeneBoxFeatureTrack.prototype.init=Track.prototype.init;GeneBoxFeatureTrack.prototype.mouseMove=Track.prototype.mouseMove;GeneBoxFeatureTrack.prototype.mouseUp=Track.prototype.mouseUp;GeneBoxFeatureTrack.prototype.mouseClick=Track.prototype.mouseClick;GeneBoxFeatureTrack.prototype.mouseDown=Track.prototype.mouseDown;GeneBoxFeatureTrack.prototype._getViewBoxCoordenates=Track.prototype._getViewBoxCoordenates;GeneBoxFeatureTrack.prototype._goToCoordinate=Track.prototype._goToCoordinate;
GeneBoxFeatureTrack.prototype._startDragging=Track.prototype._startDragging;GeneBoxFeatureTrack.prototype._dragging=Track.prototype._dragging;GeneBoxFeatureTrack.prototype._getSVGCoordenates=Track.prototype._getSVGCoordenates;GeneBoxFeatureTrack.prototype._stopDragging=Track.prototype._stopDragging;GeneBoxFeatureTrack.prototype._render=Track.prototype._render;
function GeneBoxFeatureTrack(a,b,c){Track.prototype.constructor.call(this,a,b,c);this.viewBoxModule=this.pixelPerRatio=10;this.targetID=b.id;this.features=null;this.featureHeight=8;this.viewBoxModule=null;null!=c&&(null!=c.featureHeight&&(this.featureHeight=c.featureHeight),null!=c.blocks&&(this.drawBlocks=c.blocks),null!=c.viewBoxModule&&(this.viewBoxModule=c.viewBoxModule),null!=c.pixelPerRatio&&(this.pixelPerRatio=c.pixelPerRatio));this.geneTracks=[];this.transcriptTracks=[]}
GeneBoxFeatureTrack.prototype.getNewGeneTrack=function(){var a=5;0.0010==this.pixelRatio&&(a=5);0.0050==this.pixelRatio&&(a=7);return new GeneFeatureTrack("geneTrack",DOM.select(this.targetID),{top:0,left:0,right:this.width,width:this.width,start:this.start,end:this.end,height:this.getGeneTrackHeight(),backgroundColor:"#FFFFFF",titleColor:"#FFFFFF",titleFontSize:a,featureHeight:5,title:"Feature Track",pixelRatio:this.pixelRatio,viewBoxModule:this.viewBoxModule})};
GeneBoxFeatureTrack.prototype.getGeneTrackHeight=function(){return 15};GeneBoxFeatureTrack.prototype.getTranscriptTrackHeight=function(){return 7};
GeneBoxFeatureTrack.prototype.getNewTranscriptTrack=function(){var a=5;0.0010==this.pixelRatio&&(a=5);0.0050==this.pixelRatio&&(a=7);return new TranscriptFeatureTrack("geneTrack",DOM.select(this.targetID),{top:2,left:0,right:this.width,width:this.width,start:this.start,end:this.end,height:this.getTranscriptTrackHeight(),backgroundColor:"#FFFFFF",titleColor:"#FFFFFF",titleFontSize:a,featureHeight:3,title:"Feature Track",pixelRatio:this.pixelRatio,viewBoxModule:this.viewBoxModule})};
GeneBoxFeatureTrack.prototype.init=function(){for(var a=0;a<this.features.queues.length;a++)this.geneTracks.push(this.getNewGeneTrack())};GeneBoxFeatureTrack.prototype.changeView=function(a,b){this.start=a;this.end=b};GeneBoxFeatureTrack.prototype._render=function(){this.init();this.drawFeatures(this.features)};GeneBoxFeatureTrack.prototype.addFeatures=function(a){this.drawFeatures(a)};
GeneBoxFeatureTrack.prototype.drawFeatures=function(a){for(var b=this.top,c=0;c<this.geneTracks.length;c++)for(var d=0;d<this.features.queues[c].length;d++){var e=this.geneTracks[c].top;if(0<c){var f=this.features.queues[c][d];null!=a.overlappers[f.externalName]&&(b=a.genePerTranscriptQueue[f.externalName],b=this.top+(this.getGeneTrackHeight()*c+(b+1)*this.getTranscriptTrackHeight()))}f=[];f.push(this.features.queues[c][d]);this.geneTracks[c].draw(this._toDataset(f),this._svg,b);this.geneTracks[c].top=
e;e=b;b+=this.geneTracks[c].height;for(f=0;f<this.features.queues[c][d].transcript.length;f++){this.transcriptTracks.push(this.getNewTranscriptTrack());var g=[];g.push(this.features.queues[c][d].transcript[f]);this.transcriptTracks[this.transcriptTracks.length-1].draw(this._toDataset(g),this._svg,b);b+=this.getTranscriptTrackHeight()}b=e}};GeneBoxFeatureTrack.prototype._toDataset=function(a){var b=new DataSet,c=[];c.push(a);b.json=c;return b};
GeneBoxFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON().data};GeneBoxFeatureTrack.prototype.draw=function(a,b,c){null!=c&&(this.top+=c);null!=b&&(this._svg=b);this._addFeatures(a);this.changeView(this.start,this.end);this._render()};
function SNPFeatureTrack(a,b,c,d){FeatureTrack.prototype.constructor.call(this,a,b,c,d);this.forceColor=this.opacity=null;null!=d&&(null!=d.opacity&&(this.opacity=d.opacity),null!=d.forceColor&&(this.forceColor=d.forceColor));this.positions={}}SNPFeatureTrack.prototype._renderLabel=FeatureTrack.prototype._renderLabel;SNPFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;SNPFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;SNPFeatureTrack.prototype.render=FeatureTrack.prototype.render;
SNPFeatureTrack.prototype.init=FeatureTrack.prototype.init;SNPFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;SNPFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;SNPFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;SNPFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;SNPFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;SNPFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;
SNPFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;SNPFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;SNPFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;SNPFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;SNPFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;SNPFeatureTrack.prototype._render=FeatureTrack.prototype._render;SNPFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;
SNPFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;SNPFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;SNPFeatureTrack.prototype._updateTop=FeatureTrack.prototype._updateTop;SNPFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;SNPFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;SNPFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;SNPFeatureTrack.prototype.appendFeatures=FeatureTrack.prototype.appendFeatures;
SNPFeatureTrack.prototype.drawFeaturesInQueue=FeatureTrack.prototype.drawFeaturesInQueue;SNPFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._setAttributes;SNPFeatureTrack.prototype._setTextAttributes=FeatureTrack.prototype._setTextAttributes;SNPFeatureTrack.prototype.addFeatures=function(a){this.drawFeatures(a.toJSON())};SNPFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
SNPFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){1>=c&&(c=2);this.positions[Math.ceil(a)]=!0;SVG.drawRectangle(Math.ceil(a),b,c,this.featureHeight,this.trackNodeGroup,d);if(this.label&&(this._renderLabel(Math.ceil(a),Math.ceil(b)+(this.featureHeight+this.labelHeight),e.label,this._setTextAttributes(e),e),null!=e.base))for(var d=e.base.length,c=c/d,f=0;f<d;f++)SVG.drawText(f*c+a+2,Math.ceil(b)+8,e.base[f],this.labelNodeGroup,[["font-size","8"],["fill","black"]])};
VCFFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;VCFFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;VCFFeatureTrack.prototype.render=FeatureTrack.prototype.render;VCFFeatureTrack.prototype.init=FeatureTrack.prototype.init;VCFFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;VCFFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;VCFFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;
VCFFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;VCFFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;VCFFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;VCFFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;VCFFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;VCFFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;VCFFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;
VCFFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;VCFFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;VCFFeatureTrack.prototype._render=FeatureTrack.prototype._render;VCFFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;VCFFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;VCFFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;
VCFFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;VCFFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;VCFFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;VCFFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._setAttributes;VCFFeatureTrack.prototype._setTextAttributes=FeatureTrack.prototype._setTextAttributes;VCFFeatureTrack.prototype._updateTop=FeatureTrack.prototype._updateTop;VCFFeatureTrack.prototype.drawFeaturesInQueue=FeatureTrack.prototype.drawFeaturesInQueue;
VCFFeatureTrack.prototype._renderLabel=FeatureTrack.prototype._renderLabel;function VCFFeatureTrack(a,b,c){FeatureTrack.prototype.constructor.call(this,a,b,c);this.positions={};this.counter=0;console.log(this.featureHeight)}VCFFeatureTrack.prototype.appendFeatures=function(a){this.drawFeatures(a.toJSON())};VCFFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
VCFFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){1>=c&&(c=2);this.positions[Math.ceil(a)]=!0;SVG.drawRectangle(Math.ceil(a),b,c,this.featureHeight,this.trackNodeGroup,d);if(null!=e.base)for(var d=e.base.length,c=c/d,f=0;f<d;f++)SVG.drawText(f*c+a+2,Math.ceil(b)+8,e.base[f],this.labelNodeGroup,[["font-size","8"],["fill","#ffffff"]]);this.label&&this._renderLabel(Math.ceil(a),Math.ceil(b)+(this.featureHeight+this.labelHeight),e.label,this._setTextAttributes(e),e)};
HistogramFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;HistogramFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;HistogramFeatureTrack.prototype.render=FeatureTrack.prototype.render;HistogramFeatureTrack.prototype.init=FeatureTrack.prototype.init;HistogramFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;HistogramFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;HistogramFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;
HistogramFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;HistogramFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;HistogramFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;HistogramFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;HistogramFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;HistogramFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;HistogramFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;
HistogramFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;HistogramFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;HistogramFeatureTrack.prototype._render=FeatureTrack.prototype._render;HistogramFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;HistogramFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;
HistogramFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;HistogramFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;HistogramFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;HistogramFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;HistogramFeatureTrack.prototype.isFeatureDuplicated=FeatureTrack.prototype.isFeatureDuplicated;HistogramFeatureTrack.prototype.drawFeaturesInQueue=FeatureTrack.prototype.drawFeaturesInQueue;
function HistogramFeatureTrack(a,b,c,d){FeatureTrack.prototype.constructor.call(this,a,b,c,d);this.forceColor=this.opacity=null;this.intervalSize=2E6;null!=d&&(null!=d.opacity&&(this.opacity=d.opacity),null!=d.forceColor&&(this.forceColor=d.forceColor),null!=d.intervalSize&&(this.intervalSize=d.intervalSize));this.positions={};this.allowDuplicates=!0}
HistogramFeatureTrack.prototype.getFeaturesInterval=function(a){var b=[],c=this.intervalSize;if(0<a.length){for(var d=a[a.length-1].end,e=a[0].start;e<d;)b.push({start:e,end:e+c,value:0}),e+=c;for(e=d=c=0;e<a.length;e++)for(var f=c;f<b.length;f++)b[f].start<a[e].end&&b[f].end>a[e].start&&(b[f].value+=1,b[f].value>d&&(d=b[f].value),c=f)}for(e=0;e<b.length;e++)b[e].value/=d;return b};HistogramFeatureTrack.prototype.appendFeatures=function(a){this.drawFeatures(a.toJSON())};
HistogramFeatureTrack.prototype.sort=function(a,b){return a.start-b.start};HistogramFeatureTrack.prototype._addFeatures=function(a){this.featuresIndex={};this.features=a.toJSON()};HistogramFeatureTrack.prototype._updateTop=function(){if(this.avoidOverlapping)for(var a=0;a<this.queues.length;a++)this.height+=this.featureHeight};
HistogramFeatureTrack.prototype._setAttributes=function(a){a=[["id",this.id+"_"+a.start+"_"+a.id]];null!=this.forceColor?a.push(["fill",this.forceColor]):a.push(["fill","red"]);return a};HistogramFeatureTrack.prototype._setTextAttributes=function(a){return[["fill","black"],["id",this.id+"_"+a.start],["cursor","pointer"]]};
HistogramFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){var f=this;0>c&&(c=2);this.positions[Math.ceil(a)]=!0;SVG.drawRectangle(Math.ceil(a),b+(this.featureHeight-e.value*Math.abs(this.featureHeight)),c,e.value*Math.abs(this.featureHeight),this.trackNodeGroup,d);this.label&&SVG.drawText(Math.ceil(a)+12,Math.ceil(b)+this.featureHeight,e.label,this.labelNodeGroup,this._setTextAttributes(e)).addEventListener("click",function(){f.onClick.notify(e)},!0)};FeatureTrack.prototype.createSVGDom=Track.prototype.createSVGDom;
FeatureTrack.prototype.init=Track.prototype.init;FeatureTrack.prototype.mouseMove=Track.prototype.mouseMove;FeatureTrack.prototype.mouseUp=Track.prototype.mouseUp;FeatureTrack.prototype.mouseClick=Track.prototype.mouseClick;FeatureTrack.prototype.mouseDown=Track.prototype.mouseDown;FeatureTrack.prototype._getViewBoxCoordenates=Track.prototype._getViewBoxCoordenates;FeatureTrack.prototype._goToCoordinate=Track.prototype._goToCoordinate;FeatureTrack.prototype._startDragging=Track.prototype._startDragging;
FeatureTrack.prototype._dragging=Track.prototype._dragging;FeatureTrack.prototype._getSVGCoordenates=Track.prototype._getSVGCoordenates;FeatureTrack.prototype._stopDragging=Track.prototype._stopDragging;FeatureTrack.prototype.clear=Track.prototype.clear;FeatureTrack.prototype.drawBackground=Track.prototype.drawBackground;
function FeatureTrack(a,b,c,d){Track.prototype.constructor.call(this,a,b,d);this.species=c;this.viewBoxModule=this.features=null;this.avoidOverlapping=!1;this.pixelSpaceBetweenBlocks=0;this.allowDuplicates=!0;this.featuresID={};this.showLabelsOnMiddleMarker=this.label=!1;this.forceColor=null;this.labelHeight=12;this.separatorBetweenQueue=4;null!=d&&(null!=d.showLabelsOnMiddleMarker&&(this.showLabelsOnMiddleMarker=d.showLabelsOnMiddleMarker),null!=d.queueHeight&&(this.queueHeight=d.queueHeight),null!=
d.labelHeight&&(this.labelHeight=d.labelHeight),null!=d.featureHeight&&(this.featureHeight=d.featureHeight),null!=d.forceColor&&(this.forceColor=d.forceColor),null!=d.avoidOverlapping&&(this.avoidOverlapping=d.avoidOverlapping),null!=d.pixelSpaceBetweenBlocks&&(this.pixelSpaceBetweenBlocks=d.pixelSpaceBetweenBlocks),null!=d.viewBoxModule&&(this.viewBoxModule=d.viewBoxModule),null!=d.allowDuplicates&&(this.allowDuplicates=d.allowDuplicates),null!=d.label&&(this.label=d.label));this.queues=[];this.queues[0]=
[];this.queueHeight=this.labelHeight+this.featureHeight;this.positions={};this.onClick=new Event(this);this.onMouseOver=new Event(this);this.onMouseOut=new Event(this);this.onMaximumHeightChanged=new Event(this)}FeatureTrack.prototype._overlapBlocks=function(a,b){var c=this.pixelSpaceBetweenBlocks/this.pixelRatio;return a.start<b.end+c&&a.end+c>b.start?!0:!1};FeatureTrack.prototype._setTextAttributes=function(a){return[["fill","black"],["id",this.id+"_"+a.id],["cursor","pointer"],["font-size",this.labelSize]]};
FeatureTrack.prototype._searchSpace=function(a){for(var b=0;b<this.queues.length;b++){for(var c=[],d=0;d<this.queues[b].length;d++){var e=this.queues[b][d];c.push(this._overlapBlocks(a,e));c.push(this._overlapBlocks(e,a))}if(-1==c.valueOf(c).indexOf(!0))return b}this.queues.push([]);return this.queues.length-1};FeatureTrack.prototype.drawLabelByPosition=function(){};FeatureTrack.prototype.appendFeatures=function(a){this.drawFeatures(a.toJSON())};
FeatureTrack.prototype.isFeatureDuplicated=function(a){return this.featuresID[a.start+"_"+a.end]};FeatureTrack.prototype.moveY=function(a){this.mainNodeGroup.setAttribute("transform","translate(0, "+a+")")};
FeatureTrack.prototype.drawFeatures=function(a){this.queues=[];this.queues.push([]);for(var b=0;b<a.length;b++){if(!this.allowDuplicates)if(this.isFeatureDuplicated(a[b]))continue;else this.featuresID[a[b].start+"_"+a[b].end]=!0;var c=0,c=this.avoidOverlapping?this._searchSpace(a[b]):0;this.queues[c].push(a[b]);this.drawFeaturesInQueue(a[b],c)}this._updateTop()};FeatureTrack.prototype.drawLabelAtPosition=function(){};
FeatureTrack.prototype.drawFeaturesInQueue=function(a,b){var c=this._setAttributes(a),d=(a.end-a.start+1)*this.pixelRatio;0>a.end-a.start&&(d=(a.start-a.end)*this.pixelRatio);var e=(a.start-1)*this.pixelRatio,f=this.top+b*this.featureHeight;this.label&&(f=this.top+b*(this.featureHeight+this.labelHeight+this.separatorBetweenQueue));this._drawFeature(e%this.viewBoxModule,f,Math.ceil(d),c,a)};
FeatureTrack.prototype._updateTop=function(){var a=this.height;this.avoidOverlapping&&(a=this.label?(this.featureHeight+this.labelHeight+this.separatorBetweenQueue)*this.queues.length:this.featureHeight*this.queues.length);this.maxHeight<a&&(this.maxHeight=a,this.onMaximumHeightChanged.notify());null!=this.backgroundNode&&this.backgroundNode.setAttribute("height",this.maxHeight);this.height=this.maxHeight};
FeatureTrack.prototype._getFeatureWidth=function(a){return 0==a.end-a.start?(a.end+1-a.start)*this.pixelRatio:(a.end-a.start)*this.pixelRatio};FeatureTrack.prototype._convertGenomePositionToPixelPosition=function(a){return(a-1)*this.pixelRatio%this.viewBoxModule};
FeatureTrack.prototype._setAttributes=function(a){var b=[["id",this.id+"_"+a.name],["style","cursor:pointer"]];b.push(["fill-opacity",a.getDefault().getOpacity()]);b.push(["stroke",a.getDefault().getStroke()]);b.push(["stroke-width",a.getDefault().getStrokeWidth()]);b.push(["stroke-opacity",a.getDefault().getStrokeOpacity()]);null==this.forceColor?b.push(["fill",a.getDefault().getFill()]):b.push(["fill",this.forceColor]);return b};
FeatureTrack.prototype._drawFeature=function(a,b,c,d,e){1>=c&&(c=2);this.positions[Math.ceil(a)]=!0;SVG.drawRectangle(Math.ceil(a),b,c,this.featureHeight,this.trackNodeGroup,d);this.label&&this._renderLabel(Math.ceil(a),Math.ceil(b)+(this.featureHeight+this.labelHeight),e.label,this._setTextAttributes(e),e)};
FeatureTrack.prototype._renderLabel=function(a,b,c,d,e){var f=this,a=SVG.drawText(a,b,c,this.labelNodeGroup,d);a.addEventListener("click",function(){f.onClick.notify(e);try{var a=[];for(key in e.feature)a.push(key);e instanceof SNPFeatureFormatter&&(new SnpInfoWidget(null,f.species)).draw(e);e instanceof VCFFeatureFormatter&&(new VCFVariantInfoWidget(null,f.species)).draw(e)}catch(b){console.log(b)}},!0);a.addEventListener("mouseover",function(a){f.tooltippanel=new TooltipPanel;f.tooltippanel.getPanel(e).showAt(a.clientX,
a.clientY)},!0);a.addEventListener("mouseout",function(){f.tooltippanel.destroy()},!0)};FeatureTrack.prototype.getIdToPrint=function(a){return a.id};FeatureTrack.prototype._render=function(){this.init();this.isAvalaible&&null!=this.features&&this.drawFeatures(this.features)};
FeatureTrack.prototype.moveTitle=function(a){if(this.title){var b=parseFloat(this.titleNodeGroup.getAttribute("moveX"));desplazamiento=b?parseFloat(parseFloat(a)+parseFloat(b)):a;this.titleNodeGroup.setAttribute("transform","translate("+-desplazamiento+", 0)");this.titleNodeGroup.setAttribute("moveX",desplazamiento)}};
FeatureTrack.prototype.drawTitle=function(a){a=this._convertGenomePositionToPixelPosition(a);null!=this.titleRectangle&&this.titleRectangle.parentNode.removeChild(this.titleRectangle);null!=this.titleText&&this.titleText.parentNode.removeChild(this.titleText);if(this.isAvalaible){var b=[["fill","#FFFFFF"],["stroke","#000000"],["opacity",0.7],["rx",4],["ry",4],["id"]];this.titleRectangle=SVG.drawRectangle(a,this.top,this.titleWidth,this.height,this.titleNodeGroup,b);this.titleText=SVG.drawText(a+2,
this.top+this.titleHeight-3,this.titleName,this.titleNodeGroup,[["font-size",this.titleFontSize]])}else b=[["fill","#FFFFCC"],["stroke","#000000"],["opacity",0.7],["rx",0],["ry",0]],SVG.drawRectangle(a,this.top,this.width,this.height,this.titleNodeGroup,b),SVG.drawText(a+2,this.top+this.height-4,this.titleName+": "+this.isNotAvalaibleMessage,this.titleNodeGroup,[["font-size",this.titleFontSize]])};FeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
FeatureTrack.prototype.draw=function(a,b,c){this.top=c;null!=b&&(this._svg=b);null!=a.toJSON()&&this._addFeatures(a);this._render()};FeatureTrack.prototype.mouseclick=function(){};function RegionFeatureTrack(a,b,c){FeatureTrack.prototype.constructor.call(this,a,b,c);this.forceColor=this.opacity=null;null!=c&&(null!=c.opacity&&(this.opacity=c.opacity),null!=c.forceColor&&(this.forceColor=c.forceColor));this.positions={}}RegionFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;
RegionFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;RegionFeatureTrack.prototype.render=FeatureTrack.prototype.render;RegionFeatureTrack.prototype.init=FeatureTrack.prototype.init;RegionFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;RegionFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;RegionFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;RegionFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;
RegionFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;RegionFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;RegionFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;RegionFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;RegionFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;RegionFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;RegionFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;
RegionFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;RegionFeatureTrack.prototype._render=FeatureTrack.prototype._render;RegionFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;RegionFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;RegionFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;RegionFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;
RegionFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;RegionFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;RegionFeatureTrack.prototype.moveY=FeatureTrack.prototype.moveY;RegionFeatureTrack.prototype.appendFeatures=function(a){this.drawFeatures(a.toJSON())};RegionFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
RegionFeatureTrack.prototype._updateTop=function(){var a=this.height;this.avoidOverlapping&&(a=this.featureHeight+12*this.queues.length);this.maxHeight<a&&(this.maxHeight=a);this.height=this.maxHeight;null!=this.backgroundNode&&this.backgroundNode.setAttribute("height",this.maxHeight)};
RegionFeatureTrack.prototype._setAttributes=function(a){a=[["id",this.id+"_"+a.start+"_"+a.id],["font-size",a.getDefault().args.fontSize]];a.push(["fill","red"]);a.push(["opacity","0.6"]);a.push(["stroke","black"]);a.push(["stroke-width","1"]);return a};RegionFeatureTrack.prototype._setTextAttributes=function(a){this.getFeatureColor(a);return[["fill","black"],["id",this.id+"_"+a.start],["cursor","pointer"],["font-size",a.getDefault().args.fontSize]]};
RegionFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){this.positions[Math.ceil(a)]=!0;SVG.drawRectangle(Math.ceil(a),b,Math.abs(c),Math.abs(this.featureHeight),this.trackNodeGroup,d);if(this.label){var f=this;SVG.drawText(Math.ceil(a),Math.ceil(b)+2*this.featureHeight-2,e.label,this.trackNodeGroup,this._setTextAttributes(e)).addEventListener("click",function(){f.onClick.notify(e)},!0)}};
function SequenceFeatureTrack(a,b,c,d){FeatureTrack.prototype.constructor.call(this,a,b,c,d);this.avoidOverlapping=!1}SequenceFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;SequenceFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;SequenceFeatureTrack.prototype.render=FeatureTrack.prototype.render;SequenceFeatureTrack.prototype.init=FeatureTrack.prototype.init;SequenceFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;
SequenceFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;SequenceFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;SequenceFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;SequenceFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;SequenceFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;SequenceFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;
SequenceFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;SequenceFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;SequenceFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;SequenceFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;SequenceFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;SequenceFeatureTrack.prototype.mouseUp=FeatureTrack.prototype.mouseUp;SequenceFeatureTrack.prototype.mouseClick=FeatureTrack.prototype.mouseClick;
SequenceFeatureTrack.prototype.mouseDown=FeatureTrack.prototype.mouseDown;SequenceFeatureTrack.prototype._render=FeatureTrack.prototype._render;SequenceFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;SequenceFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;SequenceFeatureTrack.prototype._updateTop=FeatureTrack.prototype._updateTop;SequenceFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;
SequenceFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;SequenceFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;SequenceFeatureTrack.prototype.drawFeaturesInQueue=FeatureTrack.prototype.drawFeaturesInQueue;SequenceFeatureTrack.prototype.appendFeatures=function(a){this.features=a.toJSON();this.drawFeatures(this.features)};SequenceFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
SequenceFeatureTrack.prototype._setAttributes=function(a){a=[["fill",a.getDefault().getFill()],["id",this.id+"_"+a.start],["font-size","10"]];a.push(["opacity","1"]);return a};SequenceFeatureTrack.prototype._drawFeature=function(a,b,c,d,e){d.push(["opacity",0.8]);d.push(["stroke","black"]);SVG.drawRectangle(a,Math.ceil(b),this.pixelRatio,this.featureHeight,this.trackNodeGroup,d);SVG.drawText(a+2,Math.ceil(b)+8,e.label,this.labelNodeGroup,[["font-size","8"]])};
SequenceFeatureTrack.prototype.getTextId=function(a){return"id_seq_"+a};SequenceFeatureTrack.prototype._textId=function(a,b,c,d,e){SVG.drawText(Math.ceil(a)+2,Math.ceil(b)+8,e.base,this.trackNodeGroup,[["font-size","8"],["id",this.getTextId(a)]])};SequenceFeatureTrack.prototype._removeTextBase=function(a){this.trackNodeGroup.removeChild(DOM.select(this.getTextId(a)))};
SequenceFeatureTrack.prototype._drawTextBase=function(a,b,c,d,e){SVG.drawText(Math.ceil(a)+2,Math.ceil(b)+8,e.base,this.trackNodeGroup,[["font-size","8"],["id","id_seq_"+a]])};function GeneFeatureTrack(a,b,c){FeatureTrack.prototype.constructor.call(this,a,b,c);this.forceColor=this.opacity=null;null!=c&&(null!=c.opacity&&(this.opacity=c.opacity),null!=c.forceColor&&(this.forceColor=c.forceColor))}GeneFeatureTrack.prototype.isFeatureDuplicated=FeatureTrack.prototype.isFeatureDuplicated;
GeneFeatureTrack.prototype.getIdToPrint=FeatureTrack.prototype.getIdToPrint;GeneFeatureTrack.prototype.changeView=FeatureTrack.prototype.changeView;GeneFeatureTrack.prototype.render=FeatureTrack.prototype.render;GeneFeatureTrack.prototype.init=FeatureTrack.prototype.init;GeneFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;GeneFeatureTrack.prototype._getTopText=FeatureTrack.prototype._getTopText;GeneFeatureTrack.prototype._getTopFeatures=FeatureTrack.prototype._getTopFeatures;
GeneFeatureTrack.prototype._searchSpace=FeatureTrack.prototype._searchSpace;GeneFeatureTrack.prototype.drawTitle=FeatureTrack.prototype.drawTitle;GeneFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;GeneFeatureTrack.prototype.mouseclick=FeatureTrack.prototype.mouseclick;GeneFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;GeneFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;GeneFeatureTrack.prototype.getFeatureColor=FeatureTrack.prototype.getFeatureColor;
GeneFeatureTrack.prototype.drawFeatures=FeatureTrack.prototype.drawFeatures;GeneFeatureTrack.prototype._overlapBlocks=FeatureTrack.prototype._overlapBlocks;GeneFeatureTrack.prototype.mouseMove=FeatureTrack.prototype.mouseMove;GeneFeatureTrack.prototype.mouseUp=FeatureTrack.prototype.mouseUp;GeneFeatureTrack.prototype.mouseClick=FeatureTrack.prototype.mouseClick;GeneFeatureTrack.prototype.mouseDown=FeatureTrack.prototype.mouseDown;GeneFeatureTrack.prototype._render=FeatureTrack.prototype._render;
GeneFeatureTrack.prototype._addFeatures=FeatureTrack.prototype._addFeatures;GeneFeatureTrack.prototype._setAttributes=FeatureTrack.prototype._setAttributes;GeneFeatureTrack.prototype._convertGenomePositionToPixelPosition=FeatureTrack.prototype._convertGenomePositionToPixelPosition;GeneFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;GeneFeatureTrack.prototype._getFeatureWidth=FeatureTrack.prototype._getFeatureWidth;GeneFeatureTrack.prototype._updateTop=FeatureTrack.prototype._updateTop;
GeneFeatureTrack.prototype.clear=FeatureTrack.prototype.clear;GeneFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;GeneFeatureTrack.prototype.moveTitle=FeatureTrack.prototype.moveTitle;GeneFeatureTrack.prototype.addFeatures=function(a){this.drawFeatures(a.toJSON())};GeneFeatureTrack.prototype._addFeatures=function(a){this.features=a.toJSON();this.featuresIndex={}};
GeneFeatureTrack.prototype._setAttributes=function(a){var b=[["id",this.id],["font-size",a.getDefault().args.fontSize]];null==this.opacity?b.push(["opacity",a.getDefault().getOpacity()]):b.push(["opacity",this.opacity]);null==this.forceColor?b.push(["fill",a.getDefault().getFill()]):b.push(["fill",this.forceColor]);b.push(["stroke","black"]);b.push(["stroke-width","1"]);return b};
GeneFeatureTrack.prototype._setTextAttributes=function(a){this.getFeatureColor(a);return[["fill","black"],["id",this.id+"_"+a.start],["font-size",a.getDefault().args.fontSize]]};GeneFeatureTrack.prototype._drawFeature=function(a,b,c,d){SVG.drawRectangle(Math.ceil(a),Math.ceil(b),c,this.featureHeight,this.trackNodeGroup,d).addEventListener("mouseover",function(){},!0)};ChromosomeFeatureTrack.prototype.createSVGDom=FeatureTrack.prototype.createSVGDom;ChromosomeFeatureTrack.prototype.init=FeatureTrack.prototype.init;
ChromosomeFeatureTrack.prototype.draw=FeatureTrack.prototype.draw;ChromosomeFeatureTrack.prototype._render=FeatureTrack.prototype._render;ChromosomeFeatureTrack.prototype.getById=FeatureTrack.prototype.getById;ChromosomeFeatureTrack.prototype._getViewBoxCoordenates=FeatureTrack.prototype._getViewBoxCoordenates;ChromosomeFeatureTrack.prototype._getSVGCoordenates=FeatureTrack.prototype._getSVGCoordenates;ChromosomeFeatureTrack.prototype.drawBackground=FeatureTrack.prototype.drawBackground;
function ChromosomeFeatureTrack(a,b,c,d){FeatureTrack.prototype.constructor.call(this,a,b,c,d);this.selectcolor="#33FF33";this.markcolor="#FF3333";this.radio=3;this.markers={};this.start=1;this.vertical=this.labelChromosome=!1;this.rounded=7;this.label=!1;this.maxFeatureEnd=1;null!=d&&(null!=d.label&&(this.label=d.label),null!=d.labelChromosome&&(this.labelChromosome=d.labelChromosome),null!=d.vertical&&(this.vertical=d.vertical),null!=d.rounded&&(this.rounded=d.rounded),null!=d.bottom&&(this.bottom=
d.bottom));this.onMarkerClicked=new Event(this);this.selector={};this.selector.selectorIsMoving=!1;this.selector.selectorSVG=null;this.selector.selectorBorder=null;this.selector.start=null;this.selector.end=null;this.selector.mouseOffsetX=null}ChromosomeFeatureTrack.prototype.getCentromeros=function(){for(var a=[],b=0;b<this.features.length;b++)"acen"==this.features[b].stain&&a.push(this.features[b]);return a};
ChromosomeFeatureTrack.prototype.getEnd=function(a){for(var b=0,c=0;c<a.length;c++)a[c].end>b&&(b=a[c].end);return b};ChromosomeFeatureTrack.prototype.getColorByStain=function(a){if("gneg"==a.stain)return"white";if("stalk"==a.stain)return"#666666";if("gvar"==a.stain)return"#CCCCCC";if(-1!=a.stain.indexOf("gpos")){var b=a.stain.replace("gpos","");if(25==b)return"silver";if(50==b)return"gray";if(75==b)return"darkgray";if(100==b)return"black"}return"acen"==a.stain?"blue":"purple"};
ChromosomeFeatureTrack.prototype.getPixelScale=function(){return this.vertical?(this.bottom-this.top)/(this.end-this.start):(this.right-this.left)/(this.end-this.start)};ChromosomeFeatureTrack.prototype.setBackgroundColor=function(a){this.backgroundSVGNode.setAttribute("fill",a);"white"==a?this.backgroundSVGNode.setAttribute("stroke","white"):this.backgroundSVGNode.setAttribute("stroke","black")};
ChromosomeFeatureTrack.prototype.unmark=function(){for(var a in this.markers)this.trackNodeGroup.removeChild(DOM.select(a));this.markers={}};ChromosomeFeatureTrack.prototype.getMarkIDFromFeature=function(a){var b=a.chromosome+"_"+a.start+"_"+a.end;this.markers[b]=a;return b};
ChromosomeFeatureTrack.prototype.mark=function(a,b){var c=this,d=this.getPixelScale(),e=a.start,f=a.end,g=(f-e)*d;e==f&&(g=1);null!=b&&(this.markcolor=b);if(this.vertical){var g=this.top+e*d,d=[["stroke","black"],["stroke-width","1"],["id",this.getMarkIDFromFeature(a)],["fill",this.markcolor],["opacity","1"],["cursor","pointer"]],h=SVG.drawPoligon([[this.right+6,g-3],[this.right,g],[this.right+6,g+3]],this.trackNodeGroup,d);h.addEventListener("click",function(){c.onMarkerClicked.notify(c.markers[h.id])},
!0)}else e=this.left+e*d,d=[["id",this.markers.length],["fill",this.markcolor],["opacity","1"]],SVG.drawRectangle(e,this.top,g,this.bottom-this.top+this.radio+5,this.trackNodeGroup,d),d=[["id",id],["fill",this.markcolor],["opacity","1"],["stroke","black"]],SVG.drawCircle(e,this.bottom+this.radio+5,this.radio,this.trackNodeGroup,d)};ChromosomeFeatureTrack.prototype.getSelectorId=function(){return this.id+"_selector"};
ChromosomeFeatureTrack.prototype.deselect=function(){var a=this.getSelectorId();null!=DOM.select(a)&&this.trackNodeGroup.removeChild(this.selector.selectorSVG)};
ChromosomeFeatureTrack.prototype.mouseMove=function(a){if(this.selector.selectorIsMoving&&null!=this.selector.selectorSVG){var b=this.getSVGCoordenates(a).x-this.selector.mouseOffsetX,c=this.getPixelScale(),b=parseFloat(this.selector.start)+parseFloat(Math.ceil(b/c));this.select(b,b+(this.selector.end-this.selector.start));this.selector.mouseOffsetX=this.getSVGCoordenates(a).x}};ChromosomeFeatureTrack.prototype.mouseDown=function(a){this.selector.selectorIsMoving=!0;this.selector.mouseOffsetX=this.getSVGCoordenates(a).x};
ChromosomeFeatureTrack.prototype.mouseUp=function(){this.selector.selectorIsMoving=!1;this.click.notify(this.selector.start+(this.selector.end-this.selector.start)/2)};
ChromosomeFeatureTrack.prototype.select=function(a,b){var c=this;this.selector.id=this.getSelectorId();this.selector.start=a;this.selector.end=b;b>this.maxFeatureEnd&&0<(this.maxFeatureEnd-a)*d&&(b=this.maxFeatureEnd);this.deselect();if(null!=this.trackNodeGroup){var d=this.getPixelScale();if(this.vertical){var d=this.getPixelScale(),e=Math.ceil(this.top+d*a),d=[["stroke","black"],["stroke-width","1"],["id",this.selector.id],["cursor","move"],["fill",this.selectcolor],["opacity","1"]];this.selector.selectorSVG=
SVG.drawPoligon([[0,e-5],[this.left,e],[0,e+5]],this.trackNodeGroup,d)}else{var e=this.left+a*d,f=Math.ceil((b-a)*d),d=[["stroke","red"],["stroke-width","1"],["id",this.selector.id],["cursor","move"],["fill",this.selectcolor],["fill-opacity","0.1"]];this.selector.selectorSVG=SVG.drawRectangle(e,this.top+6,f,this.bottom-this.top,this.trackNodeGroup,d);this.selector.selectorSVG.addEventListener("mousemove",function(a){c.mouseMove(a,c)},!1);this.selector.selectorSVG.addEventListener("mousedown",function(a){c.mouseDown(a,
c)},!1);this.selector.selectorSVG.addEventListener("mouseup",function(a){c.mouseUp(a,c)},!1)}}};
ChromosomeFeatureTrack.prototype.drawFeatures=function(){var a=this.getCentromeros();this.pixelInc=this.getPixelScale();var b=0;0!=a.length?(b=a[0].end*this.pixelInc,this.centromerosVisited=!1):this.centromerosVisited=!0;a=[["stroke","black"],["stroke-width","1"],["id","clip"],["fill","pink"],["rx",this.rounded],["ry",this.rounded],["z-index","0"]];if(this.vertical){this.featureHeight=this.right-this.left-1;var c=b+this.top,d=this.bottom-b-this.top,e=SVG.createRectangle(this.left,c,this.featureHeight,
d,a);this.trackNodeGroup.appendChild(e);e=SVG.createRectangle(this.left,c,this.featureHeight,d,a);this.trackNodeGroup.appendChild(e);SVG.drawClip("clip_1"+this.id,e,this.trackNodeGroup);this.groupNodeFirstCentromero=SVG.drawGroup(this.trackNodeGroup,[["id","clip_group"],["clip-path","url(#clip_1"+this.id+")"]]);c=this.top;d=b;e=SVG.createRectangle(this.left,c+1,this.featureHeight,d,a);this.trackNodeGroup.appendChild(e);e=SVG.createRectangle(this.left,c+1,this.featureHeight,d,a)}else this.featureHeight=
Math.ceil(this.bottom-this.top),e=SVG.createRectangle(this.left,this.top+6,b,this.featureHeight,a),this.trackNodeGroup.appendChild(e),e=SVG.createRectangle(this.left,this.top+6,b,this.featureHeight,a),this.trackNodeGroup.appendChild(e),SVG.drawClip("clip_1"+this.id,e,this.trackNodeGroup),this.groupNodeFirstCentromero=SVG.drawGroup(this.trackNodeGroup,[["id","clip_group"],["clip-path","url(#clip_1"+this.id+")"]]),c=Math.ceil(b+this.left),b=Math.ceil(this.right-b-this.left-2),e=SVG.createRectangle(c,
this.top+6,b,this.featureHeight,a),this.trackNodeGroup.appendChild(e),e=SVG.createRectangle(c,this.top+6,b,this.featureHeight,a);this.trackNodeGroup.appendChild(e);SVG.drawClip("clip_2"+this.id,e,this.trackNodeGroup);groupNodeSecondCentromero=SVG.drawGroup(this.trackNodeGroup,[["id","clip_group"],["clip-path","url(#clip_2"+this.id+")"]]);for(b=0;b<this.features.length;b++)a=this.features[b],this._drawCytoband(a),0==b&&this.label&&(e=[["id",this.id_+"title"],["font-size","9"]],this.vertical&&SVG.drawText(this.left,
this.height,a.chromosome,this.labelNodeGroup,e))};
ChromosomeFeatureTrack.prototype._drawCytoband=function(a){var b=this,c=stroke=this.getColorByStain(a),d=null,d=this.pixelInc*(a.end-a.start),c=[["fill",c],["id",this.id+"_"+a.cytoband],["z-index","10"],["stroke",stroke],["style","cursor:pointer"]];this.maxFeatureEnd<a.end&&(this.maxFeatureEnd=a.end);this.vertical?(d=SVG.createRectangle(Math.ceil(this.left),Math.ceil(this.top+this.pixelInc*(a.start-this.start)),Math.ceil(this.right-this.left),Math.ceil(d),c),this.centromerosVisited?this.groupNodeFirstCentromero.appendChild(d):
groupNodeSecondCentromero.appendChild(d)):(d=SVG.createRectangle(Math.ceil(this.left+this.pixelInc*(a.start-this.start)),this.top,d,Math.ceil(this.featureHeight)+6,c),this.centromerosVisited?groupNodeSecondCentromero.appendChild(d):this.groupNodeFirstCentromero.appendChild(d),this.label&&(c=[["fill","black"],["id",this.id_+"title"],["opacity","1"],["font-size","7"]],c.push(["transform","translate("+(this.left+this.pixelInc*(a.start+(a.end-a.start)/2-this.start))+", "+(this.height+10)+"), rotate(270)"]),
SVG.drawText(0,0,a.cytoband,this.labelNodeGroup,c)));d.addEventListener("click",function(c){b.vertical?b.click.notify(a):(c=b._getSVGCoordenates(c),c=Math.ceil((c.x-b.left)/b.pixelInc),b.click.notify(c))},!0);"acen"==a.stain&&(this.centromerosVisited=!0)};ChromosomeFeatureTrack.prototype.draw=function(a){this.features=a.toJSON()[0];this.featuresIndex={};this.printedFeature={};if(null!=this.features){for(a=0;a<this.features.length;a++)this.featuresIndex[this.features[a].id]=a;this.end=this.getEnd(this.features)}this._render()};
ChromosomeFeatureTrack.prototype.getSVGCoordenates=function(a){var b=this._svg.createSVGPoint();b.x=a.clientX;b.y=a.clientY;a=this._svg.getScreenCTM(document.documentElement);return b=b.matrixTransform(a.inverse())};function GenomeBrowser(){this.genomeViewer=new MasterSlaveGenomeViewer("id","container_map");this.karyotypeWidget=new KaryotypePanel("human","container_map_karyotype",{width:1E3,height:200,trackWidth:15})}
GenomeBrowser.prototype.draw=function(){var a=Ext.create("Ext.panel.Panel",{width:"1300",margins:"5 5 5 5",flex:3,html:'<div id = "container_map"></div>'}),b=Ext.create("Ext.panel.Panel",{width:"1300",margins:"5 5 5 5",html:'<div id = "coordinates"><form><label >Location:&nbsp;&nbsp;</label><input type="hidden" name="db" value="core"><input name="r" id="loc_r" class="location_selector" style="width:250px" value="6:133017695-133161157" type="text">&nbsp;&nbsp;<input value="Go" type="submit" class="go-button"></form></div>'}),
c=Ext.create("Ext.panel.Panel",{title:"bot",width:"100%",flex:1,split:!0,html:'<div id = "container_map_karyotype" style="padding:0 0 0 200;text-align: center;width:100%;" ></div>'}),d=function(a){"ZoomIn"==a&&genomeViewer.zoomIn();"ZoomOut"==a&&genomeViewer.zoomOut()},d=Ext.create("Ext.toolbar.Toolbar",{width:"100%",items:[{text:"Zoom In",iconCls:"add16",handler:Ext.Function.pass(d,"ZoomIn")},{text:"Zoom Out",iconCls:"add16",handler:Ext.Function.pass(d,"ZoomOut")}]}),a=Ext.create("Ext.panel.Panel",
{layout:"vbox",region:"center",margins:5,items:[d,a,b,c]}),b=Ext.create("Ext.Panel",{title:"Control",html:"&lt;empty panel&gt;",cls:"empty"}),c=Ext.create("Ext.Panel",{title:"Accordion Item 3",html:"&lt;empty panel&gt;",cls:"empty"}),d=Ext.create("Ext.Panel",{title:"Accordion Item 4",html:"&lt;empty panel&gt;",cls:"empty"}),e=Ext.create("Ext.Panel",{title:"Accordion Item 5",html:"&lt;empty panel&gt;",cls:"empty"}),b=Ext.create("Ext.panel.Panel",{region:"west",width:200,margins:"5 5 5 5",split:!0,
width:210,layout:"accordion",items:[b,c,d,e]});Ext.create("Ext.container.Viewport",{layout:"border",items:[a,b]});this.genomeViewer.draw(1,25E6);this.karyotypeWidget.getFromCellBase()};
function GenomeViewer(a,b,c){var d=this;this.id="GenomeViewer#"+Math.round(1E4*Math.random())+"#";this.menuBar=null;this.width=$(document).width();this.height=$(document).height();this.targetId=null;this.species="hsa";this.speciesName="Homo sapiens";null!=a&&(this.targetId=a);null!=b&&(this.species=b.species,this.speciesName=b.name);null!=c&&(null!=c.description&&(c.description="beta"),null!=c.menuBar&&(this.menuBar=c.menuBar),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),
null!=c.pluginsMenu&&(this.pluginsMenu=c.pluginsMenu));this.onSpeciesChange=new Event;console.log(this.width+"x"+this.height);console.log(this.targetId);console.log(this.id);this.genomeWidget=null;this.genomeWidgetProperties=new GenomeWidgetProperties(this.species,{windowSize:1E6,pixelRatio:5.0E-4,id:this.id});this.onSpeciesChange.addEventListener(function(a,b){d.species=b.species;d.speciesName=b.name;Ext.getCmp(d.id+"speciesMenuButton").setText(d.speciesName);Ext.example.msg("Species",d.speciesName+
" selected.");Ext.getCmp(d.id+"chromosomeMenuButton").menu=d._getChromosomeMenu();d.genomeWidgetProperties=new GenomeWidgetProperties(d.species,{windowSize:1E6,pixelRatio:5.0E-4,id:d.id});null!=d.targetId&&d.draw()});this.customTracksAddedCount=1;$(window).resize(function(){});this.chromosome=13;this.position=32889611}GenomeViewer.prototype.setMenuBar=function(a){this.menuBar=a};
GenomeViewer.prototype.draw=function(){null!=this.targetId&&this._getPanel(this.width,this.height);this._render(this.chromosome,this.position)};GenomeViewer.prototype._render=function(a,b){this.chromosome=a;this.position=b;var c=this.position-this.genomeWidgetProperties.windowSize,d=this.position+this.genomeWidgetProperties.windowSize;this._drawMasterGenomeViewer(this.chromosome,c,d);this.drawChromosome(a,c,d);this._setScaleLabels()};
GenomeViewer.prototype._getPanel=function(a,b){if(null==this._panel){var c=[];null!=this.menuBar&&c.push(this.menuBar);c.push(this._getNavigationBar());c.push(this._getChromosomePanel());c.push(this._getWindowSizePanel());c.push(this._getTracksPanel());c.push(this._getBottomBar());this._panel=Ext.create("Ext.panel.Panel",{renderTo:this.targetId,border:!1,width:a,height:b,cls:"x-unselectable",layout:{type:"vbox",align:"stretch"},region:"center",margins:"0 0 0 0",border:!1,items:c})}return this._panel};
GenomeViewer.prototype.setSize=function(a,b){500>a&&(a=500);2400<a&&(a=2400);this.width=a;this.height=b;this._getPanel().setSize(a,b);this.draw()};GenomeViewer.prototype._getSpeciesMenu=function(){null==this._specieMenu&&(this._specieMenu=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[]}));return this._specieMenu};
GenomeViewer.prototype.setSpecieMenu=function(a){var b=this,c=this._getSpeciesMenu();c.hide();c.removeAll();for(var d=0;d<a.length;d++)c.add({text:a[d].name,species:a[d].species,handler:function(a){b.setSpecie({name:a.text,species:a.species})}})};GenomeViewer.prototype.setSpecie=function(a){this.onSpeciesChange.notify(a)};
GenomeViewer.prototype._getChromosomeMenu=function(){var a=this,b=Ext.create("Ext.data.Store",{fields:["name"],autoLoad:!1}),c=Ext.create("Ext.view.View",{store:b,selModel:{mode:"SINGLE",listeners:{selectionchange:function(b,c){a.setChromosome(c[0].data.name);d.hide()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".chromosome-item",tpl:'<tpl for="."><div style="float:left" class="chromosome-item">{name}</div></tpl>'}),c=Ext.create("Ext.container.Container",{width:125,autoScroll:!0,
style:"background-color:#fff",items:[c]}),d=Ext.create("Ext.menu.Menu",{almacen:b,items:[c]}),e=new KaryotypeCellBaseDataAdapter(this.species);e.successed.addEventListener(function(){for(var a=[],c=0;c<e.chromosomeNames.length;c++)a.push({name:e.chromosomeNames[c]});b.loadData(a)});e.fill();return d};
GenomeViewer.prototype._showKaryotypeWindow=function(){var a=this,b=new KaryotypePanelWindow(this.species,{genomeViewer:this});b.onRendered.addEventListener(function(){b.select(a.chromosome,a.position,a.position)});b.onMarkerChanged.addEventListener(function(b,d){a.setLocation(d.chromosome,d.start)});b.draw()};
GenomeViewer.prototype._getZoomSlider=function(){var a=this;null==this._zoomSlider&&(this._zoomSlider=Ext.create("Ext.slider.Single",{id:this.id+" zoomSlider",width:200,minValue:0,hideLabel:!1,maxValue:100,value:a.genomeWidgetProperties.getZoom(),useTips:!0,increment:10,tipText:function(a){return Ext.String.format("<b>{0}%</b>",a.value)}}),this._zoomSlider.on("changecomplete",function(b,c){a._handleNavigationBar("ZOOM",c)}));return this._zoomSlider};
GenomeViewer.prototype._handleNavigationBar=function(a,b){"OptionMenuClick"==a&&(this.genomeWidget.showTranscripts=Ext.getCmp("showTranscriptCB").checked,this.genomeWidgetProperties.setShowTranscripts(Ext.getCmp("showTranscriptCB").checked),this.refreshMasterGenomeViewer());"ZOOM"==a&&this.setZoom(b);"GoToGene"==a&&this.openGeneListWidget(Ext.getCmp(this.id+"tbGene").getValue());if("+"==a){var c=this.genomeWidgetProperties.getZoom();100>c&&this.setZoom(c+10)}"-"==a&&(c=this.genomeWidgetProperties.getZoom(),
10<=c&&this.setZoom(c-10));if("Go"==a){var c=Ext.getCmp(this.id+"tbCoordinate").getValue(),d=c.split(":")[1];this.chromosome=c.split(":")[0];this.setLocation(this.chromosome,d)}"<"==a&&(Ext.getCmp(this.id+"tbCoordinate").getValue(),this.setLocation(this.chromosome,this.position-this.genomeWidgetProperties.windowSize/2));">"==a&&(Ext.getCmp(this.id+"tbCoordinate").getValue(),this.setLocation(this.chromosome,this.position+this.genomeWidgetProperties.windowSize/2))};
GenomeViewer.prototype._getNavigationBar=function(){var a=this;return Ext.create("Ext.toolbar.Toolbar",{cls:"bio-toolbar",height:35,border:0,items:[{id:this.id+"speciesMenuButton",text:this.speciesName,menu:this._getSpeciesMenu()},{id:this.id+"chromosomeMenuButton",text:"Chromosome",menu:this._getChromosomeMenu()},{text:"Karyotype",handler:function(){a._showKaryotypeWindow()}},{text:"<",margin:"0 0 0 15",handler:function(){a._handleNavigationBar("<")}},{margin:"0 0 0 5",iconCls:"icon-zoom-out",handler:function(){a._handleNavigationBar("-")}},
this._getZoomSlider(),{margin:"0 5 0 0",iconCls:"icon-zoom-in",handler:function(){a._handleNavigationBar("+")}},{text:">",handler:function(){a._handleNavigationBar(">")}},"->",{xtype:"label",text:"Position:",margins:"0 0 0 10"},{xtype:"textfield",id:this.id+"tbCoordinate",text:this.chromosome+":"+this.position,listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("Go")}}},{text:"Go",handler:function(){a._handleNavigationBar("Go")}},{xtype:"label",text:"Search:",margins:"0 0 0 10"},
{xtype:"textfield",id:this.id+"tbGene",emptyText:"gene, protein, transcript",name:"field1",listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("GoToGene")}}},{text:"Go",handler:function(){a._handleNavigationBar("GoToGene")}}]})};GenomeViewer.prototype.setChromosome=function(a){this.setLocation(a,this.position);this._setChromosomeLabel(a)};
GenomeViewer.prototype._setChromosomeLabel=function(a){document.getElementById(this._getChromosomeLabelID()).innerHTML="Chromosome&nbsp;"+a;Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+a)};GenomeViewer.prototype._getChromosomeContainerID=function(){return this.id+"container_map_one_chromosome"};GenomeViewer.prototype._getChromosomeLabelID=function(){return this.id+"chromosome_label_id"};
GenomeViewer.prototype._getChromosomePanel=function(){var a=Ext.create("Ext.container.Container",{id:this._getChromosomeLabelID(),margin:5}),b=Ext.create("Ext.container.Container",{id:this._getChromosomeContainerID(),margin:10});return Ext.create("Ext.container.Container",{height:70,layout:{type:"table",columns:2},items:[a,b]})};
GenomeViewer.prototype._getWindowSizePanel=function(){var a=Ext.create("Ext.toolbar.TextItem",{id:this.id+"windowSizeLabel",text:"window Size"});return Ext.create("Ext.container.Container",{style:"text-align:center;",height:20,items:a})};GenomeViewer.prototype._getTracksPanelID=function(){return this.id+"master"};
GenomeViewer.prototype._getTracksPanel=function(){null==this._mainPanel&&(this._mainPanel=Ext.create("Ext.panel.Panel",{autoScroll:!0,flex:1,border:!1,html:'<div height=2000px; overflow-y="scroll"; id = "'+this._getTracksPanelID()+'"></div>'}));return this._mainPanel};
GenomeViewer.prototype._getBottomBar=function(){var a=new GeneFeatureFormatter,b=new SNPFeatureFormatter,c=new LegendPanel({title:"Gene legend"}),d=new LegendPanel({title:"SNP legend"}),e=Ext.create("Ext.draw.Component",{id:this.id+"scaleLabel",width:100,height:20,items:[{type:"text",text:"Scale number",fill:"#000000",x:10,y:5,width:5,height:20},{type:"rect",fill:"#000000",x:0,y:0,width:2,height:20},{type:"rect",fill:"#000000",x:2,y:12,width:100,height:3},{type:"rect",fill:"#000000",x:101,y:0,width:2,
height:20}]}),f=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"uxTaskbar",winMgr:new Ext.ZIndexManager,enableOverflow:!0,cls:"bio-hiddenbar",height:28,flex:1}),a=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-hiddenbar",width:300,height:28,items:[e,"-",c.getButton(a.getBioTypeColors()),d.getButton(b.getBioTypeColors()),"->"]});return Ext.create("Ext.container.Container",{layout:"hbox",cls:"bio-botbar x-unselectable",height:30,items:[f,a]})};
GenomeViewer.prototype.openListWidget=function(a,b,c,d,e,f){var g=this,h=new CellBaseDataAdapter(this.species);h.successed.addEventListener(function(){var a=new GenomicListWidget({title:e,gridFields:f,genomeViewer:g});a.draw(h.dataset.toJSON(),c);a.onSelected.addEventListener(function(a,b){null!=b&&null!=b.chromosome&&g.setLocation(b.chromosome,b.start)});a.onTrackAddAction.addEventListener(function(a,b){null!=b&&g.addTrackFromFeatures(b)})});h.fill(a,b,c,d)};
GenomeViewer.prototype.openGeneListWidget=function(a){this.openListWidget("feature","gene",a.toString(),"info","Gene List")};GenomeViewer.prototype.openTranscriptListWidget=function(a){this.openListWidget("feature","transcript",a.toString(),"info","Transcript List","externalName,stableId,biotype,chromosome,start,end,strand,description".split(","))};
GenomeViewer.prototype.openExonListWidget=function(a){var b=this,c=new CellBaseDataAdapter(this.species);c.successed.addEventListener(function(){var d=new GenomicListWidget({title:"Exon List",gridFields:["stableId","chromosome","start","end","strand"]}),e=[];e.push(c.dataset.toJSON());d.draw(e,a);d.onSelected.addEventListener(function(a,c){null!=c&&null!=c.chromosome&&b.setLocation(c.chromosome,c.start)})});c.fill("feature","exon",a.toString(),"info")};
GenomeViewer.prototype.openSNPListWidget=function(a){this.openListWidget("feature","snp",a.toString(),"info","SNP List","name,variantAlleles,ancestralAllele,mapWeight,position,sequence".split(","))};GenomeViewer.prototype.openGOListWidget=function(a){var b=this,c=new CellBaseDataAdapter(this.species);c.successed.addEventListener(function(){for(var a=[],e=0;e<c.dataset.toJSON()[0].length;e++)a.push(c.dataset.toJSON()[0][e].displayId);b.openGeneListWidget(a)});c.fill("feature","id",a.toString(),"xref?dbname=ensembl_gene&")};
GenomeViewer.prototype.drawChromosome=function(a){this._setChromosomeLabel(a);DOM.removeChilds(this._getChromosomeContainerID());var b=this.width-100;this.chromosomeFeatureTrack=new ChromosomeFeatureTrack(this.id+"chr",document.getElementById(this._getChromosomeContainerID()),this.species,{top:5,bottom:20,left:10,right:b-100,width:b,height:40,label:!0,vertical:!1,rounded:4});var c=this,d=new RegionCellBaseDataAdapter(this.species,{resource:"cytoband"});d.successed.addEventListener(function(){c.chromosomeFeatureTrack.draw(d.dataset);
c.chromosomeFeatureTrack.click.addEventListener(function(a,b){c.setLocation(c.chromosome,b)})});d.fill(a,1,26E7,"cytoband")};GenomeViewer.prototype._setScaleLabels=function(){var a=Math.floor(100/this.genomeWidgetProperties.getPixelRatio())+" nt ";Ext.getCmp(this.id+"scaleLabel").surface.items.items[0].setAttributes({text:a},!0);a="Viewing "+10*Math.floor(100/this.genomeWidgetProperties.getPixelRatio())+" nts ";Ext.getCmp(this.id+"windowSizeLabel").setText(a)};
GenomeViewer.prototype.setZoom=function(a){this.genomeWidgetProperties.setZoom(a);this.position=this.genomeWidget.getMiddlePoint();this._getZoomSlider().setValue(a);this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.genomeWidgetProperties.getPixelRatio());this._setScaleLabels();this.refreshMasterGenomeViewer()};
GenomeViewer.prototype.setLocation=function(a,b){this.chromosome=a;this.position=Math.ceil(b);this.refreshMasterGenomeViewer();this.drawChromosome(this.chromosome,1,26E6)};GenomeViewer.prototype._setPositionField=function(a,b){NaN==b&&(b=1E6);0>b?Ext.getCmp(this.id+"tbCoordinate").setValue(a+":0"):Ext.getCmp(this.id+"tbCoordinate").setValue(a+":"+Math.ceil(b))};
GenomeViewer.prototype.refreshMasterGenomeViewer=function(){this.genomeWidget.clear();this.updateRegionMarked(this.chromosome,this.position);this._drawMasterGenomeViewer()};GenomeViewer.prototype._getWindowsSize=function(){return this.genomeWidgetProperties.getWindowSize(this.genomeWidgetProperties.getZoom())};
GenomeViewer.prototype._drawMasterGenomeViewer=function(){var a=this;this._getPanel().setLoading("Retrieving data");this.genomeWidget=new GenomeWidget(this.id+"master",this._getTracksPanelID(),{pixelRatio:this.genomeWidgetProperties.getPixelRatio(),width:this.width-15,height:2E3});var b=this.genomeWidgetProperties.getZoom();if(0<this.genomeWidgetProperties.getTrackByZoom(b).length){for(var c=0;c<this.genomeWidgetProperties.getTrackByZoom(b).length;c++){var d=this.genomeWidgetProperties.getTrackByZoom(b)[c];
d.top=d.originalTop;d.height=d.originalHeight;d.clear();this.genomeWidgetProperties.getDataAdapterByZoom(b)[c].datasets={};this.genomeWidget.addTrack(d,this.genomeWidgetProperties.getDataAdapterByZoom(b)[c])}b=Math.ceil(this.position-this._getWindowsSize());c=Math.ceil(this.position+this._getWindowsSize());0>b&&(b=0);this.genomeWidget.onMarkerChange.addEventListener(function(b,c){a.updateRegionMarked(a.chromosome,c.middle)});this.genomeWidget.onRender.addEventListener(function(){a._getPanel().setLoading(!1);
a.genomeWidget.trackCanvas.selectPaintOnRules(a.position)});this._setPositionField(this.chromosome,this.position);this.genomeWidget.draw(this.chromosome,b,c)}else a._getPanel().setLoading("No tracks to display")};GenomeViewer.prototype.updateRegionMarked=function(a,b){var c=this.genomeWidgetProperties.windowSize/2,d=b-c;0>d&&(d=0);this.chromosomeFeatureTrack.select(d,b+c)};
GenomeViewer.prototype.loadDASTrack=function(a,b){if(void 0==this.genomeWidgetProperties.tracks[a]){var c=new DasRegionDataAdapter({url:b});this.genomeWidgetProperties.addCustomTrackByZoom(0,50,new FeatureTrack("vcf",null,this.species,{top:10,left:0,height:10,title:a,opacity:0.9,titleFontSize:9,forceColor:"purple",label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:100,allowDuplicates:!0,backgroundColor:"#FCFFFF",isAvalaible:!1}),c);this.genomeWidgetProperties.addCustomTrackByZoom(60,100,new FeatureTrack("vcf",
null,this.species,{top:10,left:0,height:10,title:a,titleFontSize:9,forceColor:"#000000",label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:100,allowDuplicates:!0,backgroundColor:"#FCFFFF",isAvalaible:!1}),c)}};
GenomeViewer.prototype.addFeatureTrack=function(a,b){this._getPanel().setLoading();if(null!=b){this.genomeWidgetProperties.addCustomTrackByZoom(0,0,new HistogramFeatureTrack("vcf",null,this.species,{top:20,left:0,height:20,featureHeight:18,title:a,titleFontSize:9,titleWidth:70,label:!1,forceColor:"purple",intervalSize:5E5}),b);this.genomeWidgetProperties.addCustomTrackByZoom(10,20,new HistogramFeatureTrack("vcf",null,this.species,{top:20,left:0,height:20,featureHeight:18,title:a,titleFontSize:9,titleWidth:70,
label:!1,forceColor:"purple",intervalSize:15E4}),b);var c=new FeatureTrack("vcf",null,this.species,{top:10,left:0,height:10,title:a,label:!1,avoidOverlapping:!0,pixelSpaceBetweenBlocks:1,allowDuplicates:!0});this.genomeWidgetProperties.addCustomTrackByZoom(30,80,c,b);c=new FeatureTrack("vcf",null,this.species,{top:10,left:0,height:10,title:a,label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:75,allowDuplicates:!0});this.genomeWidgetProperties.addCustomTrackByZoom(90,90,c,b);this.genomeWidgetProperties.addCustomTrackByZoom(100,
100,new SNPFeatureTrack("vcf",null,this.species,{top:10,left:0,height:20,title:a,featureHeight:10,label:!0,avoidOverlapping:!0,pixelSpaceBetweenBlocks:75,allowDuplicates:!0}),b);this._drawMasterGenomeViewer()}};GenomeViewer.prototype.addTrackFromFeatures=function(a,b){var c=new LocalRegionDataAdapter;c.loadFromFeatures(a);null==b&&(b="");this.addFeatureTrack(b.substr(0,20)+" #"+this.customTracksAddedCount,c);this.customTracksAddedCount++};
GenomeViewer.prototype.addTrackFromFeaturesList=function(a){for(var b=[],c=0;c<a.features.length;c++)for(var d=0;d<a.features[c].length;d++)b.push(a.features[c][d]);this.addTrackFromFeatures(b,a.trackName)};function GeneBlockManager(){this.data={};this.data.queues=[];this.data.queues[0]=[];this.data.transcriptQueueCount={};this.data.transcriptQueue=[]}GeneBlockManager.prototype.getGenesTrackCount=function(){return this.data.queues.length};GeneBlockManager.prototype.getFeaturesFromGeneTrackIndex=function(a){return this.data.queues[a]};
GeneBlockManager.prototype.toJSON=function(){return this.data};
GeneBlockManager.prototype.init=function(a){this.data.features=a;for(var a=this.data.features,b=0;b<a.length;b++){var c=this._searchSpace(a[b],this.data.queues);this.data.queues[c].push(a[b]);null==this.data.transcriptQueue[c]&&this.data.transcriptQueue.push([]);this.data.TranscriptQueuesTest=[];for(var d=0;d<a[b].transcript.length;d++){var e={start:a[b].transcript[d].exon[0].start,end:a[b].transcript[d].exon[a[b].transcript[d].exon.length-1].end},f=this._searchSpace(e,this.data.TranscriptQueuesTest);
this.data.TranscriptQueuesTest[f].push(e);null==this.data.transcriptQueue[c][f]&&this.data.transcriptQueue[c].push([]);this.data.transcriptQueue[c][f].push(a[b].transcript[d])}}return this.data.queues[c].length};GeneBlockManager.prototype._overlapBlocks=function(a,b){return a.start<=b.end&&a.end>=b.start?!0:!1};
GeneBlockManager.prototype._searchSpace=function(a,b){for(var c=0;c<b.length;c++){for(var d=[],e=0;e<b[c].length;e++)d.push(this._overlapBlocks(a,b[c][e]));if(-1==d.valueOf(d).indexOf(!0))return c}b.push([]);return b.length-1};GeneBlockManager.prototype.loadFromJSON=DataSet.prototype.loadFromJSON;GeneBlockManager.prototype.loadFromFile=DataSet.prototype.loadFromFile;GeneBlockManager.prototype.loadFromURL=DataSet.prototype.loadFromURL;function GeneBlockManager(){this.data={}}
GeneBlockManager.prototype.getGenesTrackCount=function(){return this.data.queues.length};GeneBlockManager.prototype.getFeaturesFromGeneTrackIndex=function(a){return this.data.queues[a]};GeneBlockManager.prototype.toJSON=function(){return this.data};GeneBlockManager.prototype.validate=function(){return!0};GeneBlockManager.prototype.sort=function(a,b){return b.end-b.start-(a.end-a.start)};
GeneBlockManager.prototype.toDatasetFormatter=function(a){var b=[];try{for(var c=0;c<a.length;c++){var d=new GeneFeatureFormatter(a[c]);b.push(d);if(null!=a[c].transcript)for(var e=a[c].transcript,f=0;f<e.length;f++)null==d.transcript&&(d.transcript=[]),d.transcript.push(new TranscriptFeatureFormatter(a[c].transcript[f]))}}catch(g){alert("ERROR: GeneBlockManager: "+g)}return b};
function genomemapcanvas(a,b){this.targetID=a;this.containers=[];this.tracks=[];this.start=b.coords.start;this.end=b.coords.end;this.features={};this.rules=[];this.click=new Event(this);this.renderedTrack=new Event(this);this.changeViewEvent=new Event(this)}genomemapcanvas.prototype.createNewContainer=function(a,b,c){return DOM.createNewElement("div",document.getElementById(this.targetID),[["id",a],["style","width:"+b+"; height:"+c+";overflow-y:auto"]])};
genomemapcanvas.prototype.addRule=function(a){this.rules.push(a);this.addTrack(a,"rule")};genomemapcanvas.prototype.addTrack=function(a){this.tracks.push(a);this.renderTrack(this.tracks.length-1);this.features[a.id]=a.features;var b=this;a.click.addEventListener(function(a,d){b.clickonChild(d)})};genomemapcanvas.prototype.clickonChild=function(a){this.click.notify(a)};
genomemapcanvas.prototype.moveLeft=function(){var a=(this.end-this.start)/4;this.start=parseFloat(this.start)-parseFloat(a);this.end=parseFloat(this.end)-parseFloat(a);this.changeView(this.start,this.end)};genomemapcanvas.prototype.moveRight=function(){var a=(this.end-this.start)/4;this.start=parseFloat(this.start)+parseFloat(a);this.end=parseFloat(this.end)+parseFloat(a);this.changeView(this.start,this.end)};
genomemapcanvas.prototype.changeView=function(a,b){this.start=a;this.end=b;for(var c=0;c<this.tracks.length;c++)this.tracks[c].changeView(a,b);DOM.removeChilds(this.targetID);this.changeViewEvent.notify({start:a,end:b});this.rules[0].inc=(b-a)/50;this.render()};genomemapcanvas.prototype.renderTrack=function(a){this.containers.push(this.createNewContainer(this.tracks[a].targetID,this.tracks[a].width,this.tracks[a].height));this.tracks[a].draw();this.renderedTrack.notify(this.tracks[a].features)};
genomemapcanvas.prototype.render=function(){for(var a=0;a<this.tracks.length;a++)this.renderTrack(a)};genomemapcanvas.prototype.removeLastTrack=function(){this.tracks.pop();this.changeView(start,end)};VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;VCFFileWidget.prototype.draw=FileWidget.prototype.draw;VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;
VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;function VCFFileWidget(a){null==a&&(a={});a.title="VCF";a.tags=["vcf"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget;this.chartWidgetQuality=new ChartWidget({height:300})}VCFFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"]),this.chartWidgetQuality.getChart(["features","quality"])]};
VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=new VCFFileDataAdapter;this._fileLoad(b);b.loadFromFile(a)};
VCFFileWidget.prototype._fileLoad=function(a){var b=this;a.onRead.addEventListener(function(a){b.dataAdapter=new VCFLocalRegionDataAdapter;b.dataAdapter.loadFromFileDataAdapter(a);var a=[],d;for(d in b.dataAdapter.featuresByChromosome)a.push({features:b.dataAdapter.featuresByChromosome[d].length,chromosome:d});d=[];for(var e in b.dataAdapter.qualitycontrol)d.push({features:b.dataAdapter.qualitycontrol[e],quality:e});b.chartWidgetByChromosome.getStore().loadData(a);b.chartWidgetQuality.getStore().loadData(d);
b.panel.setLoading(!1);b.featureCountLabel.setText("Features count: "+b.dataAdapter.features.length,!1);b.btnOk.enable()})};VCFFileWidget.prototype.loadFileFromServer=function(a){var b=new VCFFileDataAdapter;this._fileLoad(b);b.loadFromContent(a.data)};SIFNetworkFileWidget.prototype.draw=NetworkFileWidget.prototype.draw;function SIFNetworkFileWidget(a){null==a&&(a={});a.title="Import a Network SIF file";NetworkFileWidget.prototype.constructor.call(this,a)}
SIFNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"SIF network file",flex:1,buttonText:"Browse local",listeners:{change:function(){var b=new InteractomeSIFFileDataAdapter,c=document.getElementById(a.fileUpload.fileInputEl.id).files[0];b.loadFromFile(c);b.onRead.addEventListener(function(b){try{a.content=b;var c=b.dataset.getVerticesCount(),f=b.dataset.getEdgesCount(),g=(new SIFFileDataAdapter).toSIF(b.dataset),
h=new TabularFileDataAdapter;h.parse(g);a.gridStore.loadData(h.getLines());a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1);a.countLabel.setText('vertices:<span class="info">'+c+'</span> edges:<span class="info">'+f+"</span>",!1)}catch(i){a.infoLabel.setText('<span class="err">File not valid </span>'+i,!1)}})}}})};
function FileWidget(a){var b=this;this.targetId=null;this.id="FileWidget_"+Math.round(1E5*Math.random());this.wum=!0;this.tags=[];this.args=a;null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title,this.id=this.title+this.id),null!=a.wum&&(this.wum=a.wum),null!=a.tags&&(this.tags=a.tags));this.dataAdapter=null;this.onOk=new Event(this);this.browserData=new BrowserDataWidget;this.browserData.onSelect.addEventListener(function(a,d){b.trackNameField.setValue(d.filename);
b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.panel.setLoading()});this.browserData.adapter.onReadData.addEventListener(function(a,d){b.trackNameField.setValue(d.filename);b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.loadFileFromServer(d)})}FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()};FileWidget.prototype.getFileFromServer=function(){};
FileWidget.prototype.loadFileFromLocal=function(){};FileWidget.prototype.getChartItems=function(){return[]};
FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.fileName);a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1);a.loadFileFromLocal(b)}}}})};
FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{html:'<span class="dis">No file loaded</span>'});b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add(this.getFileUpload());this.panel=Ext.create("Ext.panel.Panel",{border:!1,cls:"panel-border-top panel-border-bottom",title:"Previsualization",items:this.getChartItems(),bbar:b});
this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});b=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,handler:function(){a.browserData.draw($.cookie("bioinfo_sid"),a.tags)}}),c.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?this.sessionInitiated():
this.sessionFinished());this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{html:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'});c.add(["->",this.fileNameLabel]);this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.onOk.notify({title:a.getTitleName(),dataAdapter:a.dataAdapter});a.openDialog.close()}});this.openDialog=Ext.create("Ext.ux.Window",{title:"Open "+this.title+" file",
taskbar:Ext.getCmp(this.args.genomeViewer.id+"uxTaskbar"),width:800,resizable:!1,items:[c,this.panel,b],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()};FileWidget.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};FileWidget.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GFFFileWidget.prototype.draw=FileWidget.prototype.draw;GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;
function GFFFileWidget(a){null==a&&(a={});a.title="GFF";a.tags=["gff"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget}GFFFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=new GFFFileDataAdapter;this._fileLoad(b);b.loadFromFile(a)};
GFFFileWidget.prototype._fileLoad=function(a){var b=this;a.onRead.addEventListener(function(a){b.dataAdapter=new GFFLocalRegionDataAdapter;b.dataAdapter.loadFromFileDataAdapter(a);var a=[],d;for(d in b.dataAdapter.featuresByChromosome)a.push({features:b.dataAdapter.featuresByChromosome[d].length,chromosome:d});b.chartWidgetByChromosome.getStore().loadData(a);b.panel.setLoading(!1);b.featureCountLabel.setText("Features count: "+b.dataAdapter.features.length,!1);b.btnOk.enable()})};
GFFFileWidget.prototype.loadFileFromServer=function(a){var b=new GFFFileDataAdapter;this._fileLoad(b);b.loadFromContent(a.data)};BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;BEDFileWidget.prototype.draw=FileWidget.prototype.draw;BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;
function BEDFileWidget(a){null==a&&(a={});a.title="BED";a.tags=["bed"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget}BEDFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=new BEDFileDataAdapter;this._fileLoad(b);b.loadFromFile(a)};
BEDFileWidget.prototype._fileLoad=function(a){var b=this;a.onRead.addEventListener(function(a){b.dataAdapter=new BEDLocalRegionDataAdapter;b.dataAdapter.loadFromFileDataAdapter(a);var a=[],d;for(d in b.dataAdapter.featuresByChromosome)a.push({features:b.dataAdapter.featuresByChromosome[d].length,chromosome:d});b.chartWidgetByChromosome.getStore().loadData(a);b.panel.setLoading(!1);b.featureCountLabel.setText("Features count: "+b.dataAdapter.features.length,!1);b.btnOk.enable()})};
BEDFileWidget.prototype.loadFileFromServer=function(a){var b=new BEDFileDataAdapter;this._fileLoad(b);b.loadFromContent(a.data)};
function NetworkFileWidget(a){this.targetId=null;this.id="NetworkFileWidget-"+Math.round(1E7*Math.random());this.title="Open a Network JSON file";this.width=600;this.height=300;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.dataAdapter=null;this.onOk=new Event(this);this.previewId=this.id+"-preview"}
NetworkFileWidget.prototype.getTitleName=function(){return Ext.getCmp(this.id+"_title").getValue()};
NetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"JSON network file",flex:1,buttonText:"Browse local",listeners:{change:function(){var b=new FileDataAdapter,c=document.getElementById(a.fileUpload.fileInputEl.id).files[0];b.read(c);b.onRead.addEventListener(function(b,c){try{a.content=c.content;var f=JSON.parse(c.content),g=new GraphDataset;g.loadFromJSON(f.dataset);var h=g.getVerticesCount(),
i=g.getEdgesCount(),j=(new SIFFileDataAdapter).toSIF(g),k=new TabularFileDataAdapter;k.parse(j);a.gridStore.loadData(k.getLines());a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1);a.countLabel.setText('vertices:<span class="info">'+h+'</span> edges:<span class="info">'+i+"</span>",!1)}catch(l){a.infoLabel.setText('<span class="err">File not valid </span>'+l,!1)}})}}})};
NetworkFileWidget.prototype.draw=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});b.add(this.getFileUpload());this.infoLabel=Ext.create("Ext.toolbar.TextItem",{html:"Please select a network saved File"});this.countLabel=Ext.create("Ext.toolbar.TextItem");var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add([this.infoLabel,"->",this.countLabel]);this.gridStore=Ext.create("Ext.data.Store",{fields:["0","1","2"]});this.grid=
Ext.create("Ext.grid.Panel",{border:!1,flex:1,store:this.gridStore,columns:[{header:"Node",dataIndex:"0",flex:1},{header:"Node",dataIndex:"1",flex:1},{header:"Node",dataIndex:"2",flex:1}],features:[{ftype:"grouping"}],tbar:b,bbar:c});this.panel=Ext.create("Ext.window.Window",{title:this.title,width:this.width,height:this.height,resizable:!1,layout:{type:"vbox",align:"stretch"},items:[this.grid],buttons:[{text:"Ok",handler:function(){a.onOk.notify(a.content);a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],
listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show()};function UrlWidget(a){this.id="UrlWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.title="Custom url";this.width=500;this.height=400;null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.onAdd=new Event(this)}
UrlWidget.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,flex:1,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}});this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasRegionDataAdapter({url:a.urlField.getValue()});
b.successed.addEventListener(function(){a.contentArea.setValue(b.xml);a.form.setLoading(!1)});b.onError.addEventListener(function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin");a.form.setLoading(!1)});b.fill(1,1,1)}});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",flex:1});this.panelSettings=Ext.create("Ext.panel.Panel",
{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,items:[this.trackNameField]});this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height});this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false"});this.infobar.add(this.urlField);this.infobar.add(this.checkButton);this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,this.panelSettings]});this.panel=Ext.create("Ext.ux.Window",
{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.onAdd.notify({name:a.trackNameField.getValue(),url:a.urlField.getValue()});a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})};
function MasterSlaveGenomeViewer(a,b,c){this.targetId=b;this.id=a+Math.random();this.width=1300;this.masterHeight=this.slaveHeight=this.height=700;this.masterWindowSize=1E6;null!=c&&(null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),null!=c.masterHeight&&(this.masterHeight=c.height),null!=c.slaveHeight&&(this.slaveHeight=c.height));this.pixelRatio=5.0E-4;this.zoomLevels=[];for(a=1;10>=a;a++)this.zoomLevels[a]=this.pixelRatio*2*a;this.zoomLevels[0.1]=this.pixelRatio;this.genomeWidget=
null;this.markerChanged=new Event(this)}MasterSlaveGenomeViewer.prototype.getZoomFactor=function(a){return this.zoomLevels[a/10]};MasterSlaveGenomeViewer.prototype.getMasterId=function(){return this.id+"_master"};MasterSlaveGenomeViewer.prototype.getSlaveId=function(){return this.id+"_slave"};MasterSlaveGenomeViewer.prototype.getMasterStart=function(){return this.position-this.masterWindowSize};MasterSlaveGenomeViewer.prototype.getMasterEnd=function(){return this.position+this.masterWindowSize};
MasterSlaveGenomeViewer.prototype.init=function(){};MasterSlaveGenomeViewer.prototype.goTo=function(a,b){this.clear();this.chromosome=a;this.position=b;this._drawMaster();this._drawSlave(this.position)};MasterSlaveGenomeViewer.prototype.zoomIn=function(){this.position=this.genomeWidget.trackCanvas.getMiddlePoint();this.pixelRatio*=1.5;this.clear();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.pixelRatio);console.log("PIXEL RATIO "+this.pixelRatio)};
MasterSlaveGenomeViewer.prototype.zoom=function(a){this.pixelRatio=50<a?this.pixelRatio*1.5*(a/4/10):this.pixelRatio/(1.5*(a/4/10));this.pixelRatio=this.getZoomFactor(a);this.position=this.genomeWidget.trackCanvas.getMiddlePoint();this.clear();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.pixelRatio)};
MasterSlaveGenomeViewer.prototype.zoomOut=function(){this.position=this.genomeWidget.trackCanvas.getMiddlePoint();this.pixelRatio/=1.5;this.clear();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.pixelRatio);console.log("PIXEL RATIO "+this.pixelRatio)};MasterSlaveGenomeViewer.prototype.clear=function(){this.genomeWidget.clear();this._drawMaster()};
MasterSlaveGenomeViewer.prototype._createMaster=function(){var a=new GenomeWidget(this.id+"master",this.getMasterId(),{pixelRatio:this.pixelRatio,width:this.width,height:this.height,showTranscripts:this.showTranscripts,showExons:this.showExons,showSNPTrack:this.showSNPTrack});if(null!=this.genomeWidget){a.trackList=this.genomeWidget.trackList;a.dataAdapterList=this.genomeWidget.dataAdapterList;for(var b=0;b<a.dataAdapterList.length;b++)a.dataAdapterList.preloadSuccess=new Event,a.dataAdapterList.successed=
new Event}return a};MasterSlaveGenomeViewer.prototype._drawMaster=function(){this.genomeWidget=this._createMaster();this.genomeWidget.draw(this.chromosome,this.getMasterStart(),this.getMasterEnd());this._attachMasterEvents()};MasterSlaveGenomeViewer.prototype._attachMasterEvents=function(){var a=this;this.genomeWidget.onClick.addEventListener(function(){});this.genomeWidget.markerChanged.addEventListener(function(b,c){a.updateSlave(c);a.chromosome=a.genomeWidget.chromosome;a.position=c;a.markerChanged.notify()})};
MasterSlaveGenomeViewer.prototype.addTrackMaster=function(a,b){this.genomeWidget=this._createMaster();this.genomeWidget.addTrack(a,b);this._attachMasterEvents()};MasterSlaveGenomeViewer.prototype._drawSlave=function(a){DOM.removeChilds(this.getSlaveId());this.detailViewer=new SequenceGenomeWidget(this.id+"detail",this.getSlaveId(),{width:this.width});this.detailViewer.draw(this.chromosome,a-100,a+100)};
MasterSlaveGenomeViewer.prototype.draw=function(a,b){this.chromosome=a;this.position=b;this.init();this._drawMaster();this._drawSlave(this.position)};MasterSlaveGenomeViewer.prototype.updateSlave=function(a){this._drawSlave(a);this.detailViewer.trackCanvas._goToCoordinateX(a-this.detailViewer.trackCanvas.width/this.detailViewer.trackCanvas.pixelRatio/2)};
function KaryotypePanelWindow(a,b){var c=this;this.id="KaryotypePanelWindow_"+Math.random();this.karyotypeWidget=new KaryotypePanel(this.getKaryotypePanelId(),a,{top:10,width:1E3,height:300,trackWidth:15});this.karyotypeCellBaseDataAdapter=new KaryotypeCellBaseDataAdapter(a);this.args=b;this.onRendered=new Event;this.onMarkerChanged=new Event;this.karyotypeCellBaseDataAdapter.successed.addEventListener(function(){c.karyotypeWidget.onRendered.addEventListener(function(){c.onRendered.notify()});c.karyotypeWidget.onClick.addEventListener(function(a,
b){c.onMarkerChanged.notify(b)});c.karyotypeWidget.draw(c.karyotypeCellBaseDataAdapter.chromosomeNames,c.karyotypeCellBaseDataAdapter.dataset.json)})}KaryotypePanelWindow.prototype.select=function(a,b,c){this.karyotypeWidget.select(a,b,c)};KaryotypePanelWindow.prototype.mark=function(a){this.karyotypeWidget.mark(a)};KaryotypePanelWindow.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
KaryotypePanelWindow.prototype.getKaryotypePanel=function(){if(null==this.karyotypePanel){var a=Ext.create("Ext.toolbar.TextItem",{html:'<span class="dis">Click on chromosome to go</span>'}),b=Ext.create("Ext.toolbar.Toolbar",{dock:"top"});b.add(a);this.karyotypePanel=Ext.create("Ext.panel.Panel",{height:350,maxHeight:350,border:!1,bodyPadding:15,padding:"0 0 0 0",html:'<div id="'+this.getKaryotypePanelId()+'" ><div>',dockedItems:[b]})}return this.karyotypePanel};
KaryotypePanelWindow.prototype.render=function(){var a=this;this.panel=Ext.create("Ext.ux.Window",{title:"Karyotype",resizable:!1,taskbar:Ext.getCmp(this.args.genomeViewer.id+"uxTaskbar"),constrain:!0,animCollapse:!0,width:1050,height:412,minWidth:300,minHeight:200,layout:"fit",items:[this.getKaryotypePanel()],buttonAlign:"center",buttons:[{text:"Close",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}});this.karyotypeCellBaseDataAdapter.fill()};
KaryotypePanelWindow.prototype.getKaryotypePanelId=function(){return this.id+"_karyotypePanel"};function KaryotypePanel(a,b,c){this.id=a+Math.round(1E4*Math.random());this.targetId=a;this.species=b;this.width=500;this.height=300;null!=c&&(null!=c.height&&(this.height=c.height),null!=c.width&&(this.width=c.width),null!=c.trackWidth&&(this.trackWidth=c.trackWidth));this.onClick=new Event(this);this.onRendered=new Event(this);this.onMarkerClicked=new Event(this)}
KaryotypePanel.prototype.getTrackId=function(a){return this.id+"_track_"+a};KaryotypePanel.prototype.init=function(){this.containerTable=DOM.createNewElement("table",DOM.select(this.targetId),[["id",this.id+"_table"],["width",this.width],["height",this.height]]);tr=DOM.createNewElement("tr",this.containerTable,[["width",this.width],["style","vertical-align:bottom"]]);for(var a=0;a<this.features.length;a++)DOM.createNewElement("td",tr,[["style","vertical-align:bottom"],["id",this.getTrackId(a)]])};
KaryotypePanel.prototype.drawFeatures=function(){var a=this,b=this.width/this.features.length;this.panels={};for(var c=0;c<this.features.length;c++){var d=this.chromosomeSize[c]*this.height-10,d=new ChromosomeFeatureTrack(this.id+"chr"+this.chromosomesNames[c],document.getElementById(this.getTrackId(c)),this.species,{top:10,bottom:d,left:12,right:25,width:b,height:this.chromosomeSize[c]*this.height,labelChromosome:!0,label:!0,vertical:!0,rounded:2,backgroundcolor:"yellow"});a.panels[this.chromosomesNames[c]]=
d;var e=new DataSet;e.loadFromJSON([this.features[c]]);d.draw(e);a.panels[this.chromosomesNames[c]].click.addEventListener(function(b,c){var d=(c.end-c.start)/2+c.start;a.select(c.chromosome,d,d+2E6);a.onClick.notify(c)});a.panels[this.chromosomesNames[c]].onMarkerClicked.addEventListener(function(b,c){a.onMarkerClicked.notify(c)})}this.onRendered.notify()};
KaryotypePanel.prototype.select=function(a,b,c){for(var d=0;d<this.chromosomesNames.length;d++)this.panels[this.chromosomesNames[d]].deselect();this.panels[a].select(b,c)};KaryotypePanel.prototype.mark=function(a,b){for(var c=0;c<a.length;c++)null!=this.panels[a[c].chromosome]&&this.panels[a[c].chromosome].mark(a[c],b)};KaryotypePanel.prototype.unmark=function(){for(var a in this.panels)this.panels[a].unmark()};
KaryotypePanel.prototype.draw=function(a,b){this.features=b;this.chromosomesNames=a;this.chromosomeSize=[];for(var c=this.maxChromosomeSize=0;c<this.features.length;c++)this.chromosomeSize.push(this.features[c][this.features[c].length-1].end),this.maxChromosomeSize<this.features[c][this.features[c].length-1].end&&(this.maxChromosomeSize=this.features[c][this.features[c].length-1].end);for(c=0;c<this.features.length;c++)this.chromosomeSize[c]/=this.maxChromosomeSize;this.init();this.drawFeatures()};
function TooltipPanel(a){this.id="TooltipPanel"+Math.round(1E7*Math.random());this.targetId=null;this.width=100;this.height=60;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}TooltipPanel.prototype.getPanel=function(a){null==this.panel&&(this.panel=Ext.create("Ext.tip.Tip",{html:this._getItemInfo(a)}));return this.panel};TooltipPanel.prototype.destroy=function(){this.panel.destroy()};
TooltipPanel.prototype._getItemInfo=function(a){var b="";if(a instanceof GeneFeatureFormatter||a instanceof TranscriptFeatureFormatter||a instanceof ExonFeatureFormatter||a instanceof SNPFeatureFormatter||a instanceof TfbsFeatureFormatter)b='<span class="ssel">'+a.getName()+'</span><br>start: <span class="emph">'+a.start+'</span><br>end:  <span class="emph">'+a.end+'</span><br>length: <span class="info">'+(a.end-a.start+1)+"</span><br>";a instanceof VCFFeatureFormatter&&(b='<span class="ssel">'+a.getName()+
"</span><br>");return b};
function KaryotypeHorizontalMarkerWidget(){this.id="GV_";this.width=600;this.height=700;this.tabPanelHeight=250;this.topPanelHeight=600;this.genomeWidget=new GenomeWidget("id","container_map",{width:100,height:this.topPanelHeight});this.genomeWidgetProperties=new GenomeWidgetProperties({windowSize:1E6,pixelRatio:1.0E-5});this.genomeWidgetProperties.addTrackByZoom(100,100,new SequenceFeatureTrack(this.id+"sequence",this.tracksPanel,{top:0,left:0,right:this.width,width:this.width,height:20,featureHeight:12,
avoidOverlapping:!1,backgroundColor:"#FFFFFF"}),new RegionCellBaseDataAdapter({resource:"sequence"}));this.genomeWidgetProperties.addTrackByZoom(0,0,new CytobandFeatureTrack(this.id+"_cytoband",this.tracksPanel,{top:0,left:0,height:20,title:"Cytoband",titleFontSize:9,label:!1,featureHeight:8,opacity:1,backgroundColor:"#FFFFFF"}),new RegionCellBaseDataAdapter({resource:"cytoband"}));this.genomeWidgetProperties.addTrackByZoom(10,100,new CytobandFeatureTrack(this.id+"_cytoband",this.tracksPanel,{top:0,
left:0,height:20,title:"Cytoband",titleFontSize:9,label:!0,featureHeight:8,opacity:1,backgroundColor:"#FFFFFF"}),new RegionCellBaseDataAdapter({resource:"cytoband"}));var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:20,featureHeight:18,queueHeight:18,title:"GENES",titleFontSize:9,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"blue",intervalSize:1E6});this.genomeWidgetProperties.addTrackByZoom(0,
0,a,new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:20,featureHeight:18,queueHeight:18,title:"GENES",titleFontSize:9,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"blue",intervalSize:1E5});this.genomeWidgetProperties.addTrackByZoom(10,10,a,new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));this.genomeWidgetProperties.addTrackByZoom(20,
40,new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:10,featureHeight:7,queueHeight:10,title:"GENES",titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1}),new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));this.genomeWidgetProperties.addTrackByZoom(50,60,new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:10,featureHeight:7,queueHeight:10,title:"GENES",
titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!1}),new GeneRegionCellBaseDataAdapter({obtainTranscripts:!1}));this.genomeWidgetProperties.addTrackByZoom(70,90,new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,{top:5,left:0,height:10,featureHeight:6,queueHeight:10,title:"GENES",titleFontSize:9,labelFontSize:8,showTranscripts:!0,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,
showDetailGeneLabel:!0}),new GeneRegionCellBaseDataAdapter)}KaryotypeHorizontalMarkerWidget.prototype.draw=function(a,b){this.chromosome=a;this.position=b;var c=Ext.create("Ext.panel.Panel",{layout:"vbox",region:"center",margins:"0 0 0 5",items:[this.getTopPanel()]});Ext.create("Ext.container.Viewport",{layout:"border",items:[c]});this._drawMasterKaryotypeHorizontalMarkerWidget(this.chromosome,this.position-this.genomeWidgetProperties.windowSize,this.position+this.genomeWidgetProperties.windowSize)};
KaryotypeHorizontalMarkerWidget.prototype.getMasterId=function(){return this.id+"_master"};KaryotypeHorizontalMarkerWidget.prototype.zoom=function(){this.position=this.genomeWidget.getMiddlePoint();this.refreshMasterKaryotypeHorizontalMarkerWidget();this.genomeWidget.trackCanvas._goToCoordinateX(this.position-this.genomeWidget.trackCanvas.width/2/this.genomeWidgetProperties.getPixelRatio())};KaryotypeHorizontalMarkerWidget.prototype.goTo=function(a,b){this.chromosome=a;this.position=b;this.refreshMasterKaryotypeHorizontalMarkerWidget()};
KaryotypeHorizontalMarkerWidget.prototype.refreshMasterKaryotypeHorizontalMarkerWidget=function(){this.genomeWidget.clear();this._drawMasterKaryotypeHorizontalMarkerWidget()};KaryotypeHorizontalMarkerWidget.prototype.addMasterTrack=function(a,b){this.genomeWidgetProperties.getCustomTracks().push(a);this.genomeWidgetProperties.getCustomDataAdapters().push(b);this._drawMasterKaryotypeHorizontalMarkerWidget()};
KaryotypeHorizontalMarkerWidget.prototype._drawMasterKaryotypeHorizontalMarkerWidget=function(){this.genomeWidget=new GenomeWidget(this.id+"master",this.getMasterId(),{pixelRatio:2.0E-6,width:this.width,height:this.height});for(var a=0;a<this.genomeWidgetProperties.getCustomTracks().length;a++)this.genomeWidgetProperties.getCustomTracks()[a].top=this.genomeWidgetProperties.getCustomTracks()[a].originalTop,this.genomeWidgetProperties.getCustomTracks()[a].height=this.genomeWidgetProperties.getCustomTracks()[a].originalHeight,
this.genomeWidgetProperties.getCustomTracks()[a].clear(),this.genomeWidgetProperties.getCustomDataAdapters()[a].datasets={},this.genomeWidget.addTrack(this.genomeWidgetProperties.getCustomTracks()[a],this.genomeWidgetProperties.getCustomDataAdapters()[a]);for(var b=this.genomeWidgetProperties.getZoom(),a=0;a<this.genomeWidgetProperties.getTrackByZoom(b).length;a++){var c=this.genomeWidgetProperties.getTrackByZoom(b)[a];c.top=c.originalTop;c.height=c.originalHeight;c.clear();this.genomeWidgetProperties.getDataAdapterByZoom(b)[a].datasets=
{};this.genomeWidget.addTrack(c,this.genomeWidgetProperties.getDataAdapterByZoom(b)[a])}a=Math.ceil(this.position-this.genomeWidgetProperties.windowSize);b=Math.ceil(this.position+this.genomeWidgetProperties.windowSize);0>a&&(a=0);this.genomeWidget.draw(this.chromosome,a,b)};KaryotypeHorizontalMarkerWidget.prototype.getTopPanel=function(){return Ext.create("Ext.panel.Panel",{width:this.width,height:this.topPanelHeight,margins:"0 5 2 5",html:'<div id = "'+this.getMasterId()+'"></div>'})};
function GenomeWidgetProperties(a,b){this.args=b;this.species=a;this.windowSize=1E7;this.minWindowSize=100;this.maxWindowSize=1E8;this._pixelRatio=5.0E-4;this.showTranscripts=!1;this._zoom=0;this.labelSize=this.labelHeight=10;this.featureHeight=4;null!=b&&(null!=b.windowSize&&(this.windowSize=b.windowSize),null!=b.id&&(this.id=b.id),null!=b._pixelRatio&&(this._pixelRatio=b._pixelRatio),null!=b.showTrancsripts&&(this.showTrancsripts=b.showTranscripts),null!=b.showExons&&(this.showExons=b.showExons));
this._zoomLevels={};this._windowSizeLevels={};this._zoomTracks={};this._zoomDataAdapters={};for(var c=0;100>=c;c+=10)this._zoomTracks[c]=[],this._zoomDataAdapters[c]=[];this.tracks={};this.customTracks=[];this.customDataAdapters=[];this.init()}GenomeWidgetProperties.prototype.getWindowSize=function(a){return this._windowSizeLevels[a]};
GenomeWidgetProperties.prototype.init=function(){this._zoomLevels[0]=5.0E-6;this._zoomLevels[10]=2.0E-5;this._zoomLevels[20]=8.0E-4;this._zoomLevels[30]=8.0E-4;this._zoomLevels[40]=0.0032;this._zoomLevels[50]=0.0064;this._zoomLevels[60]=0.0128;this._zoomLevels[70]=0.0256;this._zoomLevels[80]=0.0512;this._zoomLevels[90]=0.1024;this._zoomLevels[100]=10;this._windowSizeLevels[0]=13E7;this._windowSizeLevels[10]=4E7;this._windowSizeLevels[20]=75E4;this._windowSizeLevels[30]=75E4;this._windowSizeLevels[40]=
187500;this._windowSizeLevels[50]=93750;this._windowSizeLevels[60]=46875;this._windowSizeLevels[70]=23437.5;this._windowSizeLevels[80]=11718.75;this._windowSizeLevels[90]=5859.375;this._windowSizeLevels[100]=100;this._zoom=40;this._pixelRatio=this._zoomLevels[this._zoom];this.windowSize=this._windowSizeLevels[this._zoom];for(var a=0;100>=a;a+=10){var b=new RuleFeatureTrack(this.id+"_ruleTrack",this.tracksPanel,this.species,{top:10,left:0,height:20,expandRuleHeight:1500,labelHeight:this.labelHeight,
featureHeight:this.featureHeight,floating:!0});this.addTrackByZoom(a,a,b,new RuleRegionDataAdapter({pixelRatio:this._zoomLevels[a]}))}this.addNativeTracks()};GenomeWidgetProperties.prototype.setLabelHeight=function(a){for(var b in this._zoomTracks)for(var c=this._zoomTracks[b],d=0;d<c.length;d++)c[d].labelHeight=a,c[d].labelSize=a};
GenomeWidgetProperties.prototype.addCustomTrackByZoom=function(a,b,c,d){c.titleWidth=5<c.titleName.length?5*c.titleName.length:25;this.customTracks.push(c);!1==c instanceof HistogramFeatureTrack&&!1==c instanceof SNPFeatureTrack&&(c.labelHeight=this.labelHeight,c.featureHeight=this.featureHeight);this.addTrackByZoom(a,b,c,d)};GenomeWidgetProperties.prototype.addTrackByZoom=function(a,b,c,d){for(null==this.tracks[c.titleName]&&(this.tracks[c.titleName]=!0);a<=b;a+=10)this._zoomTracks[a].push(c),this._zoomDataAdapters[a].push(d)};
GenomeWidgetProperties.prototype.getTrackByZoom=function(a){for(var b=[],c=0;c<this._zoomTracks[a].length;c++)!0==this.tracks[this._zoomTracks[a][c].titleName]&&b.push(this._zoomTracks[a][c]);return b};GenomeWidgetProperties.prototype.getDataAdapterByZoom=function(a){for(var b=[],c=0;c<this._zoomTracks[a].length;c++)!0==this.tracks[this._zoomTracks[a][c].titleName]&&b.push(this._zoomDataAdapters[a][c]);return b};GenomeWidgetProperties.prototype.getPixelRatio=function(){return this._zoomLevels[this.getZoom()]};
GenomeWidgetProperties.prototype.setZoom=function(a){this._zoom=a;this._pixelRatio=this.getPixelRatioByZoomLevel(this.getZoom());this.windowSize=this._windowSizeLevels[a]};GenomeWidgetProperties.prototype.getZoom=function(){return this._zoom};GenomeWidgetProperties.prototype.getPixelRatioByZoomLevel=function(a){return 100==a?10:this._zoomLevels[a]};GenomeWidgetProperties.prototype.getCustomTracks=function(){return this.customTracks};GenomeWidgetProperties.prototype.getCustomDataAdapters=function(){return this.customDataAdapters};
GenomeWidgetProperties.prototype.addNativeTracks=function(){this.addSequenceTracks();this.addSNPTracks();this.addCytobandTracks();this.addMultifeatureTracks();this.addTFBSTracks();this.addHistoneTracks();this.addPolymeraseTracks();this.addOpenChromatinTracks();this.addMirnaTargetTracks();this.addConservedRegionsTracks();this.tracks.SNP=!1;this.tracks.Sequence=!1;this.tracks.Cytoband=!1;this.tracks.Histone=!1;this.tracks["Open Chromatin"]=!1;this.tracks.Polymerase=!1;this.tracks.TFBS=!1;this.tracks["miRNA targets"]=
!1;this.tracks["Conserved regions"]=!1};
GenomeWidgetProperties.prototype.addSNPTracks=function(){var a=new SNPFeatureTrack(this.id+"snp",this.tracksPanel,this.species,{top:5,left:0,label:!0,title:"SNP",height:20,isAvalaible:!1});this.addTrackByZoom(0,80,a,new RegionCellBaseDataAdapter(this.species,{resource:"snp"}));a=new SNPFeatureTrack(this.id+"snp",this.tracksPanel,this.species,{top:5,left:0,label:!1,title:"SNP",height:20,labelHeight:this.labelHeight,featureHeight:10,labelSize:this.labelSize,pixelSpaceBetweenBlocks:150,avoidOverlapping:!1,
backgroundColor:"#FFFFFF"});this.addTrackByZoom(90,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"snp"}));a=new SNPFeatureTrack(this.id+"snp",this.tracksPanel,this.species,{top:5,left:0,label:!0,title:"SNP",height:20,labelHeight:this.labelHeight,featureHeight:10,labelSize:this.labelSize,pixelSpaceBetweenBlocks:150,avoidOverlapping:!0,backgroundColor:"#FFFFFF"});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"snp"}))};
GenomeWidgetProperties.prototype.addSequenceTracks=function(){var a=new SequenceFeatureTrack(this.id+"sequence",this.tracksPanel,this.species,{top:20,title:"Sequence",height:15,featureHeight:12,avoidOverlapping:!1,backgroundColor:"#FFFFFF",isAvalaible:!1});this.addTrackByZoom(0,90,a,new RegionCellBaseDataAdapter(this.species));a=new SequenceFeatureTrack(this.id+"sequence",this.tracksPanel,this.species,{top:20,title:"Sequence",height:15,featureHeight:12,avoidOverlapping:!1,backgroundColor:"#FFFFFF"});
this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"sequence"}))};
GenomeWidgetProperties.prototype.addCytobandTracks=function(){this.addTrackByZoom(0,0,new FeatureTrack(this.id+"_cytoband",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Cytoband",allowDuplicates:!0,label:!1}),new RegionCellBaseDataAdapter(this.species,{resource:"cytoband"}));this.addTrackByZoom(10,100,new FeatureTrack(this.id+"_cytoband",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,
featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Cytoband",allowDuplicates:!0,label:!0}),new RegionCellBaseDataAdapter(this.species,{resource:"cytoband"}))};
GenomeWidgetProperties.prototype.addMirnaTargetTracks=function(){var a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"miRNA targets",allowDuplicates:!1,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0,isAvalaible:!1});this.addTrackByZoom(0,70,a,new RegionCellBaseDataAdapter(this.species,{resource:"mirnatarget"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,
this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"miRNA targets",allowDuplicates:!1,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0,showLabelsOnMiddleMarker:!0});this.addTrackByZoom(80,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"mirnatarget"}))};
GenomeWidgetProperties.prototype.addOpenChromatinTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Open Chromatin",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:5E5});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));
a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Open Chromatin",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));a=new HistogramFeatureTrack(this.id+"_multiTrack",
this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Open Chromatin",titleFontSize:9,titleWidth:100,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,
title:"Open Chromatin",allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Open Chromatin",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0,showLabelsOnMiddleMarker:!0});
this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=open chromatin"}))};
GenomeWidgetProperties.prototype.addPolymeraseTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Polymerase",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:5E5});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));
a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Polymerase",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,
this.species,{top:20,left:0,height:20,featureHeight:18,title:"Polymerase",titleFontSize:9,titleWidth:70,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Polymerase",
allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=Polymerase"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Polymerase",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,
{resource:"regulatory?type=Polymerase"}))};
GenomeWidgetProperties.prototype.addHistoneTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:40,featureHeight:40,title:"Histone",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08"});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE&histogram=true&interval=250000"}));a=
new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:40,featureHeight:40,title:"Histone",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE&histogram=true&interval=125000"}));a=new HistogramFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"Histone",titleFontSize:9,titleWidth:70,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,
title:"Histone",allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,90,a,new RegionCellBaseDataAdapter(this.species,{resource:"regulatory?type=HISTONE"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Histone",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,
{resource:"regulatory?type=HISTONE"}))};
GenomeWidgetProperties.prototype.addTFBSTracks=function(){var a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"TFBS",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:5E5});this.addTrackByZoom(0,0,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new HistogramFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,title:"TFBS",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"#298A08",intervalSize:25E4});this.addTrackByZoom(10,10,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:20,featureHeight:18,
title:"TFBS",titleFontSize:9,titleWidth:70,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,forceColor:"#298A08",intervalSize:7812.5});this.addTrackByZoom(20,20,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"TFBS",allowDuplicates:!0,label:!1,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0});this.addTrackByZoom(30,
90,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}));a=new FeatureTrack(this.id+"_tfbs",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"TFBS",allowDuplicates:!0,label:!0,pixelSpaceBetweenBlocks:100,avoidOverlapping:!0});this.addTrackByZoom(100,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"tfbs"}))};
GenomeWidgetProperties.prototype.addConservedRegionsTracks=function(){var a=new FeatureTrack(this.id+"_conservedregion",this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,allowDuplicates:!0,label:!1,titleWidth:92,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0,title:"Conserved regions"});this.addTrackByZoom(0,50,a,new RegionCellBaseDataAdapter(this.species,{resource:"conservedregion"}));a=new FeatureTrack(this.id+"_conservedregion",
this.tracksPanel,this.species,{top:10,height:20,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,allowDuplicates:!0,label:!0,titleWidth:92,pixelSpaceBetweenBlocks:0,avoidOverlapping:!0,title:"Conserved regions"});this.addTrackByZoom(60,100,a,new RegionCellBaseDataAdapter(this.species,{resource:"conservedregion"}))};
GenomeWidgetProperties.prototype.addMultifeatureTracks=function(){this.addTrackByZoom(0,10,new HistogramFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:40,featureHeight:40,title:"Gene/Transcript",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!0,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,forceColor:"blue"}),new RegionCellBaseDataAdapter(this.species,{resource:"gene?histogram=true&interval=250000"}));
var a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!1,pixelSpaceBetweenBlocks:1,showDetailGeneLabel:!1,isAvalaible:!0});this.addTrackByZoom(20,20,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!1}));a=new MultiFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:7*this.labelSize,showDetailGeneLabel:!1,isAvalaible:!0});this.addTrackByZoom(30,40,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!1}));this.addTrackByZoom(50,60,new MultiFeatureTrack(this.id+
"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleFontSize:9,titleWidth:70,showTranscripts:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0}),new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!1}));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,
labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!0,showExonLabel:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0});this.addTrackByZoom(70,70,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!0}));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:20,left:0,height:10,labelHeight:this.labelHeight,
featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,showTranscripts:!0,showExonLabel:!1,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0});this.addTrackByZoom(80,80,a,new GeneRegionCellBaseDataAdapter(this.species,{obtainTranscripts:!0}));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:10,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,
labelSize:this.labelSize,title:"Gene/Transcript",titleWidth:70,titleFontSize:9,labelFontSize:8,showTranscripts:!0,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0});this.addTrackByZoom(90,90,a,new GeneRegionCellBaseDataAdapter(this.species));a=new MultiFeatureTrack(this.id+"_multiTrack",this.tracksPanel,this.species,{top:10,left:0,height:10,labelHeight:this.labelHeight,featureHeight:this.featureHeight,labelSize:this.labelSize,title:"Gene/Transcript",
titleWidth:70,titleFontSize:9,labelFontSize:8,showTranscripts:!0,allowDuplicates:!1,backgroundColor:"#FFFFFF",label:!0,pixelSpaceBetweenBlocks:200,showDetailGeneLabel:!0,showLabelsOnMiddleMarker:!0,showExonLabel:!0,onMouseOverShitExonTranscriptLabel:!0});this.addTrackByZoom(100,100,a,new GeneRegionCellBaseDataAdapter(this.species))};
function GenomeWidget(a,b,c){this.id=a;this.targetId=b;this.pixelRatio=0.0010;this.width=100;this.height=500;this.end=this.start=this.chromosome=null;this.viewBoxModule=7E6;this.allowDragging=!0;null!=c&&(null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height),null!=c.pixelRatio&&(this.pixelRatio=c.pixelRatio),null!=c.viewBoxModule&&(this.viewBoxModule=c.viewBoxModule),null!=c.allowDragging&&(this.allowDragging=c.allowDragging));this.trackList=[];this.dataAdapterList=[];this.trackCanvas=
null;this.onMarkerChange=new Event(this);this.onClick=new Event(this);this.onRender=new Event(this);this.onMove=new Event(this)}GenomeWidget.prototype.clear=function(){this.trackCanvas.clear()};GenomeWidget.prototype.init=function(){DOM.removeChilds(this.targetId);this.tracksPanel=DOM.createNewElement("div",document.getElementById(this.targetId),[["id","detail_tracks_container"]])};
GenomeWidget.prototype.getviewBoxModule=function(){for(var a=this.viewBoxModule,b=2E6;this.end*this.pixelRatio%a<this.start*this.pixelRatio%a;)b+=b,a=parseFloat(a)+b;return a};GenomeWidget.prototype.getMiddlePoint=function(){return this.trackCanvas.getMiddlePoint()};GenomeWidget.prototype.addTrack=function(a,b){this.trackList.push(a);this.dataAdapterList.push(b)};
GenomeWidget.prototype.draw=function(a,b,c){this.chromosome=a;this.start=b;this.end=c;var d=this;this.init();this.trackCanvas=new TrackCanvas(this.id+"_canvas",document.getElementById(this.targetId),{top:0,left:0,right:this.width,width:this.width,height:this.height,start:this.start,end:this.end,backgroundColor:"#FFCCFF",pixelRatio:this.pixelRatio,viewBoxModule:this.getviewBoxModule(),allowDragging:this.allowDragging});this.trackCanvas.init();this.trackCanvas.afterDrag.addEventListener(function(){});
this.trackCanvas.onMove.addEventListener(function(a,b){d.onMarkerChange.notify(b)});for(a=0;a<this.trackList.length;a++)this.trackList[a].viewBoxModule=this.getviewBoxModule(),this.trackList[a].pixelRatio=this.pixelRatio,this.trackList[a].targetID=document.getElementById(this.targetId),this.trackCanvas.addTrack(this.trackList[a],this.dataAdapterList[a]);d=this;this.trackCanvas.onRender.addEventListener(function(){d.onRender.notify()});this.trackCanvas.draw(this.chromosome,this.start,this.end)};
function LegendPanel(a){this.width=200;this.height=250;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}
LegendPanel.prototype.getColorItems=function(a){panelsArray=[];for(var b in a){var c=Ext.create("Ext.draw.Component",{width:15,height:15,items:[{type:"rect",fill:a[b],x:0,y:0,width:15,height:15}]}),d=b.replace(/_/gi," "),d=d.charAt(0).toUpperCase()+d.slice(1),c=Ext.create("Ext.panel.Panel",{height:15,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[c,{xtype:"tbtext",text:d,margin:"1 0 0 3"}]});panelsArray.push(c)}return panelsArray};
LegendPanel.prototype.getPanel=function(a){null==this.panel&&(a=this.getColorItems(a),this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:a,width:this.width,height:20*a.length}));return this.panel};LegendPanel.prototype.getButton=function(a){null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{items:[this.getPanel(a)]}}));return this.button};
function LegendWidget(a){this.height=this.width=300;this.title="Legend";null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.legendPanel=new LegendPanel}
LegendWidget.prototype.draw=function(a){var b=this;null==this.panel&&(a=this.legendPanel.getPanel(a),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:a.width+10,height:a.height+70,items:[a],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]}));this.panel.show()};GeneFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;
GeneFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;GeneFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;GeneFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;GeneFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;GeneFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;GeneFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;
GeneFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;GeneFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function GeneFeatureFormatter(a){null!=a&&(this.feature=a,this.start=a.start,this.end=a.end,this.label=this.getLabel(),this.args={},this.args.object=a,this.args.title={},this.args.stroke="#000000",this.args.strokeWidth=0.5,this.args.fill="#"+this._getColor(a),this.args.opacity=1,FeatureFormatter.prototype.constructor.call(this,this.getId(),this.args))}GeneFeatureFormatter.prototype.getId=function(){return this.feature.stableId+"_"+this.feature.start+"_"+this.feature.end};
GeneFeatureFormatter.prototype.getName=function(){return this.feature.stableId};GeneFeatureFormatter.prototype.getLabel=function(){var a=this.feature.externalName;-1==this.feature.strand&&(a="< "+a);1==this.feature.strand&&(a+=" >");return a};GeneFeatureFormatter.prototype.getDetailLabel=function(){var a=this.feature.biotype.replace(/_/gi," "),a=a.charAt(0).toUpperCase()+a.slice(1);return this.getLabel()+" ["+a+"] "};
GeneFeatureFormatter.prototype.getBioTypeColors=function(){return{protein_coding:"a00000",processed_transcript:"0000ff",pseudogene:"666666",miRNA:"8b668b",snRNA:"8b668b",snoRNA:"8b668b",lincRNA:"8b668b",other:"ffffff"}};GeneFeatureFormatter.prototype._getColor=function(a){return-1!=a.biotype.indexOf("pseudogene")?this.getBioTypeColors().pseudogene:null==this.getBioTypeColors()[a.biotype]?this.getBioTypeColors().other:this.getBioTypeColors()[a.biotype]};
TranscriptFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;TranscriptFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;TranscriptFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;TranscriptFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;TranscriptFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;TranscriptFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;
TranscriptFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;TranscriptFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;TranscriptFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function TranscriptFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=this.getLabel();this.exon=[];for(var b=0;b<a.exon.length;b++)this.exon.push(new ExonFeatureFormatter(a.exon[b],a));this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="black";this.args.strokeWidth=1;this.args.fill=this.getBioTypeColors()[a.biotype.toUpperCase()];this.args.size=1;this.args.opacity=0.5;this.args.fontSize=10;this.args.fontColor="#FFFFFF";this.showFeatureStableId=!0;FeatureFormatter.prototype.constructor.call(this,
this.getId(),this.args)}TranscriptFeatureFormatter.prototype.getName=function(){return this.feature.stableId};TranscriptFeatureFormatter.prototype.getId=function(){return this.feature.stableId+"_"+this.feature.start+"_"+this.feature.end};
TranscriptFeatureFormatter.prototype.getBioTypeColors=function(){var a={};a[(new String("protein_coding")).toUpperCase()]="21610B";a[(new String("pseudogene")).toUpperCase()]="ffcc00";a[(new String("snRNA")).toUpperCase()]="424242";a[(new String("lincRNA")).toUpperCase()]="8A0886";a[(new String("processed_transcript")).toUpperCase()]="ff9900";a[(new String("other")).toUpperCase()]="FFFFFF";return a};
TranscriptFeatureFormatter.prototype.getLabel=function(){var a=this.feature.externalName;-1==this.feature.strand&&(a="< "+a);1==this.feature.strand&&(a+=" >");var b=this.feature.biotype.replace(/_/gi," "),b=b.charAt(0).toUpperCase()+b.slice(1);return a+" ["+b+"]"};ExonFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;ExonFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;ExonFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;
ExonFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;ExonFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;ExonFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;ExonFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;ExonFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;ExonFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function ExonFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=a.stableId;this.args={};this.args.title={};this.args.hidden=!1;this.args.opacity=1;this.args.strokeOpacity=1;this.args.fill="#FF0033";this.args.stroke="#3B0B0B";this.args.strokeWidth=1;this.args.size=1;this.args.fontSize=10;this.args.fontColor="#FFFFFF";FeatureFormatter.prototype.constructor.call(this,this.getId(),this.args)}ExonFeatureFormatter.prototype.getName=function(){return this.feature.stableId};
ExonFeatureFormatter.prototype.getId=function(){return this.feature.stableId+"_"+this.feature.start+"_"+this.feature.end};SNPFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;SNPFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;SNPFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;SNPFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;SNPFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;
SNPFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;SNPFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;SNPFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;SNPFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function SNPFeatureFormatter(a){null!=a&&(this.feature=a,this.start=a.start,this.end=a.end,this.label=a.name+" ("+a.alleleString+")",this.base=a.alleleString.split("/")[1],this.args={},this.args.stroke="#f55959",this.args.strokeOpacity=1,this.args.strokeWidth=1,this.args.fill=this._getColor(a),this.args.opacity=1,FeatureFormatter.prototype.constructor.call(this,a.name,this.args))}SNPFeatureFormatter.prototype.getName=function(){return this.feature.name};
SNPFeatureFormatter.prototype.getFeatureColor=function(a){return"A"==a?"#90EE90":"T"==a?"#E066FF":"G"==a?"#FFEC8B":"C"==a?"#B0C4DE":"#CC00CC"};
SNPFeatureFormatter.prototype.getBioTypeColors=function(){return{"2KB_upstream_variant":"a2b5cd","5KB_upstream_variant":"a2b5cd","500B_downstream_variant":"a2b5cd","5KB_downstream_variant":"a2b5cd","3_prime_UTR_variant":"7ac5cd","5_prime_UTR_variant":"7ac5cd",coding_sequence_variant:"458b00",complex_change_in_transcript:"00fa9a",frameshift_variant:"ff69b4",incomplete_terminal_codon_variant:"ff00ff",inframe_codon_gain:"ffd700",inframe_codon_loss:"ffd700",initiator_codon_change:"ffd700",non_synonymous_codon:"ffd700",
intergenic_variant:"636363",intron_variant:"02599c",mature_miRNA_variant:"458b00",nc_transcript_variant:"32cd32",splice_acceptor_variant:"ff7f50",splice_donor_variant:"ff7f50",splice_region_variant:"ff7f50",stop_gained:"ff0000",stop_lost:"ff0000",stop_retained_variant:"76ee00",synonymous_codon:"76ee00",other:"ffffff"}};SNPFeatureFormatter.prototype._getColor=function(a){return this.getBioTypeColors()[a.displaySoConsequence]};SequenceFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;
SequenceFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;SequenceFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;SequenceFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;SequenceFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;SequenceFormatter.prototype.getId=FeatureFormatter.prototype.getId;SequenceFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;SequenceFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;
SequenceFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;function SequenceFormatter(a){this.start=a.start;this.end=a.end;this.label=a.base;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#FFFFFF";this.args.strokeOpacity=0.6;this.args.strokeWidth=1;this.args.fill=this.getFeatureColor(a.base);this.args.size=1;this.args.opacity=0.6;this.args.fontSize=10;this.args.fontColor="#FFFFFF";FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}
SequenceFormatter.prototype.getName=function(){return this.label};SequenceFormatter.prototype.getFeatureColor=function(a){return"A"==a?"#90EE90":"T"==a?"#E066FF":"G"==a?"#FFEC8B":"C"==a?"#B0C4DE":"#CC00CC"};VCFFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;VCFFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;VCFFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;VCFFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;
VCFFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;VCFFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;VCFFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;VCFFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;VCFFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function VCFFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end-1;this.label=a.label;this.base=a.alt;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#000000";this.args.strokeOpacity=1;this.args.strokeWidth=0.1;this.args.fill="purple";this.args.size=1;this.args.opacity=1;this.feature.samples=a.all[9];FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}
VCFFeatureFormatter.prototype.getName=function(){return this.feature.chromosome+":"+this.feature.start+"-"+this.feature.alt};GFFFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;GFFFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;GFFFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;GFFFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;GFFFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;
GFFFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;GFFFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;GFFFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;GFFFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function GFFFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=a.label;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="blue";this.args.strokeOpacity=1;this.args.strokeWidth=0.4;this.args.fill="purple";this.args.size=1;this.args.opacity=null!=a.score?1*a.score/1E3:0.5;this.args.fontColor="blue";FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}GFFFeatureFormatter.prototype.getName=function(){return this.label};
BEDFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;BEDFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;BEDFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;BEDFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;BEDFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;BEDFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;
BEDFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;BEDFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;BEDFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function BEDFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=a.label;this.score=a.score;0>this.score&&(this.score=0);1E3<this.score&&(this.score=1E3);var b=Math.abs(Math.ceil(0.255*this.score)-255).toString(16);this.args={};this.args.title={};this.args.hidden=!1;this.args.strokeOpacity=1;this.args.strokeWidth=1;this.args.fill="#"+b+b+b;this.args.stroke="#000000";FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}
BEDFeatureFormatter.prototype.getName=function(){return this.label};CytobandFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;CytobandFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;CytobandFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;CytobandFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;CytobandFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;
CytobandFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;CytobandFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;CytobandFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;CytobandFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function CytobandFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=a.cytoband;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#000000";this.args.strokeOpacity=0.1;this.args.strokeWidth=0.5;this.args.fill=this.getColor(a);this.args.size=1;this.args.opacity=1;this.args.fontSize=10;this.args.fontColor="blue";FeatureFormatter.prototype.constructor.call(this,a.cytoband,this.args)}
CytobandFeatureFormatter.prototype.getColor=function(a){if("gneg"==a.stain)return"white";if("stalk"==a.stain)return"#666666";if("gvar"==a.stain)return"#CCCCCC";if(-1!=a.stain.indexOf("gpos")){var b=a.stain.replace("gpos","");if(25==b)return"silver";if(50==b)return"gray";if(75==b)return"darkgray";if(100==b)return"black"}return"acen"==a.stain?"blue":"purple"};MarkerRuleFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;MarkerRuleFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;
MarkerRuleFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;MarkerRuleFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;MarkerRuleFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;MarkerRuleFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;MarkerRuleFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;MarkerRuleFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;
MarkerRuleFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function MarkerRuleFeatureFormatter(a){this.start=a.start;this.end=a.end;this.label=this.start;this.isLabeled=!1;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#FFFFFF";this.args.strokeOpacity=0.6;this.args.strokeWidth=1;this.args.fill="black";this.args.size=1;this.args.opacity=0.1;a.label&&(this.isLabeled=!0,this.args.opacity=0.2);this.args.fontSize=10;this.args.fontColor="#FFFFFF";FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}
DASFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;DASFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;DASFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;DASFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;DASFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;DASFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;
DASFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;DASFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;DASFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function DASFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=a.id;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#FFFFFF";this.args.strokeOpacity=1;this.args.strokeWidth=1;this.args.fill="purple";this.args.size=1;this.args.opacity="1";this.args.fontSize=10;FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}GenericFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;
GenericFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;GenericFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;GenericFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;GenericFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;GenericFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;GenericFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;
GenericFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;GenericFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function GenericFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=this.getLabel(a);this.base=a.alt;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#000000";this.args.strokeOpacity=1;this.args.strokeWidth=0.1;this.args.fill="purple";this.args.size=1;this.args.opacity=1;FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}
GenericFeatureFormatter.prototype.getLabel=function(a){return null!=a.externalName?a.externalName:null!=a.stableId?a.stableId:null!=a.name?a.name:null!=a.label?a.label:a.chromosome+":"+a.start+"-"+a.end};TfbsFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;TfbsFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;TfbsFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;TfbsFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;
TfbsFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;TfbsFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;TfbsFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;TfbsFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;TfbsFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;
function TfbsFeatureFormatter(a){this.feature=a;this.start=a.start;this.end=a.end;this.label=this.getLabel(a);this.base=a.alt;this.args={};this.args.stroke="#000000";this.args.strokeOpacity=1;this.args.strokeWidth=0.5;this.args.fill=this.getColors()[a.cellType];this.args.opacity=1;FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}TfbsFeatureFormatter.prototype.getName=function(){return this.feature.tfName};
TfbsFeatureFormatter.prototype.getLabel=function(a){return a.tfName+" ["+a.cellType+"]"};TfbsFeatureFormatter.prototype.getColors=function(){return{CD4:"38610B",GM06990:"4B8A08",GM12878:"5FB404",H1ESC:"74DF00","HeLa-S3":"80FF00",HepG2:"9AFE2E",HUVEC:"ACFA58",IMR90:"BEF781",K562:"E1F5A9",K562b:"ECF6CE",NHEK:"F1F8E0",other:"ffffff"}};MiRNAFeatureFormatter.prototype.setProperties=FeatureFormatter.prototype.setProperties;MiRNAFeatureFormatter.prototype.getDefault=FeatureFormatter.prototype.getDefault;
MiRNAFeatureFormatter.prototype.getSelected=FeatureFormatter.prototype.getSelected;MiRNAFeatureFormatter.prototype.getOver=FeatureFormatter.prototype.getOver;MiRNAFeatureFormatter.prototype.getDragging=FeatureFormatter.prototype.getDragging;MiRNAFeatureFormatter.prototype.getId=FeatureFormatter.prototype.getId;MiRNAFeatureFormatter.prototype.toJSON=FeatureFormatter.prototype.toJSON;MiRNAFeatureFormatter.prototype.loadFromJSON=FeatureFormatter.prototype.loadFromJSON;
MiRNAFeatureFormatter.prototype._setEvents=FeatureFormatter.prototype._setEvents;function MiRNAFeatureFormatter(a){console.log(a);this.feature=a;this.start=a.start;this.end=a.end;this.label=this.getLabel(a);this.base=a.alt;this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="#000000";this.args.strokeOpacity=1;this.args.strokeWidth=0.1;this.args.fill="purple";this.args.size=1;this.args.opacity=1;FeatureFormatter.prototype.constructor.call(this,a.start,this.args)}
MiRNAFeatureFormatter.prototype.getLabel=function(a){return a.mirbaseId+"["+a.geneTargetName+"]"};function FeatureFormatter(a,b,c,d,e){this.id=a;this.internalId=Math.random();this.args={};this.defaultFormat=new ItemFeatureFormat(b);this.selected=null!=c?new ItemFeatureFormat(c):new ItemFeatureFormat(b);this.over=null!=d?new ItemFeatureFormat(d):new ItemFeatureFormat(b);this.dragging=null!=e?new ItemFeatureFormat(e):new ItemFeatureFormat(b);this.stateChanged=new Event(this);this._setEvents()}
FeatureFormatter.prototype.getType=function(){return this.args.type};FeatureFormatter.prototype.toJSON=function(){var a=this.args;a.defaultFormat=this.getDefault().toJSON();a.over=this.getOver().toJSON();a.selected=this.getSelected().toJSON();a.dragging=this.getDragging().toJSON();a.id=this.id;return a};
FeatureFormatter.prototype.loadFromJSON=function(a){this.args=a;this.defaultFormat=new ItemFeatureFormat(a.defaultFormat);this.over=new ItemFeatureFormat(a.over);this.selected=new ItemFeatureFormat(a.selected);this.dragging=new ItemFeatureFormat(a.dragging);this._setEvents()};
FeatureFormatter.prototype._setEvents=function(){var a=this;this.defaultFormat.changed.addEventListener(function(){a.over.setSize(a.defaultFormat.getSize());a.selected.setSize(a.defaultFormat.getSize());a.dragging.setSize(a.defaultFormat.getSize());a.stateChanged.notify(a)});this.selected.changed.addEventListener(function(){a.stateChanged.notify(a)});this.over.changed.addEventListener(function(){a.stateChanged.notify(a)});this.dragging.changed.addEventListener(function(){a.stateChanged.notify(a)})};
FeatureFormatter.prototype.getId=function(){return this.id};FeatureFormatter.prototype.getDefault=function(){return this.defaultFormat};FeatureFormatter.prototype.getSelected=function(){return this.selected};FeatureFormatter.prototype.getOver=function(){return this.over};FeatureFormatter.prototype.getDragging=function(){return this.dragging};
function ItemFeatureFormat(a){this.defaultFormat={};this.args={};this.args.title={};this.args.hidden=!1;this.args.stroke="black";this.args.strokeOpacity=0.8;this.args.strokeWidth=1;this.args.fill="white";this.args.size=1;this.args.opacity=1;this.args.fontSize="8";this.args.fontColor="black";null!=a&&(null!=a.opacity&&(this.args.opacity=a.opacity),null!=a.size&&(this.args.size=a.size),null!=a.hidden&&(this.args.hidden=a.hidden),null!=a.stroke&&(this.args.stroke=a.stroke),null!=a.strokeOpacity&&(this.args.strokeOpacity=
a.strokeOpacity),null!=a.strokeWidth&&(this.args.strokeWidth=a.strokeWidth),null!=a.shape&&(this.args.shape=a.shape),null!=a.fill&&(this.args.fill=a.fill),null!=a.fontSize&&(this.args.fontSize=a.fontSize));this.changed=new Event}
ItemFeatureFormat.prototype.toJSON=function(){null!=this.args.strokeOpacity&&(this.args["stroke-opacity"]=this.args.strokeOpacity,delete this.args.strokeOpacity);null!=this.args.strokeWidth&&(this.args["stroke-width"]=this.args.strokeWidth,delete this.args.strokeWidth);this.args.title["font-color"]=null!=this.args.title.fontColor?this.args.title.fontColor:this.args.fontColor;this.args.title["font-size"]=null!=this.args.title.fontSize?this.args.title.fontSize:this.args.fontSize;return this.args};
ItemFeatureFormat.prototype.getAttribute=function(a){return this.args[a]};ItemFeatureFormat.prototype.setVisible=function(a){this.args.visible!=a&&(this.args.visible=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getVisible=function(){return this.args.visible};ItemFeatureFormat.prototype.setHidden=function(a){this.args.hidden!=a&&(this.args.hidden=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getHidden=function(){return this.args.hidden};
ItemFeatureFormat.prototype.setStroke=function(a){this.args.stroke!=a&&(this.args.stroke=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getStroke=function(){return this.args.stroke};ItemFeatureFormat.prototype.setStrokeOpacity=function(a){this.args.strokeOpacity!=a&&(this.args.strokeOpacity=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getStrokeOpacity=function(){return this.args["stroke-opacity"]};
ItemFeatureFormat.prototype.setStrokeWidth=function(a){this.args.strokeWidth!=a&&(this.args.strokeWidth=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getStrokeWidth=function(){return this.args.strokeWidth};ItemFeatureFormat.prototype.setFill=function(a){this.args.fill!=a&&(this.args.fill=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getFill=function(){return this.args.fill};ItemFeatureFormat.prototype.setSize=function(a){this.args.size!=a&&(this.args.size=a,this.changed.notify(this))};
ItemFeatureFormat.prototype.getSize=function(){return this.args.size};ItemFeatureFormat.prototype.setOpacity=function(a){this.args.opacity!=a&&(this.args.opacity=a,this.changed.notify(this))};ItemFeatureFormat.prototype.getOpacity=function(){return this.args.opacity};ItemFeatureFormat.prototype.getArrowSize=function(){return this.args.arrowSize};ItemFeatureFormat.prototype.setArrowSize=function(a){this.args.arrowSize!=a&&(this.args.arrowSize=a,this.changed.notify(this))};
ItemFeatureFormat.prototype.getFontSize=function(){return this.args.title.fontSize};ItemFeatureFormat.prototype.setFontSize=function(a){this.args.title.fontSize!=a&&(this.args.title.fontSize=a,this.changed.notify(this))};function svgtranscripttrack(a,b,c){featureTrack.prototype.constructor.call(this,a,b,c);this.drawBlocks=!0;this.sizeBetweenBlocks=80;this.consecuenceTypes={};this.consecuenceTypesNames=[]}svgtranscripttrack.prototype.constructor=featureTrack;
svgtranscripttrack.prototype.changeView=featureTrack.prototype.changeView;svgtranscripttrack.prototype.render=featureTrack.prototype.render;svgtranscripttrack.prototype.init=featureTrack.prototype.init;svgtranscripttrack.prototype.createSVGDom=featureTrack.prototype.createSVGDom;svgtranscripttrack.prototype._getTopText=featureTrack.prototype._getTopText;svgtranscripttrack.prototype._getTopFeatures=featureTrack.prototype._getTopFeatures;svgtranscripttrack.prototype._searchSpace=featureTrack.prototype._searchSpace;
svgtranscripttrack.prototype._overlapBlocks=featureTrack.prototype._overlapBlocks;svgtranscripttrack.prototype.drawTitle=featureTrack.prototype.drawTitle;svgtranscripttrack.prototype.mouseMove=featureTrack.prototype.mouseMove;svgtranscripttrack.prototype.mouseclick=featureTrack.prototype.mouseclick;svgtranscripttrack.prototype.getById=featureTrack.prototype.getById;
svgtranscripttrack.prototype.drawFeatures=function(){var a=(this.right-this.left)/(this.end-this.start),b=this.start,c=this.end;this.queues=[];this.queues.push([]);for(var d=0;d<this.featuresView[b+"-"+c].length;d++){var e=this.featuresView[b+"-"+c][d],f=e.color,g=this._searchSpace(e);this.queues[g].push(e);var h=[["fill",f],["id",this.id+"_"+e.name],["stroke-width",0.4],["stroke","white"],["style","cursor:hand"]];JSON.stringify(e);var i=1,j=0,k=0;parseFloat(e.start)>=parseFloat(b)&&parseFloat(e.end)<=
parseFloat(c)&&(i=a*(e.end-e.start),j=this.left+a*(e.start-b),k=this.top+g*this.queueHeight);e.start<b&&e.end<c&&e.end>b&&(i=a*(e.end-b),j=this.left,k=this.top+g*this.queueHeight);e.start>b&&e.end>c&&e.start<c&&(j=this.left+a*(e.start-b),i=this.right-j,k=this.top+g*this.queueHeight);e.start<b&&e.end>c&&(i=this.right-this.left,j=this.left,k=this.top+g*this.queueHeight);h.push(["opacity","1"]);i=Math.ceil(i);SVG.drawRectangle(j,k,i,this.featureHeight,this.trackNodeGroup,h)}for(d=0;d<this.featuresView[b+
"-"+c].length-1;d++){var g=this.featuresView[b+"-"+c][d],i=this.featuresView[b+"-"+c][d+1],h=g.end,l=i.start,j=this.left+a*(h-b);middlePoint=a*(l-h);h=[["fill",f],["id",this.id+"_"+e.name],["stroke-width",1],["opacity","0.5"],["stroke",f]];parseFloat(g.start)>=parseFloat(b)&&parseFloat(g.end)<=parseFloat(c)&&parseFloat(i.start)>=parseFloat(b)&&parseFloat(i.end)<=parseFloat(c)&&(SVG.drawLine(j,k+this.featureHeight/2,j+middlePoint/2,k+this.featureHeight,this.trackNodeGroup,h),SVG.drawLine(j+middlePoint/
2,k+this.featureHeight,j+middlePoint,k+this.featureHeight/2,this.trackNodeGroup,h))}this.drawTitle(this.top+this.queues.length*this.queueHeight)};
function RuleTrack(a,b,c){this.labelNodeGroup=this.mainNodeGroup=this.ruleNodeGroup=null;this.targetID=b;this.top=c.coords.top;this.left=c.coords.left;this.right=c.coords.right;this.width=c.coords.width;this.height=c.coords.height;this.start=c.rule.start;this.end=c.rule.end;this.inc=c.rule.inc;this.mediumDivisionInterval=c.rule.mediumDivisionInterval;this.bigDivisionInterval=c.rule.bigDivisionInterval;this.rulerLabelsTop=this.top+18;this.topRule=this.top+20;this.rulerTraceSmall=4;this.rulerTraceMedium=
8;this.rulerTraceBig=10;this.backgroundColor="#FFFFFF";this.textcolor=this.linecolor="#000000";this.labelBigIntervals=!0;this.labelMediumIntervals=!1;null!=c.optional&&(null!=c.optional.backgroundcolor&&(this.backgroundColor=c.optional.backgroundcolor),null!=c.optional.linecolor&&(this.linecolor=c.optional.linecolor),null!=c.optional.textcolor&&(this.textcolor=c.optional.textcolor),null!=c.optional.labelBigIntervals&&(this.labelBigIntervals=c.optional.labelBigIntervals),null!=c.optional.labelMediumIntervals&&
(this.labelMediumIntervals=c.optional.labelMediumIntervals));this.id=a;this.idMain=this.namesID=this.rulerID=null;this.click=new Event(this)}RuleTrack.prototype.createSVGDom=function(a,b,c,d,e){a=document.getElementById(a);this._svg=SVG.createSVGCanvas(a,[["id",b]]);SVG.drawRectangle(0,0,c,d,this._svg,[["fill",e],[b,b+"_background"]]);this.idMain=this._svg.getAttribute("id")+"_Main";this.idRule=this._svg.getAttribute("id")+"_Rule";this.idLabels=this._svg.getAttribute("id")+"_Names";return this._svg};
RuleTrack.prototype.changeView=function(a,b){this.start=a;this.end=b};
RuleTrack.prototype.init=function(){this._svg=this.createSVGDom(this.targetID,this.id,this.width,this.height,this.backgroundColor);this.mainNodeGroup=SVG.drawGroup(this._svg,[["id",this.idMain]]);this.ruleNodeGroup=SVG.drawGroup(this.mainNodeGroup,[["id",this.idRule]]);this.labelNodeGroup=SVG.drawGroup(this.mainNodeGroup,[["id",this.idLabels]]);var a=this;this._svg.addEventListener("mousemove",function(b){a.mouseMove(b,a)},!1);this._svg.addEventListener("mousedown",function(b){a.mouseDown(b,a)},!1);
this._svg.addEventListener("mouseup",function(b){a.mouseUp(b,a)},!1)};RuleTrack.prototype.mouseMove=function(){};RuleTrack.prototype.mouseDown=function(){};RuleTrack.prototype.mouseUp=function(){};
RuleTrack.prototype.render=function(){this.init();for(var a=0,b=(this.end-this.start)/this.inc,c=(this.right-this.left)/((this.end-this.start)/this.inc),d=0;d<=b;d+=1){var e=x2=this.left+d*c,f=this.topRule,g=this.rulerTraceSmall,h=parseFloat(this.start)+parseFloat(d*this.inc),i=!1,h=Math.ceil(h/1E3)+" Kb";0==d%this.bigDivisionInterval&&(g=this.rulerTraceBig,this.labelBigIntervals&&(SVG.drawText(e,this.rulerLabelsTop,h,this.labelNodeGroup,[["font-size",12],["fill",this.textcolor]]),SVG.drawRectangle(e-
2,this.rulerLabelsTop-12,50,15,this._svg,[["fill",this.textcolor],["opacity","0.2"],["rx","5"],["ry","5"]]),i=!0));0==d%this.mediumDivisionInterval&&this.labelMediumIntervals&&!i&&(g=this.rulerTraceMedium,SVG.drawRectangle(e-2,this.rulerLabelsTop-12,50,15,this._svg,[["fill",this.textcolor],["opacity","0.1"],["rx","5"],["ry","3"]]),SVG.drawText(e,this.rulerLabelsTop,h,this.labelNodeGroup,[["font-size",10],["fill",this.textcolor]]));SVG.drawLine(e,f,x2,this.topRule+g,this.ruleNodeGroup,[["stroke",this.linecolor]]);
a++}SVG.drawLine(this.left,f,this.right,f,this.ruleNodeGroup,[["stroke",this.linecolor]])};
