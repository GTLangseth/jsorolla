<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->


<dom-module id="variant-report-view">
    <template>
        <style include="jso-styles">
            label {
                /*padding-top: 10px;*/
                margin-left: 10px;
            }

            .clinical-input-group-addon {
                min-width: 200px;
                text-align: left;
            }

            .form-control:disabled{
                background-color:white;
                cursor:  default
            }
            h3{
                color:rgb(51, 122, 183);
            }

        </style>

        <br>
        <div id="{{prefix}}reportDiv" class="panel panel-default" style="overflow-y: auto; height:550px;">
            <div class="panel-body">
                <h2 style="margin: 10px 5px 15px 25px">{{title}} Report</h2>
                <div style="float: right; padding: 0px 0px 10px 5px">
                    <span>{{requestDate}}</span>
                </div>
                <br>
                <!-- Analysis Information -->
                <div style="margin: 10px 5px 10px 50px" class="analysis-information col-sm-12"
                     id="{{prefix}}analysisInformationDiv" hidden>
                    <h3>Analysis Information</h3>
                    <hr>
                    <div style="margin: 10px 0px 15px 5px" class="analysis-information col-sm-10"
                         id="{{prefix}}analysisInformationContent">
                        <div class="col-xs-10 row" id="{{prefix}}analysisInformationID" hidden>
                            <label for="{{prefix}}analysisID" class=" col-form-label">Analysis ID:</label>
                                <span class$=" {{prefix}}TextInput" id="{{prefix}}analysisID"
                                      name="analysis"></span>
                        </div>
                        <div class="row" id="{{prefix}}analysisInformationResume" hidden>
                            <div class="col-xs-3">
                                <label for="{{prefix}}analysisType" class="col-form-label">Analysis Type:</label>
                                <span class$="{{prefix}}TextInput" id="{{prefix}}analysisType"
                                           name="analysisType"></span>
                            </div>
                            <div class="col-xs-3">
                                <label for="{{prefix}}date" class="col-form-label">Date:</label>
                                <span  class$="col-form-label {{prefix}}TextInput" id="{{prefix}}date"
                                           name="date"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <br>

                <div style="margin: 10px 5px 15px 50px" class="sample-information col-sm-12"
                     id="{{prefix}}sampleInformationDiv" hidden>
                    <h3>Proband Information</h3>
                    <hr>
                    <!-- Sample information related to proband -->
                    <div style="margin: 0px 0px 0px 30px">
                        <h4> Proband </h4>
                        <div style="margin: 10px 0px 15px 5px" class="analysis-information col-sm-10"
                             id="{{prefix}}analysisInformationProband">
                            <div class="row">
                                <div class="col-xs-5">
                                    <label for="{{prefix}}IndividualID" class="col-form-label">Patient ID:</label>
                                    <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}IndividualID"
                                           name="individualID"></span>
                                </div>
                                <div class="col-xs-5">
                                    <label for="{{prefix}}SampleID" class="col-form-label">Sample ID:</label>
                                    <span  class$="col-form-control {{prefix}}TextInput" id="{{prefix}}SampleID"
                                           name="date"></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-5">
                                    <label for="{{prefix}}ChromosomalGender" class="col-form-label">Chromosomal
                                        Gender:</label>
                                    <span class$="col-form-control {{prefix}}TextInput"
                                           id="{{prefix}}ChromosomalGender" name="chromosomalGender"></span>
                                </div>
                                <div class="col-xs-5">
                                    <label for="{{prefix}}AffectationStatus" class="col-form-label">Affectation
                                    Status:</label>
                                    <span class$="col-form-control {{prefix}}TextInput"
                                           id="{{prefix}}AffectationStatus" name="date"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-xs-5">
                                    <label for="{{prefix}}Ethnicity" class="col-form-label">Ethnicity:</label>
                                    <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}Ethnicity"
                                           name="ethnicity"></span>
                                </div>
                                <div class="col-xs-5">
                                    <label for="{{prefix}}BirthYear" class="col-form-label">Year of Birth:</label>
                                    <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}BirthYear"
                                           name="birthYear"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="{{prefix}}HPO" class="col-xs-2 col-form-label">HPO:</label>
                                <div class="col-xs-6">
                                    <textarea class$="form-control {{prefix}}TextInput" id="{{prefix}}HPO" name="HPO"
                                              disabled value="" style="resize:none" rows="2"></textarea>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="{{prefix}}Diagnosis" class="col-xs-2 col-form-label">Diagnosis:</label>
                                <div class="col-xs-6">
                                    <textarea class$="form-control {{prefix}}TextInput" id="{{prefix}}Diagnosis"
                                              name="diagnosis" disabled value="" style="resize:none" rows="2"></textarea>
                                </div>
                            </div>
                            <div class="row col-sm-10">
                                <label for="{{prefix}}ParentalConsanguinity" class="col-form-label">Parental
                                    Consanguinity:</label>
                                <span class$="col-form-control {{prefix}}TextInput"
                                           id="{{prefix}}ParentalConsanguinity" name="parentalConsanguinity"></span>

                            </div>
                            <div class="row col-sm-10" id="{{prefix}}sampleTypeDiv">
                                <label for="{{prefix}}sampleType" class="col-form-label">Sample Type:</label>
                                <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}sampleType"
                                           name="sampleType"></span>
                            </div>
                            <div class="row col-sm-10" id="{{prefix}}cellLineDiv">
                                <label for="{{prefix}}cellLine" class="col-form-label">Cell line:</label>
                                <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}cellLine"
                                           name="cellLine"></span>
                            </div>
                            <div class="row col-sm-10" id="{{prefix}}lifeStatusDiv">
                                <label for="{{prefix}}lifeStatus" class="col-form-label">Life Status:</label>
                                <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}lifeStatus"
                                           name="lifeStatus"></span>
                            </div>
                            <div class="form-group row col-sm-10" id="{{prefix}}birthPlaceDiv">
                                <label for="{{prefix}}lifeStatus" class="col-form-label">Birth Place:</label>
                                <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}birthPlace"
                                           name="birthPlace"></span>
                            </div>

                            <!-- Sample information related to variable set -->
                            <template id="{{prefix}}VariableTemplate" is="dom-repeat" items="{{variables}}" as="variable"
                                      sort="_sortVariables">
                                <div class="row" id="{{prefix}}{{variable.name}}Div">

                                    <template is="dom-if" if="{{checkSubType(variable, 'TEXT')}}">
                                        <label for="{{prefix}}{{variable.name}}" class="col-xs-2 col-form-label">{{variable.title}}</label>
                                        <div class="col-xs-6">
                                            <textarea class$="form-control {{prefix}}TextInput"
                                                      id="{{prefix}}{{variable.name}}" name="{{variable.name}}" disabled
                                                      value="" style="resize:none" rows="3"></textarea>
                                        </div>
                                    </template>
                                    <template is="dom-if" if="{{!checkSubType(variable, 'TEXT')}}">
                                        <div class="col-xs-10">
                                            <label for="{{prefix}}{{variable.name}}" class="col-form-label">{{variable.title}}</label>
                                            <span class$="col-form-control {{prefix}}TextInput"
                                                   id="{{prefix}}{{variable.name}}" name="{{variable.name}}"></span>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>

                        </div>
                        <div style="margin: 10px 5px 15px 5px" class="sample-information col-sm-12"
                         id="{{prefix}}analysisInformationFamilyDiv">
                        <h4> Family </h4>
                        <div style="margin: 10px 0px 15px 5px" class="analysis-information col-sm-10">
                            <div>
                                <div id="{{prefix}}PedigreeView" style="padding: 5px 5px;font-size: 10px"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin: 10px 5px 15px 50px" class="prioritization-information col-sm-12"
                     id="{{prefix}}prioritizationInformationDiv" hidden>
                    <h3>Prioritization Information</h3>
                    <hr>
                    <div class="prioritization-summary col-sm-10" id="{{prefix}}variantsTableDiv" hidden>
                        <h4>Variants table</h4>
                        <table id="{{prefix}}variantTable" data-search="false" data-show-columns="false"
                               data-pagination="false" data-page-size="500" data-checkbox-header="false"
                               data-maintain-selected="true" style="cursor: pointer;">
                            <thead style="background-color: #eee"></thead>
                        </table>
                    </div>

                    <div class="prioritization-summary col-sm-12" id="{{prefix}}prioritizationSummaryDiv" hidden>
                        <h4>Summary of results</h4>
                        <div class="form-group row">
                            <div class="col-xs-10">
                                <label for="{{prefix}}totalVariants" class="col-form-label">Total Variants:</label>
                                <span class$="col-form-control {{prefix}}TextInput"
                                       id="{{prefix}}totalVariants" name="totalVariants" value="20"></span>
                            </div>
                            <div class="col-xs-10">
                                <label for="{{prefix}}diagnosticVariants" class="col-xs-2 col-form-label">Diagnostic
                                    Variants:</label>
                                <span class$="col-form-control {{prefix}}TextInput"
                                           id="{{prefix}}diagnosticVariants" name="diagnosticVariants" value="2"></span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-xs-10">
                                <label for="{{prefix}}vus" class="col-form-label">VUS</label>
                                <span class$="col-form-control {{prefix}}TextInput" id="{{prefix}}vus"
                                       name="totalVariants" value="2"></span>
                            </div>
                           <div class="col-xs-10">
                                <label for="{{prefix}}unexpectedVariants" class="col-xs-2 col-form-label">Unexpected
                                Variants:</label>
                                <span class$="col-form-control {{prefix}}TextInput"
                                       id="{{prefix}}unexpectedVariants" name="diagnosticVariants" value="1"></span>
                            </div>
                        </div>
                    </div>

                    <div class="prioritization-summary col-sm-12" id="{{prefix}}filterResumeDiv" hidden>
                        <h4>Filter resume</h4>
                        <template is="dom-if" if="{{filters}}">
                            For this analysis, the following filters were applied for prioritization:
                            <div style="margin: 10px 5px 15px 55px">
                                <br>
                                <ul type="disc">
                                    <template is="dom-repeat" items="{{filterPrioritization}}">
                                        <li>{{item.id}}: <i>{{item.value}}</i></li>
                                    </template>
                                </ul>
                            </div>
                        </template>
                        <template is="dom-if" if="{{!filters}}">
                            No filters were applied for this analysis
                        </template>
                    </div>
                </div>
                <div style="margin: 10px 15px 15px 50px" class="other-information col-sm-12"
                     id="{{prefix}}conclusionsDiv" hidden>
                    <h3>Other Information</h3>
                    <hr>
                    <div class="col-sm-10">
                        <textarea type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}conclusions"
                                  name="conclusions" placeholder="Editable conclusions" style="resize:none" row="5"
                                  maxlength="300" on-change="updateTextArea"></textarea>
                    </div>
                </div>


            </div>
        </div>

        <!-- Modal dialog for Variants table-->
        <!--        <div class="modal fade" id="{{prefix}}variantsClassificationModal" tabindex="-1" role="dialog"
                     aria-labelledby="variantsClassificationLabel" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-sm" role="document" style="width: 500px;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">Variants classification</h4>
                            </div>
                            <div class="modal-body" style="height: 200px">
                                <div class="col-sm-12" >
                                    <label>Under progress.</label>
                                    Variants table to be shown here. User will classify variants as diagnostic, VUS (Variants of Unkown Significance) and Unexpected variants
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                            </div>
                        </div>
                    </div>
                </div>-->
    </template>
    <script>

        class VariantReportView extends Polymer.Element {
            static get is() {
                return 'variant-report-view';
            }

            static get properties() {
                return {
                    opencgaClient: {
                        type: Object
                    },
                    study: {
                        type: Object
                    },
                    prefix: {
                        type: String
                    },
                    config: {
                        type: Object
                    },
                    selection: {
                        type: Object,
                        observer: 'showSelection'
                    },
                    title: {
                        type: String,
                        value: ""
                    },
                    expReport: {
                        type: Boolean,
                        observer: 'handleExportPDF',
                        //notify: true
                    },
                    variables: {
                        type: Array,
                        observer: 'loadVariableSet'

                    },
//                    analysisSelected: {
//                        type: Object,
//                        observer: 'loadData'
//                    },
                    interpretation: {
                        type: Object,
                        observer: 'loadData'

                    }
                }
            }


            constructor() {
                super();
                this.prefix = "repView" + Utils.randomString(6);
            }

            _attachDom(dom) {
                this.appendChild(dom);
            }

            ready() {
                super.ready();
                if (UtilsNew.isEmpty(this.prefix)) {
                }

                let date = new Date();
                this.requestDate = date.toLocaleString();
                this.fitlerPrioritization = {};

            }

            connectedCallback(){
                super.connectedCallback();
                console.log(this.interpretation);
                this.loadData();
                this.loadVariableSet();
            }

            loadData() {
                // Load data into report

                // Remove content of all elements here before rendering -> TO BE DONE

                if (UtilsNew.isNotUndefined(this.interpretation.clinicalAnalysis)) {
                    // Analysis ID and analysis resume
                    PolymerUtils.setPropertyById(this.prefix + "analysisID", "innerText", this.interpretation.clinicalAnalysis.id);
                    PolymerUtils.setPropertyById(this.prefix + "analysisType", "innerText", this.interpretation.clinicalAnalysis.type);
                    PolymerUtils.setPropertyById(this.prefix + "date", "innerText",this.interpretation.clinicalAnalysis.creationDate);
                    this.analysisID = this.interpretation.clinicalAnalysis.id;
//                    // Sample Information
                    PolymerUtils.setPropertyById(this.prefix + "IndividualID", "innerText", this.interpretation.clinicalAnalysis.subjects[0].name);
                    PolymerUtils.setPropertyById(this.prefix + "AffectationStatus", "innerText",  this.interpretation.clinicalAnalysis.subjects[0].affectationStatus);
                    PolymerUtils.setPropertyById(this.prefix + "BirthYear", "innerText",  this.interpretation.clinicalAnalysis.subjects[0].dateOfBirth);
                    PolymerUtils.setPropertyById(this.prefix + "Ethnicity", "innerText", this.interpretation.clinicalAnalysis.subjects[0].ethnicity);
                    PolymerUtils.setPropertyById(this.prefix + "ChromosomalGender", "innerText",  this.interpretation.clinicalAnalysis.subjects[0].karyotypicSex);
                    PolymerUtils.setPropertyById(this.prefix + "lifeStatus", "innerText",  this.interpretation.clinicalAnalysis.subjects[0].lifeStatus);
                    PolymerUtils.setPropertyById(this.prefix + "ParentalConsanguinity", "innerText",  this.interpretation.clinicalAnalysis.subjects[0].parentalConsanguinity);
                    PolymerUtils.setPropertyById(this.prefix + "birthPlace", "innerText", this.interpretation.clinicalAnalysis.subjects[0].population.name);
                    PolymerUtils.setPropertyById(this.prefix + "SampleID", "innerText",  this.interpretation.clinicalAnalysis.subjects[0].samples[0].name);
//

                    let HPODiseases = this.interpretation.clinicalAnalysis.subjects[0].ontologyTerms.filter((hpo) =>{
                            return hpo.source === "HPO";
                          }).map((hpo) => hpo.name).join(",");
                    PolymerUtils.innerHTML(this.prefix + "HPO",  HPODiseases);
                    let ICD10Diseases = this.interpretation.clinicalAnalysis.subjects[0].ontologyTerms.filter((icd) =>{
                            return icd.source === "ICD10";
                    }).map((icd) => icd.name).join(",");
                    PolymerUtils.innerHTML(this.prefix + "Diagnosis",  ICD10Diseases);
//
                    PolymerUtils.setPropertyById(this.prefix + "cellLine", "innerText", this.interpretation.clinicalAnalysis.subjects[0].samples[0].somatic);
                    PolymerUtils.setPropertyById(this.prefix + "sampleType", "innerText", this.interpretation.clinicalAnalysis.subjects[0].samples[0].type);



                    // Family information (pedigree) -> Only for FAMILY, TRIO or DUO
                    if (this.interpretation.clinicalAnalysis.type === "TRIO" || this.interpretation.clinicalAnalysis.type=== "DUO" || this.interpretation.clinicalAnalysis.type === "FAMILY") {
                        let querySelector = PolymerUtils.getElementById(this.prefix + "PedigreeView");
                        if (querySelector.hasChildNodes()) {
                            let item = querySelector.childNodes[0];
                            querySelector.removeChild(item);
                        }

                        querySelector.appendChild(this.pedigreeRender(this.interpretation.clinicalAnalysis.family));
                    }
                    // Prioritization information (variants)
//                    let _prioritization = this.analysisSelected.analysis.family.children[0].samples[0].attributes.PRIORITIZATION;
//                    let _dataTable = [];
//                    let _query = undefined;
//                    if (UtilsNew.isNotUndefined(_prioritization)) {
//                        _dataTable = this._getVariantsInfo(_prioritization.variants);
//                        _query = _prioritization.query;
//                    }
//
//                    let _this = this;
//                    $(PolymerUtils.getElementById(this.prefix + "variantTable")).bootstrapTable('destroy');
//                    $(PolymerUtils.getElementById(this.prefix + "variantTable")).bootstrapTable({
//                        columns: _this._getTableColumns(),
//                        data: _dataTable
//                    });
//
//                    // Filter information
//                    if (UtilsNew.isNotUndefined(_query)) {
//                        let _filters = $.map(_query, function (value, key) {
//                            if (value !== "") {
//                                return [{id: key, value: value}];
//                            }
//                        });
//                        this.filterPrioritization = _filters;
//                        this.filters = true;
//                    } else {
//                        this.filterPrioritization = "No filters were selected";
//                        this.filters = false;
//                    }


                    // Show divs
                    PolymerUtils.removeAttribute(this.prefix + "analysisInformationDiv", "hidden")
                    PolymerUtils.removeAttribute(this.prefix + "sampleInformationDiv", "hidden")
                    PolymerUtils.removeAttribute(this.prefix + "analysisInformationID", "hidden")
                }
            }

            loadVariableSet(){
                let _this = this;
//                    PolymerUtils.innerHTML(this.prefix + "technicalData", this.analysisSelected.analysis.proband.samples[0].annotationSets[0].annotations[4].value);
                this.interpretation.clinicalAnalysis.subjects[0].samples[0].annotationSets[0].annotations.forEach((annotation) => {
                    PolymerUtils.setValue(_this.prefix + annotation.name, annotation.value);
                });
            }

            showSelection() {
                // Analysis ID
                if (UtilsNew.isNotUndefined(this.analysisSelected)) {
                    PolymerUtils.removeAttribute(this.prefix + "sampleInformationDiv", "hidden")
                }

                // Analysis resume
                if (UtilsNew.isNotUndefined(this.selection.analysisResume)) {
                    PolymerUtils.setPropertyById(this.prefix + "analysisInformationResume", "hidden", !this.selection.analysisResume)

                }

                // Sample Information
                if (UtilsNew.isNotUndefined(this.selection.sampleInfo)) {
                    for (let i = 0; i < this.selection.sampleInfo.length; i++) {
                        //this.$$("#" + this.prefix + this.selection.sampleInfo[i].name + "Div").hidden = !this.selection.sampleInfo[i].value;
                        PolymerUtils.setPropertyById(this.prefix + this.selection.sampleInfo[i].name + "Div", "hidden", !this.selection.sampleInfo[i].value);
                    }
                }

                // Family information (pedigree) -> Only for FAMILY, TRIO or DUO
                if (this.analysisSelected.analysisType === "TRIO" || this.analysisSelected.analysisType === "DUO" || this.analysisSelected.analysisType === "FAMILY") {
                    PolymerUtils.setPropertyById(this.prefix + "analysisInformationFamilyDiv", "hidden", !this.selection.pedigree);
                }

                // Prioritization Information
                if (UtilsNew.isNotUndefined(this.selection.prioritizationInfo)) {
                    let _numFalseElements = 0;
                    for (let i = 0; i < this.selection.prioritizationInfo.length; i++) {
                        if (this.selection.prioritizationInfo[i].name == 'variantsTable' && this.selection.prioritizationInfo[i].value &&
                            PolymerUtils.getElementById(this.prefix + this.selection.prioritizationInfo[i].name + "Div").hidden) {
                            //$('#' + this.prefix + 'variantsClassificationModal').modal("show");
                        }
                        PolymerUtils.setPropertyById(this.prefix + this.selection.prioritizationInfo[i].name + "Div", "hidden", !this.selection.prioritizationInfo[i].value);

                        if (this.selection.prioritizationInfo[i].value == false) {
                            _numFalseElements++;
                        }
                    }

                    if (_numFalseElements == this.selection.prioritizationInfo.length) {
                        PolymerUtils.setAttribute(this.prefix + "prioritizationInformationDiv", "hidden", true);
                    }
                    else {
                        PolymerUtils.removeAttribute(this.prefix + "prioritizationInformationDiv", "hidden");
                    }
                }

                // Editable conclusions
                if (UtilsNew.isNotUndefined(this.selection.conclusions)) {
                    PolymerUtils.setPropertyById(this.prefix + "conclusionsDiv", "hidden", !this.selection.conclusions);

                }
            }

            print(data) {
                var mywindow = window.open('', '', 'height=1000,width=1000');
                mywindow.document.write('<html><head>');
                /* var styles = document.getElementsByTagName('style');

                 mywindow.document.write('<style>');
                 for (var i = 0; i < styles.length; i++) {
                 mywindow.document.write(styles[i].innerHTML);
                 }
                 mywindow.document.write('</style>');*/

                mywindow.document.write('</head><body>');
                mywindow.document.write(data);
                mywindow.document.write('</body></html>');

                mywindow.document.close(); // necessary for IE >= 10
                mywindow.focus(); // necessary for IE >= 10
                mywindow.print();
                mywindow.close();

            }

            _getTextInfo() {
                let sampleInfo = PolymerUtils.getElementById(this.prefix + "sampleInformationDiv");
                let elem = PolymerUtils.querySelectorAll("input", sampleInfo);
                let reportFields = [];
                for (var i = 0; i < elem.length; i++) {
                    reportFields.push({name: elem[i].name, value: elem[i].value});
                }
                this.reportFields = reportFields;

            }

            handleExportPDF(e) {
                let report = document.getElementById(this.prefix + "reportDiv");
                this.print(report.innerHTML);
debugger
//                var pdf = new jsPDF('p', 'pt', 'letter');
//                var canvas = pdf.canvas;
//                canvas.height = 72 * 11;
//                canvas.width = 72 * 8.5;
//                var html = PolymerUtils.getElementById(this.prefix + "reportDiv").textContent;
//                html2pdf(html, pdf, function (pdf) {
//                    pdf.output('dataurlnewwindow');
//                });
                this.expReport = false; // Reset export report button again

            }

            print(data) {
                var mywindow = window.open('', '', 'height=1000,width=1000');
                mywindow.document.write('<html><head>');
                var styles = document.getElementsByTagName('style');
                mywindow.document.write('<style>');
                for (let i = 0; i < styles.length; i++) {
                    mywindow.document.write(styles[i].innerHTML);
                }
                mywindow.document.write('</style>');
                mywindow.document.write('</head><body>');
                mywindow.document.write(data);
                mywindow.document.write('</body></html>');
                mywindow.document.close(); // necessary for IE >= 10
                mywindow.focus(); // necessary for IE >= 10
                mywindow.print();
                mywindow.close();
//                this.$.reportConclusions.querySelector('textarea').hidden = false;
//                this.$.divConclusions.hidden = true;
//                elem = data.querySelectorAll('input');
//                for (let i = 0; i < elem.length; i++) {
//                    var el = elem[i];
//                    var name = el.dataset.name;
//                    el.hidden = false;
//                    this.$[name].hidden = true;
//                }
                return true;
            }

            _sortVariables(a, b) {
                if (a.rank < b.rank) {
                    return -1;
                }
                return 1;
            }

            checkSubType(myVar, type) {
                return (myVar.attributes.subtype === type);
            }

            updateTextArea() {
                PolymerUtils.innerHTML(this.prefix + "conclusions", PolymerUtils.getValue(this.prefix + "conclusions"));
            }

            _getVariantsInfo(variants) {
                let _myVariants = [];
                for (let i = 0; i < variants.length; i++) {
                    _myVariants.push({
                        variant: variants[i].id,
                        genes: variants[i].annotation.consequenceTypes[0].geneName,
                        type: variants[i].type,
                        consequenceType: variants[i].annotation.consequenceTypes[0].sequenceOntologyTerms[0].name
                    });
                }
                return _myVariants;
            }

            _getTableColumns() {
                this._columns = [
                    [
                        {
                            title: 'Variant',
                            field: 'variant'
                        },
                        {
                            title: 'SNP Id',
                            field: 'id'
                        },
                        {
                            title: 'Genes',
                            field: 'genes'
                        },
                        {
                            title: 'Type',
                            field: 'type'
                        },
                        {
                            title: 'Consequence Type',
                            field: 'consequenceType'
                        }
                    ]
                ];
                return this._columns;
            }

            pedigreeRender(body) {
                // Remove SVG before render new one


                // Render new Pedigree
                let pedigree = new Pedigree(body);
                this.svg = pedigree.render();
                return this.svg;
            }

        }

        customElements.define(VariantReportView.is, VariantReportView);

    </script>
</dom-module>