<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Genome Viewer Demo</title>


    <!--css vendor-->
    <link href="../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../vendor/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="../../vendor/bootstrap/slider/css/slider.css" rel="stylesheet">


    <!--css-->
    <!-- build:style bundle -->
    <link href="../resources/css/style.css" rel="stylesheet">
    <!-- /build -->

    <!--js vendor-->
    <script type="text/javascript" src="../../vendor/jquery/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="../../vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../vendor/bootstrap/slider/js/bootstrap-slider.js"></script>

    <script type="text/javascript" src="../../vendor/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="../../vendor/backbone/backbone-min.js"></script>




<!-- CSS -->
<!--<link rel="stylesheet" type="text/css" href="http://jsapi.bioinfo.cipf.es/ext-libs/ChemDoodleWeb-5.1.0/install/ChemDoodleWeb.css"/>-->
<!--<link rel="stylesheet" type="text/css" href="http://jsapi.bioinfo.cipf.es/ext-libs/qtip2/jquery.qtip.min.css"/>-->

<!-- Google Analytics -->

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16414504-2']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
</script>


<!-- EXT-LIBS -->


<!-- jQuery -->
<!--<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />-->
<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>-->


<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/qtip2/jquery.qtip.min.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.sha1.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.url.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.cookie.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jqXMLUtils.js"></script>
<script type="text/javascript"
        src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.smartresize.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.pulse.min.js"></script>


<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/xml2json.js"></script>

<!-- Canvas to SVG converters -->
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/base64.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/canvas2image.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/canvg.js"></script>
<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/rgbcolor.js"></script>

<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/rawdeflate.js"></script>

<!-- 	<script type="text/javascript" src="https://raw.github.com/eligrey/BlobBuilder.js/master/BlobBuilder.min.js"/></script> -->
<!-- 	<script type="text/javascript" src="https://raw.github.com/eligrey/canvas-toBlob.js/master/canvas-toBlob.min.js"/></script> -->
<!-- 	<script type="text/javascript" src="https://raw.github.com/eligrey/FileSaver.js/master/FileSaver.min.js"/></script> -->


<!-- CHEMDOODLE -->
<script type="text/javascript"
        src="http://jsapi.bioinfo.cipf.es/ext-libs/ChemDoodleWeb-5.1.0/install/ChemDoodleWeb-libs.js"></script>
<script type="text/javascript"
        src="http://jsapi.bioinfo.cipf.es/ext-libs/ChemDoodleWeb-5.1.0/install/ChemDoodleWeb.js"></script>


<!-- build:script min -->

<!-- LIBS -->
<!-- js-common-libs utils -->
<script type="text/javascript" src="../utils/event.js"></script>
<script type="text/javascript" src="../utils/svg.js"></script>
<script type="text/javascript" src="../utils/utils.js"></script>


<!-- Genome-viewer -->
<script type="text/javascript" src="gv-config.js"></script>

<!-- js-common-libs ui-widgets -->
<!--<script type="text/javascript" src="../ui-widgets/ux-window.js"></script>-->

<!-- js-common-libs cellbase ui-widgets -->
<script type="text/javascript" src="../cellbase/ui-widgets/info-widget.js"></script>
<script type="text/javascript" src="../cellbase/ui-widgets/gene-info-widget.js"></script>
<script type="text/javascript" src="../cellbase/ui-widgets/protein-info-widget.js"></script>
<script type="text/javascript" src="../cellbase/ui-widgets/snp-info-widget.js"></script>
<script type="text/javascript" src="../cellbase/ui-widgets/transcript-info-widget.js"></script>
<script type="text/javascript" src="../cellbase/ui-widgets/vcf-variant-info-widget.js"></script>

<!-- js-common-libs cellbase ws-manager -->
<script type="text/javascript" src="../cellbase/cellbase-manager.js"></script>

<script type="text/javascript" src="data-adapter/cellbase-adapter.js"></script>
<script type="text/javascript" src="data-adapter/sequence-adapter.js"></script>

<script type="text/javascript" src="region.js"></script>
<script type="text/javascript" src="feature-binary-search-tree.js"></script>
<script type="text/javascript" src="feature-cache.js"></script>


<script type="text/javascript" src="navigation-bar.js"></script>
<script type="text/javascript" src="chromosome-panel.js"></script>
<script type="text/javascript" src="karyotype-panel.js"></script>
<script type="text/javascript" src="tracklist-panel.js"></script>
<script type="text/javascript" src="status-bar.js"></script>


<script type="text/javascript" src="tracks/track.js"></script>
<script type="text/javascript" src="tracks/feature-track.js"></script>
<script type="text/javascript" src="tracks/sequence-track.js"></script>
<script type="text/javascript" src="tracks/gene-track.js"></script>


<script type="text/javascript" src="renderers/renderer.js"></script>
<script type="text/javascript" src="renderers/feature-renderer.js"></script>
<script type="text/javascript" src="renderers/sequence-renderer.js"></script>
<script type="text/javascript" src="renderers/histogram-renderer.js"></script>
<script type="text/javascript" src="renderers/gene-renderer.js"></script>


<!--<script type="text/javascript" src="../ui-widgets/attributes/genomic-attributes-widget.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/attributes/expression-genomic-attributes-widget.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/attributes/genotype-genomic-attributes-widget.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/attributes/attributes-widget.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/attributes/attributes-panel.js"></script>-->
<!---->
<!--<script type="text/javascript" src="../ui-widgets/list/list-panel.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/list/list-widget.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/list/genomic-list-panel.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/list/genomic-list-widget.js"></script>-->

<!--<script type="text/javascript" src="../ui-widgets/input-list-widget.js"></script>-->
<!--<script type="text/javascript" src="../ui-widgets/chart-widget.js"></script>-->

<script type="text/javascript" src="genome-viewer.js"></script>

<!-- /build -->

<script type="text/javascript">

    $(document).ready(function() {

        var region = new Region({chromosome: "13", start: 32889611, end: 32889611});
        this.genomeViewer = new GenomeViewer({
            region: region,
            sidePanel: false,
            targetId: 'application',
            autoRender: true

        }); //the div must exist
        this.genomeViewer.draw();

        this.sequence = new SequenceTrack({
            targetId: null,
            id: 1,
            title: 'Sequence',
            histogramZoom: 20,
            transcriptZoom: 50,
            height: 30,
            visibleRange: {start: 100, end: 100},
            featureTypes: FEATURE_TYPES,

            renderer: new SequenceRenderer(),

            dataAdapter: new SequenceAdapter({
                category: "genomic",
                subCategory: "region",
                resource: "sequence",
                species: this.genomeViewer.species,
                featureCache: {
                    gzip: true,
                    chunkSize: 1000
                }
            })
        });

        this.genomeViewer.addTrack(this.sequence);

        this.gene = new GeneTrack({
            targetId: null,
            id: 2,
            title: 'Gene',
            histogramZoom: 20,
            transcriptZoom: 50,
            height: 100,
            visibleRange: {start: 0, end: 100},
            featureTypes: FEATURE_TYPES,

            renderer: new GeneRenderer(),

            dataAdapter: new CellBaseAdapter({
                category: "genomic",
                subCategory: "region",
                resource: "gene",
                species: this.genomeViewer.species,
                featureCache: {
                    gzip: true,
                    chunkSize: 50000
                },
                filters: {},
                options: {},
                featureConfig: FEATURE_CONFIG.gene
            })
        });

        this.genomeViewer.addTrack(this.gene);

//        this.icgcMutationsTrack = new IcgcTrack({
//            targetId:null,
//            id:3,
//            title:'ICGC Mutations',
//            histogramZoom:70,
//            labelZoom:80,
//            height:100,
//            visibleRange:{start:0,end:100},
//            featureTypes:FEATURE_TYPES,
//
//            renderer:new FeatureRenderer(),
//
//            dataAdapter:new IcgcAdapter({
//                category: "genomic",
//                subCategory: "region",
//                resource: "snp",
//                params:{
//                    exclude:'transcriptVariations,xrefs,samples'
//                },
//                species: this.genomeViewer.species,
//                featureCache:{
//                    gzip: true,
//                    chunkSize:10000
//                },
//                filters:{},
//                options:{},
//                featureConfig:FEATURE_CONFIG.snp
//            })
//        });
//        this.genomeViewer.addTrack(this.icgcMutationsTrack);


        this.snp = new FeatureTrack({
            targetId: null,
            id: 4,
            title: 'SNP',
            histogramZoom: 70,
            labelZoom: 80,
            height: 100,
            visibleRange: {start: 0, end: 100},
            featureTypes: FEATURE_TYPES,
            renderer: new FeatureRenderer({
                label: function (f) {
                    return ('name' in f) ? f.name : f.id;
                },
                tooltipTitle: function (f) {
                    var name = (f.name != null) ? f.name : f.id;
                    return f.featureType.toUpperCase() + ' - <span class="ok">' + name + '</span>';
                },
                tooltipText: function (f) {
                    return 'alleles:&nbsp;<span class="ssel">' + f.alleleString + '</span><br>' +
                            FEATURE_TYPES.getTipCommons(f) +
                            'source:&nbsp;<span class="ssel">' + f.source + '</span><br>';

                },
                color: 'lightblue',
                infoWidgetId: "id",
                height: 8,
                histogramColor: "orange",
                handlers: {
                    'feature:mouseover': function (e) {
                        console.log(e)
                    },
                    'feature:click': function (event) {
                        new SnpInfoWidget(null, genomeViewer.species).draw(event);
                    }
                }
            }),

            dataAdapter: new CellBaseAdapter({
                category: "genomic",
                subCategory: "region",
                resource: "snp",
                params: {
                    exclude: 'transcriptVariations,xrefs,samples'
                },
                species: this.genomeViewer.species,
                featureCache: {
                    gzip: true,
                    chunkSize: 10000
                },
                filters: {},
                options: {},
                featureConfig: FEATURE_CONFIG.snp
            })
        });

        this.genomeViewer.addTrack(this.snp);
    });

</script>
</head>

<body style="overflow: hidden;">
<div style=""></div>
<div id="application" style="position:relative; left:30px; top:30px;"></div>
<div style=""></div>

</body>
</html>
