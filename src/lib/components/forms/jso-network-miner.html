<polymer-element name="jso-network-miner" attributes="">
    <template>
        <link rel="stylesheet" href="../jso-style.css">
        <style>
            :host {
                display: block;
                position: absolute;
                box-sizing: border-box;
                background-color: #FFFFFF;
                padding: 30px 100px;

                z-index: 50000;
                top: 90px;

                left: 0;
                right: 0;
                margin-left: auto;
                margin-right: auto;

                width: 30vw;
                border: 0px solid #c6d0da;
                border-width: 1px;
                /*border-top-width: 1px;*/
                transition: all 0.2s;
                box-shadow: 10px 10px 10px rgba(0, 0, 0, 0.2);
            }
            .title {
                text-align: center;
                font-size: 25px;
                color: #666;
            }

            .icon {
                color: #445D76;
                font-size: 50px;
            }
            label {
                display: inline-block;
                color: #666;
                margin-top: 10px;
            }

            label::after {
                content: ':'
            }

            .action {
                margin-top: 30px;
                background-color: #f5f5f5 !important;
                text-align: center;
            }

            .action:active {
                background-color: #445D76 !important;
                color: #fff !important;
            }

            .message {
                margin-top: 20px;
            }
        </style>
        <div class="title">
            <div>
                Network Miner
            </div>
            <div class="icon">
                <font-awesome icon="magic"></font-awesome>
            </div>
        </div>
        <form id="form" vertical layout>
            <h3>Examples</h3>
            <!--<div class="button action" on-click="{{handleForm}}">Run</div>-->
            <input type="button" id="loadExample1" value="Load example 1" on-click="{{loadExample1}}">
            <h3>Input parameters</h3>

            <label>Enter accession ranked list</label> <textarea id="rankedListArea" value="{{rankedListArea}}" required pattern="[a-zA-Z0-9]+"></textarea>
            <label>Or, upload file</label><div class="button action" on-click="{{rankedListClick}}">{{rankedListFileName}}</div>
            <input type="file" hidden id="rankedListFileName" required on-change="{{rankedListFileNameChange}}">

            <label>Enter accession seed list (optional)</label> <textarea id="seedListArea" value="{{seedListArea}}" required pattern="[a-zA-Z0-9]+"></textarea>
            <label>Or, upload file</label><div class="button action" on-click="{{seedListClick}}">{{seedListFileName}}</div>
            <input type="file" hidden id="seedListFileName" required on-change="{{seedListFileNameChange}}">


            <label>List Nature</label><input type="text" id="list" value="{{list}}">
            <!--<select id="list">-->
                <!--<option value="gene">Genes</option>-->
                <!--<option value="ranked">Ranked</option>-->
                <!--<option value="protein">Proteins</option>-->
                <!--<option value="transcript">Transcripts</option>-->
            <!--</select>-->
            <label>Species</label><input type="text" id="interactome" value="{{interactome}}" required pattern="[a-zA-Z0-9]+">
            <!--<select id="interactome">-->
                <!--<option value="hsa">Homo sapiens</option>-->
            <!--</select>-->

            <label>Select interactome confidence</label><input type="text" id="group" value="{{group}}" required pattern="[a-zA-Z0-9]+">
            <!--<select>-->
                <!--<option value="all">Non curated</option>-->
                <!--<option value="curated">Curated (detected by at least two methods)</option>-->
            <!--</select>-->

            <label>Sort ranked list</label><input type="text" id="order" value="{{group}}" required pattern="[a-zA-Z0-9]+">
            <!--<select>-->
                <!--<option value="ascending">Ascending</option>-->
                <!--<option value="descending">Descending</option>-->
            <!--</select>-->
            <label>Allow one external intermediate in the subnetwork</label><input type="text" id="intermediate" value="{{intermediate}}" required pattern="[a-zA-Z0-9]+">
            <!--<select id="intermediate">-->
                <!--<option value="1">Yes</option>-->
                <!--<option value="0">No</option>-->
            <!--</select>-->
            <label>Select threshold of significance(p-value)</label> <input type="text" id="significant_value" value="{{significant_value}}" required pattern="[a-zA-Z0-9]+">
            <h3>Job information</h3>
            <label>Job name</label> <input type="text" id="jobName" value="{{jobName}}" required pattern="[a-zA-Z0-9]+">
            <div class="button action" on-click="{{handleForm}}">Run</div>
        </form>
        <div class="message">{{message}}</div>
    </template>
    <script>
        Polymer({
            created: function () {
                this.jobName = '';
                this.toolName = "network-miner"
                this.message = '';
                this.rankedListFileName = "Choose file"
                this.seedListFileName = "Choose file"


            },

            handleForm: function (e) {
                var me = this;
                this.message = '';

                //if (this.$.form.checkValidity()) {
                    //me.message = "xx"
                    var params = new Object()

                    OpencgaManager.jobs.run({
                        query: {
                            sid: me.sessionId,
                            analysisId: 1,
                            toolName: me.toolName,
                            name: me.jobName,
                            description: "description",
                            list: 1,
                            seedlist:2,
                            interactome: me.interactome,
                            o_name:"result",
                            intermediate: me.intermediate,
                            group: me.group,
                            order: me.order,

                            //ranked-list:
                        },
                        request: {
                            //method: 'POST',
                            success: function (response) {
                                if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                                    var userId = response.response[0].result[0].id;
                                    me.message = userId + ' created';
                                } else {
                                    me.message = response.response[0].errorMsg;
                                    //Delete cookies
                                    Cookies.expire('bioinfo_sid');
                                    Cookies.expire('bioinfo_user');
                                }
                            },
                            error: function () {
                                me.message = 'Server error, try again later.';
                            }
                        }
                    })
                //}
            },
            loadExample1: function (e) {
                var me = this;
                this.message = '';
                this.rankedListFileName = "BD-GWASplink.txt"
                this.seedListFileName = "BD-associatedgenesUniprot.txt"
                this.list="gene"
                this.interactome="hsa"
                this.group = "all"
                this.order = "ascending"
                this.intermediate = 1
                this.significant_value = 0.05
                this.jobName = "Example 1"

                if (this.$.form.checkValidity()) {
                    //me.message = "xx"
                }
            },
            rankedListClick: function (e) {
                this.$.rankedListFileName.click();
            },
            seedListClick: function (e) {
                this.$.seedListFileName.click();
            },
            rankedListFileNameChange: function (e) {
                this.rankedListFileName = this.$.rankedListFileName.files[0];
                //this.fileNameRanked = inputFile.name
            },
            seedListFileNameChange: function (e) {
                this.seedListFileName = this.$.seedListFileName.files[0];
                //this.fileNameRanked = inputFile.name
            }
        });
    </script>
</polymer-element>