<polymer-element name="jso-snow" attributes="userData selectedOption selectedStudy studies">
<template>
    <link rel="stylesheet" href="../jso-style.css">
    <style>
        :host {
            display: block;
            position: absolute;
            box-sizing: border-box;
            background-color: #FFFFFF;
            padding: 30px 100px;

            z-index: 50000;
            top: 90px;

            left: 0;
            right: 0;
            margin-left: auto;
            margin-right: auto;

            width: 40vw;
            border: 0px solid #c6d0da;
            border-width: 1px;
            /*border-top-width: 1px;*/
            transition: all 0.2s;
            box-shadow: 10px 10px 10px rgba(0, 0, 0, 0.2);
        }

        .title {
            text-align: center;
            font-size: 25px;
            color: #666;
        }

        .icon {
            color: #445D76;
            font-size: 50px;
        }

        label {
            display: inline-block;
            color: #666;
            margin-top: 3px;
            /*width: 150px;*/
        }

        label::after {
            content: ':'
        }

        .action {
            /*margin-top: 30px;*/
            background-color: #f5f5f5 !important;
            text-align: center;
        }

        .action:active {
            background-color: #445D76 !important;
            color: #fff !important;
        }

        .message {
            margin-top: 20px;
        }

        div.button {
            /*display: inline-block;*/
            width: 300px
        }

        .inputListTextArea {
            width: 300px;
            height: 50px;
        }

        jso-file-browser {
            /*width: 70%;*/
        }

        jso-project-browser {
            height: 400px;
            border: 1px solid #d3d3d3;
            border-top-width: 0px;
            margin-top: 10px;
        }

    </style>
    <div class="title">
        <div>
            Network enrichment analysis - Snow
        </div>
        <div class="icon">
            <!--<font-awesome icon="magic"></font-awesome>-->
        </div>
    </div>
    <form id="form">
        <h3>Examples</h3>

        <div class="button action" on-click="{{loadExample1}}">Load example 1</div>

        <h3>Output parameters</h3>
        <label>Or select output folder:</label>
        <jso-project-browser
                on-file-select="{{handleFolderSelect}}"
                studies="{{studies}}"
                selectedStudy="{{selectedStudy}}"
                >
        </jso-project-browser>

        <!--<jso-opencga-select-folder id="selectFolder" folderList="{{selectedStudy.files}}"></jso-opencga-select-folder>-->

        <h3>Input parameters</h3>
        <!--<label>Enter list</label> <textarea id="list1Area" class="inputListTextArea"-->
        <!--value="{{list1Area}}" required-->
        <!--pattern="[a-zA-Z0-9]+"></textarea>-->
        <label>Or, Select file</label>

        <!--<div class="button action" on-click="{{list1Click}}">{{list1UploadMsg}}</div>-->
        <!--<jso-file-browser hidden="true" id="list1Html" fileList="{{selectedStudy.files}}"-->
        <!--selectedFile="{{list1}}"></jso-file-browser>-->
        <jso-project-browser
                on-file-select="{{handleFileSelect}}"
                studies="{{studies}}"
                selectedStudy="{{selectedStudy}}"
                >
        </jso-project-browser>

        <label>List Nature</label>

        <div class="dropdown">
            <div tabindex="-1" class="button">
                {{typeText}}
            </div>
            <ul on-click="{{handleType}}">
                <li data-value="genes">Genes</li>
                <li data-value="proteins">Proteins</li>
            </ul>
        </div>

        <label>Species</label>

        <div class="dropdown">
            <div tabindex="-1" class="button">
                {{interactomeText}}
            </div>
            <ul on-click="{{handleInteractome}}">
                <li data-value="hsa">Homo sapiens</li>
            </ul>
        </div>

        <label>Select interactome confidence</label>

        <div class="dropdown">
            <div tabindex="-1" class="button">
                {{groupText}}
            </div>
            <ul on-click="{{handleGroup}}">
                <li data-value="all">Non curated</li>
                <li data-value="curated">Curated (detected by at least two methods)</li>
            </ul>
        </div>

        <label>Number of simulations</label>

        <div class="dropdown">
            <div tabindex="-1" class="button">
                {{randoms}}
            </div>
            <ul on-click="{{handleRandoms}}">
                <li data-value="500">500</li>
                <li data-value="1000">1000</li>
                <li data-value="2000">2000</li>
            </ul>
        </div>

        <label>Allow one external intermediate in the subnetwork</label>

        <div class="dropdown">
            <div tabindex="-1" class="button">
                {{intermediateText}}
            </div>
            <ul on-click="{{handleIntermediate}}">
                <li data-value=1>Yes</li>
                <li data-value=0>No</li>
            </ul>
        </div>


        <h3>Job information</h3>
        <label>Job name</label> <input type="text" id="jobName" value="{{jobName}}" required pattern="[a-zA-Z0-9]+">

        <div class="button action" on-click="{{handleForm}}">Run</div>
    </form>
    <div class="message">{{message}}</div>
</template>
<script>
    Polymer({
        created: function () {
            this.jobName = 'JobName';
            this.toolName = "snow";
            this.message = '';

            this.rankedList = "";
            this.seedList = "";

            this.example = false;

            this.type = "genes";
            this.typeText = "Genes";

            this.interactome = "hsa";
            this.interactomeText = "Homo sapiens";


            this.group = "all";
            this.groupText = "Non curated";

            this.order = "ascending";
            this.orderText = "Ascending";

            this.randoms = 500;

            this.intermediate = 1;
            this.intermediateText = "Yes";

            /** output widgets messages **/
            this.list1UploadMsg = "Choose file";

            /**Enabled forms **/
            this.list1ClickEnabled = false;

        },
        handleForm: function () {
            var me = this;
            this.message = '';
            me.launchJob();

        },
        launchJob: function () {
            var me = this;
            OpencgaManager.jobs.create({
                query: {
                    sid: Cookies("bioinfo_sid"),
                    studyId: this.selectedStudy.id,
                    toolId: this.toolName,
                    name: this.jobName,
                    description: "description",
                    list1: this.list1.id,
                    outdir: this.outdir.id,
                    interactome: this.interactome,
                    "o-name": "result",
                    intermediate: this.intermediate,
                    type: this.type,
                    group: this.group,
                    components: true,
                    randoms: this.randoms,
                    side: "greater",
                    images: "",
                    json: 1
                },
                request: {
                    //method: 'POST',
                    success: function (response) {
                        if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                            var userId = response.response[0].result[0].id;
                            me.message = userId + ' created';
                            me.selectedOption = "jobLaunched"
                        } else {
                            me.message = response.response[0].errorMsg;
                        }
                    },
                    error: function () {
                        me.message = 'Server error, try again later.';
                    }
                }
            })
        },
        loadExample1: function (e) {
            var me = this;
            this.message = '';
            this.newFolderName = "bipolar_gwas" + Math.floor((Math.random() * 100) + 1);

            this.rankedList = {id: "example_BD-GWASplink.txt", name: "BD-GWASplink.txt"};
            this.seedList = {id: "example_BD-associatedgenesUniprot.txt", name: "BD-associatedgenesUniprot.txt"};

            this.list = "gene";
            this.interactome = "hsa";
            this.group = "all";
            this.order = "ascending";
            this.intermediate = 1;
//            this.significant_value = 0.05
            this.jobName = "bipolar_gwas";
            this.example = true;
            if (this.$.form.checkValidity()) {
                //me.message = "xx"
            }
        },
        handleFileSelect: function (e) {
            this.list1 =  e.detail.file;
        },
        handleFolderSelect: function (e) {
            this.outdir =  e.detail.file;
        },
        handleType: function (e) {
            this.type = e.target.dataset.value;
            this.typeText = e.target.innerText;
        },
        handleInteractome: function (e) {
            this.interactome = e.target.dataset.value;
            this.interactomeText = e.target.innerText;
        },
        handleGroup: function (e) {
            this.group = e.target.dataset.value;
            this.groupText = e.target.innerText;
        },
        handleIntermediate: function (e) {
            this.intermediate = e.target.dataset.value;
            this.intermediateText = e.target.innerText;
        },
        handleRandoms: function (e) {
            this.randoms = e.target.dataset.value;
        }

    });
</script>
</polymer-element>
