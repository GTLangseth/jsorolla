<polymer-element name="jso-attribute-node-render" attributes="attributeManager defaults visualSets hideFlag">
    <template>
        <link rel="stylesheet" href="../../jso-style.css">
        <link rel="stylesheet" href="../../jso-panel.css">
        <style>
            :host {
                display: block;
                position: relative;
                box-sizing: border-box;
                background-color: #FFFFFF;
                width: 280px;
            }

            .container {
                box-sizing: border-box;
                padding: 2px 5px 5px 5px;
            }

            .container .text {
                width: 90px;
            }

            [vertical] > * {
                margin-top: 3px;
            }

            [horizontal] > * {
                margin-right: 3px;
            }

            [horizontal] > *:last-child {
                margin-right: 0px;
            }

            .showlabels:after {
                font-family: FontAwesome;
                content: '\f06e';
            }

            .remove:after {
                font-family: FontAwesome;
                content: '\f00d';
                color: #888888;
            }

            .remove[data-enabled=true]:after {
                color: #c70804;
            }

            .toggle:after {
                font-family: FontAwesome;
                content: '\f204';
                color: #333333;
            }

            .toggle[data-enabled=true]:after {
                font-family: FontAwesome;
                content: '\f205';
                color: #00AA33;
                /*color: #0081c2;*/
            }

            .configure:after {
                font-family: FontAwesome;
                /*content: '\f141';*/
                content: '\f0ad';
                color: #333333;
            }

            .configure[data-enabled=true]:after {
                color: #0081c2;
            }

        </style>
        <datalist id="colors">
            <option>#ad1e1e</option>
            <option>#ad5a1e</option>
            <option>#ad951e</option>
            <option>#89ad1e</option>
            <option>#4ead1e</option>
            <option>#1ead2a</option>
            <option>#1ead66</option>
            <option>#1eada1</option>
            <option>#1e7dad</option>
            <option>#1e42ad</option>
            <option>#361ead</option>
            <option>#711ead</option>
            <option>#da1f1f</option>
            <option>#da6d1f</option>
            <option>#dabb1f</option>
            <option>#abda1f</option>
            <option>#5dda1f</option>
            <option>#1fda2e</option>
            <option>#1fda7c</option>
            <option>#1fdacb</option>
            <option>#1f9cda</option>
            <option>#1f4eda</option>
            <option>#3e1fda</option>
            <option>#8c1fda</option>
            <option>#ea4242</option>
            <option>#ea8842</option>
            <option>#eace42</option>
            <option>#c0ea42</option>
            <option>#7aea42</option>
            <option>#42ea50</option>
            <option>#42ea96</option>
            <option>#42eadc</option>
            <option>#42b2ea</option>
            <option>#426cea</option>
            <option>#5e42ea</option>
            <option>#a442ea</option>
            <option>#f36c6c</option>
            <option>#f3a46c</option>
            <option>#f3dc6c</option>
            <option>#d1f36c</option>
            <option>#99f36c</option>
            <option>#6cf377</option>
            <option>#6cf3af</option>
            <option>#6cf3e7</option>
            <option>#6cc6f3</option>
            <option>#6c8ef3</option>
            <option>#836cf3</option>
            <option>#bb6cf3</option>
            <option>#f99494</option>
            <option>#f9be94</option>
            <option>#f9e894</option>
            <option>#e0f994</option>
            <option>#b6f994</option>
            <option>#94f99c</option>
            <option>#94f9c6</option>
            <option>#94f9f0</option>
            <option>#94d7f9</option>
            <option>#94adf9</option>
            <option>#a594f9</option>
            <option>#cf94f9</option>
            <option>#fdc3c3</option>
            <option>#fddbc3</option>
            <option>#fdf3c3</option>
            <option>#eefdc3</option>
            <option>#d6fdc3</option>
            <option>#c3fdc8</option>
            <option>#c3fde0</option>
            <option>#c3fdf8</option>
            <option>#c3eafd</option>
            <option>#c3d1fd</option>
            <option>#cdc3fd</option>
            <option>#e5c3fd</option>
            <option>#ffffff</option>
            <option>#eaeaea</option>
            <option>#d5d5d5</option>
            <option>#c0c0c0</option>
            <option>#aaaaaa</option>
            <option>#959595</option>
            <option>#808080</option>
            <option>#6b6b6b</option>
            <option>#555555</option>
            <option>#404040</option>
            <option>#2b2b2b</option>
            <option>#161616</option>
        </datalist>
        <div class="panel panel-shadow">
            <div class="header" horizontal layout
                 on-mousedown="{{handleHeaderMouseDown}}"
                 on-mouseup="{{handleHeaderMouseUp}}">
                <div class="text">Simple node attribute rendering</div>
                <div class="headeractions" horizontal end-justified layout flex>
                    <div class="text headerclose" on-click="{{handleClose}}"></div>
                </div>
            </div>
            <div class="container" vertical layout>
                <div horizontal layout>
                    <div class="dropdown" flex>
                        <div tabindex="-1" class="button">
                            {{labelColumnSelected.title || defaults.labelAttribute}} &nbsp;
                        </div>
                        <ul>
                            <template repeat="{{column in attributeManager.columns}}">
                                <li on-mousedown="{{handleLabelSelect}}" data-name="{{column.name}}">
                                    {{column.title}}
                                </li>
                            </template>
                        </ul>
                    </div>
                    <div class="button action showlabels" data-checked="{{showLabels}}"
                         on-click="{{handleShowLabels}}"></div>
                </div>

                <div horizontal layout>
                    <input type="number" value={{defaults.labelPositionX}} placeholder="x label">
                    <input type="number" value={{defaults.labelPositionY}} placeholder="y label">
                </div>

                <div horizontal layout>
                    <div class="text">Label size:</div>
                    <input flex type="number" min="0" max="16" value={{defaults.labelSize}}>

                    <div class="button action configure" data-enabled="{{visualSets.labelSize != null}}"
                         on-click="{{handleSettingsClick}}" data-prop="labelSize"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.labelSize.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="labelSize"></div>
                    <div class="button action remove" data-enabled="{{visualSets.labelSize != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="labelSize"></div>
                </div>
                <div horizontal layout>
                    <div class="text">Opacity:</div>
                    <input flex type="number" min="0" max="1" step="0.1" value={{defaults.opacity}}>

                    <div class="button action configure" data-enabled="{{visualSets.opacity != null}}"
                         on-click="{{handleSettingsClick}}" data-prop="opacity"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.opacity.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="opacity"></div>
                    <div class="button action remove" data-enabled="{{visualSets.opacity != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="opacity"></div>
                </div>
                <div horizontal layout>
                    <div class="text">Shape:</div>
                    <div class="dropdown" flex>
                        <div tabindex="-1" class="button">
                            {{defaults.shape}} &nbsp;
                        </div>
                        <ul>
                            <li on-mousedown="{{handleShapeSelect}}">circle</li>
                            <li on-mousedown="{{handleShapeSelect}}">ellipse</li>
                            <li on-mousedown="{{handleShapeSelect}}">square</li>
                            <li on-mousedown="{{handleShapeSelect}}">rectangle</li>
                        </ul>
                    </div>

                    <div class="button action configure" data-enabled="{{visualSets.shape != null}}"
                         on-click="{{handleSettingsClick}}" data-prop="shape"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.shape.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="shape"></div>
                    <div class="button action remove" data-enabled="{{visualSets.shape != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="shape"></div>
                </div>
                <div horizontal layout>
                    <div class="text">Color:</div>

                    <input flex type="color" value="{{defaults.color}}" list="colors">

                    <div class="button action configure" data-enabled="{{visualSets.color != null}}"
                         on-click="{{handleSettingsClick}}" data-prop="color"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.color.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="color"></div>
                    <div class="button action remove" data-enabled="{{visualSets.color != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="color"></div>
                </div>
                <div horizontal layout>
                    <div class="text">Stroke color:</div>
                    <input flex type="color" value="{{defaults.strokeColor}}">

                    <div class="button action configure" data-enabled="{{visualSets.strokeColor != null}}"
                         on-click="{{handleSettingsClick}}"
                         data-prop="strokeColor"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.strokeColor.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="strokeColor"></div>
                    <div class="button action remove" data-enabled="{{visualSets.strokeColor != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="strokeColor"></div>
                </div>
                <div horizontal layout>
                    <div class="text">Size:</div>
                    <input flex type="number" min="1" max="200" value={{defaults.size}}>

                    <div class="button action configure" data-enabled="{{visualSets.size != null}}"
                         on-click="{{handleSettingsClick}}" data-prop="size"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.size.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="size"></div>
                    <div class="button action remove" data-enabled="{{visualSets.size != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="size"></div>
                </div>
                <div horizontal layout>
                    <div class="text">Stroke size:</div>
                    <input flex type="number" min="1" max="20" value={{defaults.strokeSize}}>

                    <div class="button action configure" data-enabled="{{visualSets.strokeSize != null}}"
                         on-click="{{handleSettingsClick}}"
                         data-prop="strokeSize"></div>
                    <div class="button action toggle" data-enabled="{{visualSets.strokeSize.enabled}}"
                         on-click="{{handleToggleSet}}" data-prop="strokeSize"></div>
                    <div class="button action remove" data-enabled="{{visualSets.strokeSize != null}}"
                         on-click="{{handleRemoveSet}}" data-prop="strokeSize"></div>
                </div>
                <div horizontal layout>
                    <div class="text">X:</div>
                    <div class="dropdown" flex>
                        <div tabindex="-1" class="button">
                            {{defaults.xAttribute}}
                        </div>
                        <ul>
                            <template repeat="{{column in attributeManager.columns}}">
                                <li on-mousedown="{{handleXAttributeSelect}}" data-name="{{column.name}}">
                                    {{column.title}}
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>
                <div horizontal layout>
                    <div class="text">Y:</div>
                    <div class="dropdown" flex>
                        <div tabindex="-1" class="button">
                            {{defaults.yAttribute}}
                        </div>
                        <ul>
                            <template repeat="{{column in attributeManager.columns}}">
                                <li on-mousedown="{{handleYAttributeSelect}}" data-name="{{column.name}}">
                                    {{column.title}}
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>

            </div>
        </div>

        <template if="{{displayProperty == 'labelSize'}}">
            <jso-attribute-render-number-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.labelSize}}"
                    visualSet="{{visualSets.labelSize}}"
                    >
            </jso-attribute-render-number-table>
        </template>
        <template if="{{displayProperty == 'opacity'}}">
            <jso-attribute-render-number-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.opacity}}"
                    visualSet="{{visualSets.opacity}}"
                    >
            </jso-attribute-render-number-table>
        </template>
        <template if="{{displayProperty == 'shape'}}">
            <jso-attribute-render-select-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.shape}}"
                    visualSet="{{visualSets.shape}}"
                    options="circle,ellipse,square,rectangle"
                    >
            </jso-attribute-render-select-table>
        </template>
        <template if="{{displayProperty == 'color'}}">
            <jso-attribute-render-color-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.color}}"
                    visualSet="{{visualSets.color}}"
                    >
            </jso-attribute-render-color-table>
        </template>
        <template if="{{displayProperty == 'strokeColor'}}">
            <jso-attribute-render-color-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.strokeColor}}"
                    visualSet="{{visualSets.strokeColor}}"
                    >
            </jso-attribute-render-color-table>
        </template>
        <template if="{{displayProperty == 'size'}}">
            <jso-attribute-render-number-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.size}}"
                    visualSet="{{visualSets.size}}"
                    >
            </jso-attribute-render-number-table>
        </template>
        <template if="{{displayProperty == 'strokeSize'}}">
            <jso-attribute-render-number-table
                    renderProperty="{{displayProperty}}"
                    attributeManager="{{attributeManager}}"
                    defaultValue="{{defaults.strokeSize}}"
                    visualSet="{{visualSets.strokeSize}}"
                    >
            </jso-attribute-render-number-table>
        </template>
    </template>
    <script>
        Polymer({
            created: function () {
                this.displayProperty = '';
                this.downX;
                this.downY;
            },
            ready: function () {
            },
//            handleHeaderMouseDown: function (e) {
//                var me = this;
//                window.removeEventListener('mousemove', this.mouseMoveHandler, true);
////                this.style.position = 'fixed';
////                this.downX = this.offsetLeft + e.layerX;
////                this.downY = this.offsetTop + e.layerY;
//                this.mouseMoveHandler = function (moveEvent) {
//                    me.handleMouseMove(moveEvent);
//                };
//                window.addEventListener('mousemove', this.mouseMoveHandler, true);
//            },
//            handleHeaderMouseUp: function () {
//                window.removeEventListener('mousemove', this.mouseMoveHandler, true);
//            },
//            handleMouseMove: function (e) {
//                this.style.left = (e.x - this.downX) + "px";
//                this.style.top = (e.y - this.downY) + "px";
//            },
            handleClose: function () {
                this.hideFlag = true;
            },

            handleLabelSelect: function (e) {
                this.labelColumnSelected = e.target.templateInstance.model.column;
                this.defaults.labelAttribute = e.currentTarget.dataset.name;
            },
            handleXAttributeSelect: function (e) {
                this.defaults.xAttribute = e.currentTarget.dataset.name;
            },
            handleYAttributeSelect: function (e) {
                this.defaults.yAttribute = e.currentTarget.dataset.name;
            },
            handleShapeSelect: function (e) {
                this.defaults.shape = e.currentTarget.innerHTML;
            },
            handleSettingsClick: function (e) {
                this.displayProperty = e.currentTarget.dataset.prop;
            },
            /*Visual sets*/
            handleToggleSet: function (e) {
                var renderProperty = e.currentTarget.dataset.prop;
                if (this.visualSets[renderProperty]) {
                    this.visualSets[renderProperty].enabled = !this.visualSets[renderProperty].enabled;
                }
            },
            handleRemoveSet: function (e) {
                var renderProperty = e.currentTarget.dataset.prop;
                delete this.visualSets[renderProperty];
            }
        });
    </script>
</polymer-element>

