<link rel="import" href="jso-job.html">
<polymer-element name="jso-job-list" attributes="showJobs selectedOption jobItem selectedStudy">
    <template>
        <link rel="stylesheet" href="../jso-panel.css">
        <link rel="stylesheet" href="../jso-style.css">
        <style>
            :host {
                display: block;
                position: absolute;
                /*margin-left: 10px;*/
            }

            .panel {
                height: 500px;
                overflow: auto;
            }
        </style>
        <div class="panel">
            <div class="header"
                 on-click="{{titleClick}}"
                 data-collapsible="{{collapsible}}"
                 data-collapsed="{{collapsed}}">
                Analysis panel
            </div>
            <div class="container">
                <template repeat="{{jobItemList in jobList}}">
                    <jso-job jobItem="{{jobItemList}}" on-click="{{handleJobViewClick}}"></jso-job>
                </template>
            </div>
        </div>


        </div>
    </template>
    <script>
        Polymer({
            created: function () {
                this.jobList = ""
                this.selected = false

            },
            showJobsChanged: function (oldV, newV) {
                var me = this;
                if (this.showJobs) {
                    checkTimeInterval = 5000;
                    this.getJobs();//first call
                    setInterval(function () {
                        me.getJobs();
                    }, checkTimeInterval);
                }

            },
            getJobs: function () {
                var me = this;
                OpencgaManager.analysis.jobs({
                    id: this.selectedStudy.analysis.id,
                    query: {
                        sid: Cookies("bioinfo_sid")
                    },
                    request: {
                        //method: 'POST',
                        success: function (response) {
                            if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                                me.jobList = response.response[0].result
                                me.jobList = me.jobList.reverse()
                            } else {
                                me.message = response.response[0].errorMsg;
                            }
                        },
                        error: function () {
                            me.message = 'Server error, try again later.';
                        }
                    }
                })
            },
            handleJobViewClick: function (e) {
                this.jobItem = e.target.jobItem;
                if(this.jobItem.status == "ready")
                    this.selectedOption = "jobReady";
                else
                    this.selectedOption = "jobNoReady";
                console.log(this.jobItem)
            }

        });
    </script>
</polymer-element>