<dom-module id="jso-association-result" attributes="files">
    <template>
        <link rel="stylesheet" href="../sortable-table.css">
        <style>
            :host {
                display: block;
                /*position: relative;*/
                background-color: white;
            }

            .message > label {
                margin-right: 10px;
            }

            .message > label:after {
                content: ':';
            }

            .message > .messageValue {
                font-size: 9pt;
                font-weight: bold;
                font-style: italic;
                color: #55f;
            }

            .file > label {
                margin-right: 10px;
            }

            .file > a {
                font-size: 9pt;
                font-weight: bold;
                font-style: italic;
                color: #55f;
            }

            sortable-table::shadow thead tr th {
                /*width: 1000px;*/
                white-space: inherit;
                overflow: auto;
                text-overflow: inherit;

            }

            .output {
                margin: 10px;
                /*width: 1000px;*/
                background-color: white;
                border-radius: 5px;
                padding: 20px;
            }

            #genomeViewer {
                margin: 20px 0;
            }
        </style>


        <div>

            <h3>Manhattan plot</h3>

            <div class="file"><label class="jso">File</label>
                <a href="{{manhattanPlot}}" download="manhattan_plot.png">manhattan_plot.png</a>
            </div>
            <img src="{{manhattanPlot}}">

            <div id="topHitsDiv" hidden?="{{!topHitsResult}}">
                <h3>Top Hits</h3>

                <div class="file"><label class="jso">File</label>
                    <a href="{{topHitsUrl}}" target="_blank">top_hits.txt</a>
                </div>
                <jso-generic-table selected="{{selected}}" id="topHitsTable"></jso-generic-table>
            </div>
            <h3 hidden?="{{topHitsResult}}">Top Hits</h3>

            <div hidden?="{{topHitsResult}}">
                <label class="jso">There is no <strong>top hit</strong> results.</label>
            </div>
            <jso-genome-viewer-element id="genomeViewer"></jso-genome-viewer-element>
            <h3>Files</h3>

        </div>
    </template>
    <script>
        Polymer({
//            selected: null,
            created: function () {

                this.dataFile = "none";
                this.glFile = "none";
                this.topHitsResult = false;

            },
            ready: function () {

            },
            domReady: function () {

            },
            selectedChanged: function (oldValue, newValue) {
//                console.log(newValue);
                var reg = newValue["CHR"] + ":" + parseInt(newValue["BP"]) + "-" + (parseInt(newValue["BP"]) + 1);
                var region = new Region(reg);
                this.$.genomeViewer.genomeViewer.setRegion(region);
            },
            handleTableClick: function (oldValue, newValue) {
                console.log(newValue);

            },
            parseCommandLine: function () {
                this.clearFields();
            },
            clearFields: function () {
                this.manhattanPlot = "";
                this.method = "";
                this.glFile = "";
            },

            filesChanged: function (oldV, newV) {
                this.parseCommandLine();
                /** get url **/
                var me = this;
                for (var i = 0; i < this.files.length; i++) {

                    var file = this.files[i];
                    console.log(file.name)
                    if (file.name.indexOf("manhattan_plot-") >= 0) {

                        me.manhattanPlot = Utils.getUrl(file.id);
                    }
                    if (file.name == "top_hits.df") {
                        me.topHitsUrl = Utils.getUrl(file.id);
                        Utils.getFileContent(function (content) {
                            me.topHitsTableContent = content;
                            me.topHitsResult = true;
                            var topHitsTable = me.$.topHitsTable;
                            topHitsTable.content = content;
                            topHitsTable.multiSelect = false;

                        }, file.id);
                    }
                }
            }
        })
    </script>
</polymer-element>


