<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<!--<link rel="import" href="../../../../../../bower_components/paper-slider/paper-slider.html">-->
<link rel="import" href="opencga-sample-browser.html">

<dom-module id="variant-browser-filter">
    <template>
        <style is="custom-style" include="jso-styles iron-flex iron-flex-reverse iron-flex-alignment iron-flex-factors iron-positioning">
            /*paper-slider::shadow #input {*/
            /*width: calc(20vh - 40px);*/
            /*font-size: 13px;*/
            /*}*/

            select {
                height: 20px;
                width: 45px;
                align-self: center;
            }

            .name {
                font-size: 12px;
                color: #797979;
            }

            .popus {
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
            }

            .sample-scroll {
                max-height: 150px;
                overflow-y: scroll;
            }
        </style>

        <div>
            <br>
            <div>
                <button type="button" class="btn btn-default" on-click="fireFilter">
                    <i class="fa fa-filter" aria-hidden="true"></i>
                </button>
                <button type="button" class="btn btn-default" on-click="fireClear">Clear</button>
                <button type="button" class="btn btn-default" on-click="fireSearch">Search</button>
            </div>
            <br>

            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <!--Study filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="studyFilterHeading">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#studyFilter" aria-expanded="false" aria-controls="studyFilter">
                                Study Filter
                            </a>
                        </h4>
                    </div>
                    <div id="studyFilter" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="studyFilterHeading">
                        <div class="panel-body">
                            <!--<input type="radio" name="study" value="{{item.name}}" on-click="studySelected" data-id="{{item.id}}"> {{item.name}}-->
                            <div class="dropdown">
                                Select one study:<span style="padding-left:20px;"></span>
                                <button class="btn btn-default dropdown-toggle" type="button" id="studiesDropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    Studies
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="studiesDropdownMenu">
                                    <template is="dom-repeat" items="{{studies}}">
                                        <li><a href="#" on-click="studySelected" data-id="{{item.id}}">{{item.name}}</a></li>
                                    </template>
                                </ul>
                            </div>
                            <br>
                            <!--<div id="somaticFilter" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">-->
                                <div>
                                    <!--<template is="dom-repeat" items="{{somaticValues}}">-->
                                        <!--<input type="radio" name="study" value="{{item}}"> {{item}}-->
                                    <!--</template>-->
                                    <h4>Select type of analysis</h4>
                                    <input type="radio" name="type" value="none" on-click="typeSelected" data-id="none" checked="true"> none<br>
                                    <input type="radio" name="type" value="family" on-click="typeSelected" data-id="family"> family<br>
                                    <input type="radio" name="type" value="somatic" on-click="typeSelected" data-id="somatic"> somatic<br>
                                    <input type="radio" name="type" value="case-control" on-click="typeSelected" data-id="case-control"> case-control
                                </div>
                            <!--</div>-->
                            <br>
                            <button data-toggle="modal" role="button" data-placement="bottom" data-target="#sampleBrowser" title="Sample Browser..." >Sample Browser...</button>
                            <br>

                            <!--Select samples: <br>-->
                            <!--<div class="sample-scroll">-->
                                <!--<template is="dom-repeat" items="{{studySamples}}">-->
                                    <!--<input type="checkbox" name="samples" value="{{item.name}}" on-change="addSelectedSamples">-->
                                    <!--{{item.name}}<br>-->
                                <!--</template>-->
                            <!--</div>-->

                            <!--<div class="dropdown">-->
                                <!--Select a file:<span style="padding-left:63px;"></span>-->
                                <!--<button class="btn btn-default dropdown-toggle" type="button" id="filesDropdownMenu"-->
                                        <!--data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">-->
                                    <!--Files-->
                                    <!--<span class="caret"></span>-->
                                <!--</button>-->
                                <!--<ul class="dropdown-menu" aria-labelledby="filesDropdownMenu">-->
                                    <!--<template is="dom-repeat" items="{{studyFiles}}">-->
                                        <!--<li><a href="#" data-id="{{item.id}}">{{item.name}}</a></li>-->
                                    <!--</template>-->
                                <!--</ul>-->
                            <!--</div>-->
                        </div>
                    </div>

                </div>

                <!--Segregation filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#segregation"
                               aria-expanded="true" aria-controls="segregation">
                                Segregation
                            </a>
                        </h4>
                    </div>
                    <div id="segregation" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body">
                            <form class="form-inline" role="form">
                                <label>Sample:</label>
                                <template is="dom-repeat" items="{{segregation}}">
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox"> {{item}}
                                        </label>
                                    </div>
                                </template>
                            </form>
                        </div>
                    </div>
                </div>

                <!--Somatic filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingTwo">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#somaticFilter" aria-expanded="false" aria-controls="somaticFilter">
                                Somatic Filter
                            </a>
                        </h4>
                    </div>
                    <!--<div id="somaticFilter" class="panel-collapse collapse" role="tabpanel"-->
                         <!--aria-labelledby="headingTwo">-->
                        <!--<div class="panel-body">-->
                            <!--<template is="dom-repeat" items="{{somaticValues}}">-->
                            <!--<input type="radio" name="study" value="{{item}}"> {{item}}-->
                            <!--</template>-->
                            <!--<input type="radio" name="type" value="family" on-click="typeSelected" data-id="family">-->
                            <!--family-->
                            <!--<br>-->
                            <!--<input type="radio" name="type" value="somatic" on-click="typeSelected" data-id="somatic">-->
                            <!--somatic-->
                            <!--<br>-->
                            <!--<input type="radio" name="type" value="cc" on-click="typeSelected" data-id="cc"> cc-->
                        <!--</div>-->
                    <!--</div>-->
                </div>

                <!--Position filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingThree">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#position" aria-expanded="false" aria-controls="position">
                                Position
                            </a>
                        </h4>
                    </div>
                    <div id="position" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                        <div class="panel-body">
                            Chromosomal Location:
                            <textarea id="locationTextarea" class="form-control clearable" rows="3"
                                      placeholder="3:444-55555, 1:1-1000000"></textarea>
                            Import from BED:
                            <button type="button" class="btn btn-xs" on-click="">Import</button>
                            <br>
                            <br> Gene or SNPId:
                            <textarea id="geneSnpTextarea" class="form-control clearable" rows="3"
                                      placeholder="BRCA2, PPL or rs666, rs9988179"></textarea>
                        </div>
                    </div>
                </div>

                <!--Type filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingFour">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#type" aria-expanded="false" aria-controls="type">
                                Type
                            </a>
                        </h4>
                    </div>
                    <div id="type" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                        <div class="panel-body">
                            <div>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="SNV,SNP"> SNV
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="MNV"> MNV
                                </label>
                            </div>
                            <div>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="CNV"> CNV
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="SV"> SV
                                </label>
                            </div>
                            <div>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="INDEL"> INDEL
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!--Population Frequency filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingFive">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#populationFrequency" aria-expanded="false" aria-controls="populationFrequency">
                                Population Frequency
                            </a>
                        </h4>
                    </div>
                    <div id="populationFrequency" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingFive">
                        <div class="panel-body">
                            <i class$="{{phase_1}}" on-click="handleCollapseAction" data-type="phase_1"></i>
                            <label class="popus" on-click="handleCollapseAction" data-type="phase_1"> 1000 Genomes
                                population phase 1</label>
                            <div id="phase_1" hidden>
                                <label class="name">All populations MAF [ALL]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_1_ALL_op" id="1000GENOMES_phase_1_ALL_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_1_ALL" editable></paper-slider>
                                </div>
                                <label class="name">American MAF [AMR]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_1_AMR_op" id="1000GENOMES_phase_1_AMR_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_1_AMR" editable></paper-slider>
                                </div>
                                <label class="name">Asian MAF [ASN]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_1_ASN_op" id="1000GENOMES_phase_1_ASN_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_1_ASN" editable></paper-slider>
                                </div>
                                <label class="name">African MAF [AFR]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_1_AFR_op" id="1000GENOMES_phase_1_AFR_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_1_AFR" editable></paper-slider>
                                </div>
                                <label class="name">European MAF [EUR]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_1_EUR_op" id="1000GENOMES_phase_1_EUR_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_1_EUR" editable></paper-slider>
                                </div>
                            </div>
                            <br>
                            <i class$="{{phase_3}}" on-click="handleCollapseAction" data-type="phase_3"></i>
                            <label class="popus" on-click="handleCollapseAction" data-type="phase_3">1000 Genomes
                                population phase 3</label>
                            <div id="phase_3" hidden>
                                <label class="name">All populations MAF [ALL]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_3_ALL_op" id="1000GENOMES_phase_3_ALL_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_3_ALL" editable></paper-slider>
                                </div>
                                <label class="name">American MAF [AMR]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_3_AMR_op" id="1000GENOMES_phase_3_AMR_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_3_AMR" editable></paper-slider>
                                </div>
                                <label class="name">South Asian MAF [SAS]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_3_SAS_op" id="1000GENOMES_phase_3_SAS_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_3_SAS" editable></paper-slider>
                                </div>
                                <label class="name">East Asian MAF [EAS]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_3_EAS_op" id="1000GENOMES_phase_3_EAS_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_3_EAS" editable></paper-slider>
                                </div>
                                <label class="name">African MAF [AFR]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_3_AFR_op" id="1000GENOMES_phase_3_AFR_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_3_AFR" editable></paper-slider>
                                </div>
                                <label class="name">European MAF [EUR]</label>
                                <div class="horizontal layout">
                                    <select name="1000GENOMES_phase_3_EUR_op" id="1000GENOMES_phase_3_EUR_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="1000GENOMES_phase_3_EUR" editable></paper-slider>
                                </div>
                            </div>
                            <br>
                            <i class$="{{esp_6500}}" on-click="handleCollapseAction" data-type="esp_6500"></i>
                            <label class="popus" on-click="handleCollapseAction" data-type="esp_6500">ESP 6500</label>
                            <div id="esp_6500" hidden>
                                <label class="name">European american MAF</label>
                                <div class="horizontal layout">
                                    <select name="ESP_6500_EA_op" id="ESP_6500_EA_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="ESP_6500_EA" editable></paper-slider>
                                </div>
                                <label class="name">African american MAF</label>
                                <div class="horizontal layout">
                                    <select name="ESP_6500_AA_op" id="ESP_6500_AA_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="ESP_6500_AA" editable></paper-slider>
                                </div>
                            </div>
                            <br>
                            <i class$="{{exac}}" on-click="handleCollapseAction" data-type="exac"></i>
                            <label class="popus" on-click="handleCollapseAction" data-type="exac">EXAC</label>
                            <div id="exac" hidden>
                                <label class="name">EXAC MAF</label>
                                <div class="horizontal layout">
                                    <select name="EXAC_ALL_op" id="EXAC_ALL_op">
                                        <option value="<" selected>
                                            <
                                        </option>
                                        <option value="<=">
                                            <=
                                        </option>
                                        <option value=">">></option>
                                        <option value=">=">>=</option>
                                    </select>
                                    <paper-slider pin min="0" max="1" step="0.0000001" on-value-change="sliderChange"
                                                  value="0" id="EXAC_ALL" editable></paper-slider>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--Protein Substitution Scores filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingSix">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#proteinSubstitutionScore" aria-expanded="false"
                               aria-controls="proteinSubstitutionScore">
                                Protein Substitution Score
                            </a>
                        </h4>
                    </div>
                    <div id="proteinSubstitutionScore" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingSix">
                        <div class="panel-body">
                            <textarea id="bierAppProteinSubstitutionScoreTextarea" class="form-control clearable"
                                      rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <!--Conservation Scores filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingSeven">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#conservation" aria-expanded="false" aria-controls="conservation">
                                Conservation
                            </a>
                        </h4>
                    </div>
                    <div id="conservation" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingSeven">
                        <div class="panel-body">
                            <textarea id="bierAppConservationTextarea" class="form-control clearable"
                                      rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <!--Consequence Type filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingEight">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#consequenceType" aria-expanded="false" aria-controls="consequenceType">
                                Consequence Type
                            </a>
                        </h4>
                    </div>
                    <div id="consequenceType" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingEight">
                        <div class="panel-body">
                            Consequence Type
                        </div>
                    </div>
                </div>

                <!-- Gene Ontology filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingNine">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#geneOntology" aria-expanded="false" aria-controls="geneOntology">
                                Gene Ontology
                            </a>
                        </h4>
                    </div>
                    <div id="geneOntology" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingNine">
                        <div class="panel-body">
                            <textarea id="bierAppGeneOntologyTextarea" class="form-control clearable" rows="3"
                                      placeholder="GO:0000001, GO:0001177"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Human Phenotype Ontology filter-->
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingTen">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#humanPhenotypeOntology" aria-expanded="false"
                               aria-controls="humanPhenotypeOntology">
                                Human Phenotype Ontology
                            </a>
                        </h4>
                    </div>
                    <div id="humanPhenotypeOntology" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingTen">
                        <div class="panel-body">
                            <textarea id="bierAppHumanPhenotypeOntologyTextarea" class="form-control clearable" rows="3"
                                      placeholder="HP:0000001, HP:3000079"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal dialog for Sample Browser -->
        <div class="modal fade" id="sampleBrowser" tabindex="-1" role="dialog" aria-labelledby="sampleBrowserLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Sample Browser</h4>
                    </div>
                    <div class="modal-body">
                        <opencga-sample-browser opencga-client="{{opencgaClient}}" study="{{study.id}}" samples="{{samples}}"></opencga-sample-browser>
                        </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'variant-browser-filter',
            properties: {
                studies: {
                    type: Array,
                    value: []
                },
                study: {
                    type: Object,
                    notify: true
                },
                opencgaClient: {
                    type: Object
                },
                segregation: {
                    type: Array,
                    value: ["0/0", "0/1", "1/1", "./."]
                },
                phase_1: {
                    type: String,
                    value: "fa fa-angle-double-right minus"
                },
                phase_3: {
                    type: String,
                    value: "fa fa-angle-double-right minus"
                },
                esp_6500: {
                    type: String,
                    value: "fa fa-angle-double-right minus"
                },
                exac: {
                    type: String,
                    value: "fa fa-angle-double-right minus"
                },
                query: {
                    type: Object,
                    notify: true,
                    value: function () {
                        return {};
                    }
                },
                type: {
                    type: String,
                    value: "",
                    notify: true
                },
                samples: {
                    type: String,
                    value: [],
                    notify: true
                },
                cellbaseClient: {
                    type: Object
                }
            },
            studySelected: function (e) {
                if (typeof e.target === "undefined") {
                    this.study = {name: e};
                } else {
//                    console.log("Study Event:")
//                    console.log(e)
                    this.study = {id: e.target.dataId, name: e.target.innerText};
                }
                // samples from the selected study
                var _this = this;
                this.samples = []; // empty the selected samples whenever a new study is selected
//                this.samples = ["NA00001", "NA00002", "NA00003"];
                this.opencgaClient.studies().samples(this.study.id).then(function (response) {
                    _this.studySamples = response.response[0].result;
                });
                // files from the selected study
                this.opencgaClient.studies().files(this.study.id).then(function (response) {
                    _this.studyFiles = response.response[0].result;
                })
            },
            typeSelected: function (e) {
                if (typeof e.target === "undefined") {
                    this.type = e;
                } else {
                    this.type = e.target.defaultValue;
                }
                console.log("type:", this.type);
            },
            addSelectedSamples: function(e) {
                if (e.target.checked) {
                    this.push('samples', e.target.value);
                } else {
                    var index = this.samples.indexOf(e.target.value);
                    this.splice('samples', index, 1);
                }
                console.log(this.samples)
            },
            sliderChange: function (e) {
                var id = e.currentTarget.id + "Value";
                this.set(id, e.currentTarget.value);
            },
            handleCollapseAction: function (e) {
                var id = e.currentTarget.dataset.type;
                this.$[id].hidden = !this.$[id].hidden;
                if (this.$[id].hidden) {
                    this[id] = "fa fa-angle-double-right minus";
                } else {
                    this[id] = "fa fa-angle-double-down minus";
                }
            },
            fireClear: function () {
                // Type
                var types = this.$.type.querySelectorAll("input:checked");
                for (var i = 0; i < types.length; i++) {
                    var type = types[i];
                    type.checked = false;
                }
                // Freqs
                this.$["1000GENOMES_phase_1_ALL"].value = 0;
                this["1000GENOMES_phase_1_ALL"] = "";
                this.$["1000GENOMES_phase_1_ALL_op"].value = "<";
                this.$["1000GENOMES_phase_1_AMR"].value = 0;
                this["1000GENOMES_phase_1_AMR"] = "";
                this.$["1000GENOMES_phase_1_AMR_op"].value = "<";
                this.$["1000GENOMES_phase_1_ASN"].value = 0;
                this["1000GENOMES_phase_1_ASN"] = "";
                this.$["1000GENOMES_phase_1_ASN_op"].value = "<";
                this.$["1000GENOMES_phase_1_AFR"].value = 0;
                this["1000GENOMES_phase_1_AFR"] = "";
                this.$["1000GENOMES_phase_1_AFR_op"].value = "<";
                this.$["1000GENOMES_phase_1_EUR"].value = 0;
                this["1000GENOMES_phase_1_EUR"] = "";
                this.$["1000GENOMES_phase_1_EUR_op"].value = "<";

                this.$["1000GENOMES_phase_3_ALL"].value = 0;
                this["1000GENOMES_phase_1_ALL"] = "";
                this.$["1000GENOMES_phase_3_ALL_op"].value = "<";
                this.$["1000GENOMES_phase_3_AMR"].value = 0;
                this["1000GENOMES_phase_3_AMR"] = "";
                this.$["1000GENOMES_phase_3_AMR_op"].value = "<";
                this.$["1000GENOMES_phase_3_SAS"].value = 0;
                this["1000GENOMES_phase_3_SAS"] = "";
                this.$["1000GENOMES_phase_3_SAS_op"].value = "<";
                this.$["1000GENOMES_phase_3_EAS"].value = 0;
                this["1000GENOMES_phase_3_EAS"] = "";
                this.$["1000GENOMES_phase_3_EAS_op"].value = "<";
                this.$["1000GENOMES_phase_3_AFR"].value = 0;
                this["1000GENOMES_phase_3_AFR"] = "";
                this.$["1000GENOMES_phase_3_AFR_op"].value = "<";
                this.$["1000GENOMES_phase_3_EUR"].value = 0;
                this["1000GENOMES_phase_3_EUR"] = "";
                this.$["1000GENOMES_phase_3_EUR_op"].value = "<";

                this.$["ESP_6500_EA"].value = 0;
                this["ESP_6500_EA"] = "";
                this.$["ESP_6500_EA_op"].value = "<";
                this.$["ESP_6500_AA"].value = 0;
                this["ESP_6500_AA"] = "";
                this.$["ESP_6500_AA_op"].value = "<";
                this.$["EXAC_ALL"].value = 0;
                this["EXAC_ALL"] = "";
                this.$["EXAC_ALL_op"].value = "<";

            },
            fireFilter: function () {

            },
            fireSearch: function () {
                var query = {};

                // Type
                var types = this.$.type.querySelectorAll("input:checked");
                var typesAux = [];
                if (types != "") {
                    for (var i = 0; i < types.length; i++) {
                        typesAux.push(types[i].value);
                    }
                    query["type"] = typesAux;
                }

                // Population Frequencies
                // Population minor allele frequency: {study}:{population}[<|>|<=|>=]{number}
                var popFreq = [];

                // 1000GENOMES_phase_1
                if (this.$["1000GENOMES_phase_1_ALL"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_1", "ALL", "phase1"));
                }
                if (this.$["1000GENOMES_phase_1_AMR"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_1", "AMR", "phase1"));
                }
                if (this.$["1000GENOMES_phase_1_ASN"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_1", "ASN", "phase1"));
                }
                if (this.$["1000GENOMES_phase_1_AFR"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_1", "AFR", "phase1"));
                }
                if (this.$["1000GENOMES_phase_1_EUR"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_1", "EUR", "phase1"));
                }

                // 1000GENOMES_phase_3
                if (this.$["1000GENOMES_phase_3_ALL"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "ALL", "phase3"));
                }
                if (this.$["1000GENOMES_phase_3_AMR"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "AMR", "phase3"));
                }
                if (this.$["1000GENOMES_phase_3_SAS"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "SAS", "phase3"));
                }
                if (this.$["1000GENOMES_phase_3_EAS"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "EAS", "phase3"));
                }
                if (this.$["1000GENOMES_phase_3_AFR"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "AFR", "phase3"));
                }
                if (this.$["1000GENOMES_phase_3_EUR"].value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "EUR", "phase3"));
                }

                //ESP_6500
                if (this.$["ESP_6500_EA"].value != "") {
                    popFreq.push(this._getPopulationQuery("ESP_6500", "EA", "ESP"));
                }
                if (this.$["ESP_6500_AA"].value != "") {
                    popFreq.push(this._getPopulationQuery("ESP_6500", "AA", "ESP"));
                }

                if (this.$["EXAC_ALL"].value != "") {
                    popFreq.push(this._getPopulationQuery("EXAC", "ALL", "exac"));
                }

                if (popFreq.length > 0) {
                    query['annot-population-maf'] = popFreq.join(";");
                    if (query['annot-population-maf'].indexOf("error") >= 0) {
                        return;
                    }
                }

                query.timeout = 30000;

                this.set('query', query);

                console.log(query);
                // this.search(query);

            },
            _getPopulationQuery: function (study, population, type) {
                var value = parseFloat(this.$[study + "_" + population].value);
                var value_op = this.$[study + "_" + population + "_op"].value;
                value = study + ":" + population + value_op + value;
                return value;
            },
            _setPopulationValue: function (population, value) {
                var aux = value.split("");
                var n = 0;
                var pop = "";
                for (i = 0; i < 5; i++) {
                    if (isNaN(aux[i]) && aux[i] != '.') {
                        pop += aux[i];
                        n++;
                    }
                }
                var val = "";
                if (pop.length == 4) {
                    this.$[population + "_op"].value = aux[3];
                } else if (pop.length == 5) {
                    this.$[population + "_op"].value = aux[3] + aux[4];
                }
                for (var i = n; i < aux.length; i++) {
                    val += aux[i];
                }
                this.$[population].value = val;
            },
            search: function (query) {
                query.sid = Cookies("bioinfo_sid");
                query.skipCount = false;
                query.sort = true;

                //****//
                // var sampleFiles = {};
                // var filesIdAux = [];
                var me = this;
                // var n = 0;
                //
                // for (var i = 0; i < this.samples.length; i++) {
                //     var sample = this.samples[i];
                //     if (sample.status == 'READY') {
                //         if (sampleFiles[sample.source] == null) {
                //             sampleFiles[sample.source] = 1;
                //             n++;
                //         }
                //     }
                // }
                // if (n > 0) {
                var studyId = this.study.id;
                OpencgaManager.studies.files({
                    id: studyId,
                    query: {
                        sid: Cookies('bioinfo_sid'),
                    },
                    request: {
                        async: true,
                        success: function (response) {
                            if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                                debugger
                                // var result = response.response[0].result;
                                // for (var i = 0; i < result.length; i++) {
                                //     if (result[i].type == "FILE") {
                                //         if (sampleFiles[result[i].name] != null && result[i].index != null && result[i].index.status == 'READY') {
                                //             filesIdAux.push(result[i].id);
                                //         }
                                //     }
                                // }
                                // me.set('filesId', filesIdAux);
                            } else {
                                console.log(response.response[0].errorMsg);
                            }
                        },
                        error: function () {
                            console.log('Server error, try again later.');
                        }
                    }
                });
                // }

            }
        });
    </script>
</dom-module>
