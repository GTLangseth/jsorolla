<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<dom-module id="variant-clinical-upload2">
    <template>
        <style is="custom-style" include="jso-styles"></style>

        <div class="col-md-4">
            <h3>Upload and check file v2</h3>
            <br>

            <form class="form-horizontal">
                <template id="{{prefix}}VariableTemplate" is="dom-repeat" items="{{variables}}" as="variable"
                          sort="_sortVariables">
                    <div class="form-group">
                        <template is="dom-if" if="{{checkVarType(variable, 'TEXT',0)}}">
                                <!-- TEXT type: include an input text -->
                            <label for="{{prefix}}{{variable.name}}" class="col-sm-3 control-label">{{variable.name}}</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="{{prefix}}{{variable.name}}" placeholder="Name" pattern="^[A-Za-z]+((\s)?(('|-)?[A-Za-z])+)+$" maxlength="75" >
                            </div>
                        </template>
                        <template is="dom-if" if="{{checkVarType(variable, 'CATEGORICAL',variable.allowedValues.length)}}">
                            <!-- CATEGORICAL type: include radio buttonss two values are contained in variable.allowedValues -->
                            <label class="col-sm-3 control-label">{{variable.name}}</label>
                            <div class="col-sm-9">
                                <div class="form-check form-check-inline">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cellLineOptions" id="a{{variable.name}}"> {{variable.allowedValues}}
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cellLineOptions" id="b{{variable.name}}"> {{variable.allowedValues}}
                                    </label>
                                </div>
                            </div>

                        </template>
                        <template is="dom-if" if="{{checkVarType(variable, 'CATEGORICAL',variable.allowedValues.length)}}">
                            <!-- CATEGORICAL type: include a check box when a single value is contained in in variable.allowedValues -->
                            <label class="col-sm-3 control-label">{{variable.name}}</label>

                            <div class="col-sm-9">
                                <input type="checkbox" name="selectionButtons" id="{{prefix}}{{variable.name}}" style="padding-left: 20px"> {{variable.name}}<br>

                            </div>

                        </template>

                    </div>

                </template>
            </form>
        </div>

    </template>

    <script>
        Polymer({
            is: 'variant-clinical-upload2',
            properties: {
                opencgaClient: {
                    type: Object
                },
                study: {
                    type: Number,
                    observer: 'updateVariableSets'
                },
                config: {
                    type: Object
                },
                prefix: {
                    type: String
                },
                variableSets: {
                    type: Array
                },
                variables: {
                    type: Array,
                    observer: 'variablesChanged'
                }
            },
            ready: function () {
                //console.log(this);
                //debugger;
                if (typeof this.prefix === "undefined" || this.prefix == "") {
                    this.prefix = Utils.randomString(6);
                }
            },
            updateVariableSets: function() {
                this.variables = [];
                let _this = this;
                this.opencgaClient.studies().info(this.study.id, {include: "variableSets"})
                    .then(function (response) {

                        _this.variableSets = response.response[0].result[0].variableSets;
                        if (_this.variableSets.length > 0) {
                            _this.variables = _this.variableSets[0].variables; // setting first one by default
                            _this.filteredVariables = {
                                variableSet: _this.variableSets[0].id,
                                variables: []
                            };
                        } else {
                            _this.variableSets = [{name : "none"}];
                        }
                    })
                    .catch(function () {
                        console.log("Could not obtain the variable sets of the study " + _this.study);
                    });

            },
            _sortVariables: function(a, b) {
                if (a.rank < b.rank) {
                    return -1;
                }
                return 1;
            },
            variablesChanged: function() {
                if (this.variables.length == 0) {
                    this._areVariablesEmpty = true;
                } else {
                    this._areVariablesEmpty = false;
                }
            },
            checkVarType: function (myVar,type,numElements) {
                console.log(this);
                debugger;

                if (myVar.type === type && myVar.allowedValues.length == numElements)
                {
                    return true;

                } else if (myVar.type === type && myVar.allowedValues.length > numElements)
                {
                    return true;

                } else if (myVar.type === type)
                {
                    return true;
                }

            },

        });

    </script>
</dom-module>