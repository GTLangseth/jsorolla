<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel="import" href="opencga-sample-browser.html">

<dom-module id="variant-prioritization-filter">
    <template>
        <style is="custom-style" include="jso-styles">
            select {
                height: 20px;
                width: 45px;
                align-self: center;
            }

            .name {
                font-size: 12px;
                color: #797979;
            }

            .popus {
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
            }

            .custom-sixed-input {
                max-width: 100px;
            }

            span + span {
                margin-left: 10px;
            }

            .variants-display{
                max-height: 700px;
                overflow: auto;
            }
        </style>

        <div>
            <ul id="{{prefix}}FilterTabs" class="nav nav-tabs">
                <li role="presentation" class="active"><a href="#{{prefix}}MainFilter" role="tab" data-toggle="tab">
                    <b>Filter</b></a></li>
                <template is="dom-if" if="{{showVariant}}">
                    <li role="presentation"><a href="#{{prefix}}VariantFilter" role="tab" data-toggle="tab">Variants</a>
                    </li>
                </template>
            </ul>
            <br>
            <div class="tab-content">
                <!--Main Filter-->
                <div role="tabpanel" class="tab-pane fade in active" id="{{prefix}}MainFilter" style="padding: 10px;">
                    <div>
                        <button type="button" class="btn btn-default" on-click="fireFilter">
                            <i class="fa fa-filter" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn btn-default" on-click="fireClear">Clear</button>
                        <button type="button" class="btn btn-default" on-click="fireSearch">Search</button>
                    </div>
                    <br>

                    <div class="panel-group" id="{{prefix}}Accordion" role="tablist" aria-multiselectable="true">
                        <!--Study filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}SampleFilterHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion" href="#{{prefix}}SampleFilter"
                                       aria-expanded="true" aria-controls="{{prefix}}SampleFilter">
                                        Sample Filter
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}SampleFilter" class="panel-collapse collapse in" role="tabpanel"
                                 aria-labelledby="{{prefix}}SampleFilterHeading">
                                <div class="panel-body">
                                    <div>
                                        <!--<template is="dom-repeat" items="{{somaticValues}}">-->
                                        <!--<input type="radio" name="study" value="{{item}}"> {{item}}-->
                                        <!--</template>-->
                                        <h5>Select type of analysis</h5>
                                        <input type="radio" name="type" value="none" on-click="typeSelected" data-id="none" checked="true"> none<br>
                                        <input type="radio" name="type" value="family" on-click="typeSelected" data-id="family"> family<br>
                                        <input type="radio" name="type" value="somatic" on-click="typeSelected" data-id="somatic"> somatic<br>
                                        <input type="radio" name="type" value="case-control" on-click="typeSelected" data-id="case-control"> case-control
                                    </div>
                                    <br>
                                    <button data-toggle="modal" role="button" data-placement="bottom" data-target$="#{{prefix}}SampleBrowser">Sample Browser...
                                    </button>
                                    <br>
                                </div>
                            </div>

                        </div>

                        <!-- Segregation filter -->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}SegregationHeading">
                                <h4 class="panel-title">
                                    <a role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion" href="#{{prefix}}Segregation" aria-expanded="false"
                                       aria-controls="{{prefix}}SegregationHeading">
                                        Segregation
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}Segregation" class="panel-collapse collapse" role="tabpanel" aria-labelledby="{{prefix}}SegregationHeading">
                                <div class="panel-body">
                                    <table class="table table-hover">
                                        <thead>
                                        <tr>
                                            <th>Sample</th>
                                            <th>0/0</th>
                                            <th>0/1</th>
                                            <th>1/1</th>
                                            <th>./.</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <template is="dom-repeat" items="{{samples}}">
                                            <tr id="{{item}}" on-click="sampleGenotypeSelected">
                                                <td>{{item}}</td>
                                                <td><input type="checkbox" value="0/0" data-id="{{item}}"></td>
                                                <td><input type="checkbox" value="0/1" data-id="{{item}}"></td>
                                                <td><input type="checkbox" value="1/1" data-id="{{item}}"></td>
                                                <td><input type="checkbox" value="./." data-id="{{item}}"></td>
                                            </tr>
                                        </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!--Somatic filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}somaticFilterHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion" href="#{{prefix}}SomaticFilter"
                                       aria-expanded="false" aria-controls="{{prefix}}somaticFilter">
                                        Somatic Filter
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}SomaticFilter" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}somaticFilterHeading">
                                <div class="panel-body">
                                    <template is="dom-repeat" items="{{somaticValues}}">
                                        <input type="radio" name="study" value="{{item}}"> {{item}}
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!--Position filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}PositionHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                                       href="#{{prefix}}Position" aria-expanded="false" aria-controls="{{prefix}}Position">
                                        Position
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}Position" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}PositionHeading">
                                <div class="panel-body">
                                    Chromosomal Location:
                                    <textarea id="{{prefix}}LocationTextarea" class="form-control clearable" rows="3" placeholder="3:444-55555, 1:1-1000000"></textarea>
                                    Import from BED:
                                    <button type="button" class="btn btn-xs" on-click="">Import</button>
                                    <br>
                                    <br> Gene or SNPId:
                                    <textarea id="{{prefix}}GeneSnpTextarea" class="form-control clearable" rows="3" placeholder="BRCA2, PPL or rs666, rs9988179"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Variant Type filter -->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}TypeHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion" href="#{{prefix}}Type" aria-expanded="false"
                                       aria-controls="{{prefix}}Type">
                                        Type
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}Type" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}TypeHeading">
                                <div class="panel-body">
                                    <div>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="SNV,SNP"> SNV
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="MNV"> MNV
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="CNV"> CNV
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="SV"> SV
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="INDEL"> INDEL
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Population Frequency filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}PopulationFrequencyHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                                       href="#{{prefix}}PopulationFrequency" aria-expanded="false" aria-controls="{{prefix}}PopulationFrequency">
                                        Population Frequency
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}PopulationFrequency" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}PopulationFrequencyHeading">
                                <div class="panel-body">

                                    <i class="fa fa-angle-double-right minus" on-click="handleCollapseAction"
                                       data-id="{{prefix}}Phase_3"></i>
                                    <label class="popus" on-click="handleCollapseAction" data-id="{{prefix}}Phase_3">1000
                                        Genomes
                                        population phase 3</label>
                                    <div id="{{prefix}}Phase_3" hidden>
                                        <label class="name">All populations MAF [ALL]</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="1000GENOMES_phase_3_ALL_op"
                                                id="{{prefix}}1000GENOMES_phase_3_ALL_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}1000GENOMES_phase_3_ALL"></span>
                                        </div>
                                        <label class="name">American MAF [AMR]</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="1000GENOMES_phase_3_AMR_op"
                                                id="{{prefix}}1000GENOMES_phase_3_AMR_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}1000GENOMES_phase_3_AMR"></span>
                                        </div>
                                        <label class="name">South Asian MAF [SAS]</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="1000GENOMES_phase_3_SAS_op"
                                                id="{{prefix}}1000GENOMES_phase_3_SAS_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}1000GENOMES_phase_3_SAS"></span>
                                        </div>
                                        <label class="name">East Asian MAF [EAS]</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="1000GENOMES_phase_3_EAS_op"
                                                id="{{prefix}}1000GENOMES_phase_3_EAS_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}1000GENOMES_phase_3_EAS"></span>
                                        </div>
                                        <label class="name">African MAF [AFR]</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="1000GENOMES_phase_3_AFR_op"
                                                id="{{prefix}}1000GENOMES_phase_3_AFR_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}1000GENOMES_phase_3_AFR"></span>
                                        </div>
                                        <label class="name">European MAF [EUR]</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="1000GENOMES_phase_3_EUR_op"
                                                id="{{prefix}}1000GENOMES_phase_3_EUR_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}1000GENOMES_phase_3_EUR"></span>
                                        </div>
                                    </div>

                                    <br>
                                    <i class="fa fa-angle-double-right minus" on-click="handleCollapseAction" data-id="{{prefix}}Esp_6500"></i>
                                    <label class="popus" on-click="handleCollapseAction" data-id="{{prefix}}Esp_6500">ESP
                                        6500</label>
                                    <div id="{{prefix}}Esp_6500" hidden>
                                        <label class="name">European american MAF</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="ESP_6500_EA_op" id="{{prefix}}ESP_6500_EA_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input"
                                                         id="{{prefix}}ESP_6500_EA"></span>
                                        </div>
                                        <label class="name">African american MAF</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="ESP_6500_AA_op" id="{{prefix}}ESP_6500_AA_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input"
                                                         id="{{prefix}}ESP_6500_AA"></span>

                                        </div>
                                    </div>

                                    <br>
                                    <i class="fa fa-angle-double-right minus" on-click="handleCollapseAction"
                                       data-id="{{prefix}}Exac"></i>
                                    <label class="popus" on-click="handleCollapseAction"
                                           data-id="{{prefix}}Exac">EXAC</label>
                                    <div id="{{prefix}}Exac" hidden>
                                        <label class="name">EXAC MAF</label>
                                        <div class="horizontal layout">
                                            <span>MAF</span>
                                            <span>
                                        <select name="EXAC_ALL_op" id="{{prefix}}EXAC_ALL_op">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                            <span><input type="text" value="" class="custom-sixed-input"
                                                         id="{{prefix}}EXAC_ALL"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Protein Substitution Scores filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}}ProteinSubstitutionScoreHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion" href="#{{prefix}}ProteinSubstitutionScore"
                                       aria-expanded="false" aria-controls="{{prefix}}ProteinSubstitutionScore">
                                        Protein Substitution Score
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}ProteinSubstitutionScore" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}ProteinSubstitutionScoreHeading">
                                <div class="panel-body">
                                    <div class="horizontal layout">
                                        <span>SIFT</span>
                                        <span>
                                        <select name="siftOperator" id="{{prefix}}SiftOperator">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                        <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}SiftInput"></span>
                                    </div>
                                    <br>
                                    <div class="horizontal layout">
                                        <span>Polyphen</span>
                                        <span>
                                        <select name="polyphenOperator" id="{{prefix}}PolyphenOperator">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                        <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}PolyphenInput"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Conservation Scores filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}conservationFilterHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                                       href="#{{prefix}}ConservationFilter" aria-expanded="false" aria-controls="{{prefix}}ConservationFilter">
                                        Conservation
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}ConservationFilter" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}conservationFilterHeading">
                                <div class="panel-body">
                                    <div class="horizontal layout">
                                        <span>PhyloP</span>
                                        <span>
                                        <select name="phylopOperator" id="{{prefix}}PhylopOperator">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                        <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}PhylopInput"></span>
                                    </div>
                                    <br>
                                    <div class="horizontal layout">
                                        <span>PhastCons</span>
                                        <span>
                                        <select name="phastconsOperator" id="{{prefix}}PhastconsOperator">
                                            <option value="<" selected><</option>
                                            <option value="<="><=</option>
                                            <option value=">">></option>
                                            <option value=">=">>=</option>
                                        </select>
                                    </span>
                                        <span><input type="text" value="" class="custom-sixed-input" id="{{prefix}}PhastconsInput"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Consequence Type filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}ConsequenceTypeHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                                       href="#{{prefix}}ConsequenceType" aria-expanded="false" aria-controls="{{prefix}}ConsequenceType">
                                        Consequence Type
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}ConsequenceType" class="panel-collapse collapse" role="tabpanel" aria-labelledby="{{prefix}}consequenceTypeHeading">
                                <div class="panel-body">
                                    Consequence Type
                                </div>
                            </div>
                        </div>

                        <!-- Gene Ontology filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}GeneOntologyHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                                       href="#{{prefix}}GeneOntology" aria-expanded="false" aria-controls="{{prefix}}GeneOntology">
                                        Gene Ontology
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}GeneOntology" class="panel-collapse collapse" role="tabpanel" aria-labelledby="{{prefix}}GeneOntologyHeading">
                                <div class="panel-body">
                                    <textarea id="{{prefix}}bierAppGeneOntologyTextarea" class="form-control clearable" rows="3" placeholder="GO:0000001, GO:0001177"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Human Phenotype Ontology filter-->
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{prefix}}HumanPhenotypeOntologyHeading">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion" href="#{{prefix}}HumanPhenotypeOntology" aria-expanded="false" aria-controls="{{prefix}}HumanPhenotypeOntology">
                                        Human Phenotype Ontology
                                    </a>
                                </h4>
                            </div>
                            <div id="{{prefix}}HumanPhenotypeOntology" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="{{prefix}}HumanPhenotypeOntologyHeading">
                                <div class="panel-body">
                                    <textarea id="{{prefix}}bierAppHumanPhenotypeOntologyTextarea" class="form-control clearable" rows="3" placeholder="HP:0000001, HP:3000079"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <template is="dom-if" if="{{showVariant}}">
                    <div role="tabpanel" class="tab-pane fade variants-display" id="{{prefix}}VariantFilter">
                        <template is="dom-repeat" items="{{variantList}}">
                            <div>
                                <b on-click="_updateVariant" id="{{item.chromosome}}:{{item.start}}:{{item.reference}}:{{item.alternate}}" style="cursor: pointer">
                                    {{item.chromosome}}:{{item.start}}:{{item.reference}}:{{item.alternate}}</b><br>
                                {{item.id}}
                                <hr>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
        <!-- Modal dialog for Sample Browser -->
        <div class="modal fade" id="{{prefix}}SampleBrowser" tabindex="-1" role="dialog"
             aria-labelledby="sampleBrowserLabel">
            <div class="modal-dialog modal-lg" role="document" style="width: 1024px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="{{prefix}}SampleBrowserLabel">Sample Browser</h4>
                    </div>
                    <div class="modal-body">
                        <opencga-sample-browser opencga-client="{{opencgaClient}}" study="{{study.id}}" samples="{{samples}}" prefix="{{prefix}}"></opencga-sample-browser>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'variant-prioritization-filter',
            properties: {
                study: {
                    type: Object
                },
                opencgaClient: {
                    type: Object
                },
                query: {
                    type: Object,
                    notify: true,
                    value: function () {
                        return {};
                    }
                },
                type: {
                    type: String,
                    notify: true
                },
                samples: {
                    type: Array,
                    value: [],
                    notify: true,
                    observer: "sampleChanged"
                },
                sampleGenotypes: {
                    type: String,
                    value: "",
                    notify: true
                },
                cellbaseClient: {
                    type: Object
                },
                populationFreq: {
                    type: String,
                    value: "",
                    notify: true
                },
                sift: {
                    type: String,
                    value: "",
                    notify: true
                },
                polyphen: {
                    type: String,
                    value: "",
                    notify: true
                },
                conservation: {
                    type: String,
                    value: "",
                    notify: true
                },
                prefix: {
                    type: String
                },
                variantList: {
                    type: Array
                },
                variant: {
                    type: String,
                    notify: true
                },
                changeToDefault: {
                    type: String,
                    observer: "changeToFilterTab"
                },
                changeVariantTab: {
                    type: String,
                    observer: "changeToVariantTab"
                }
            },
            ready: function () {
                this.sampleGenotypesObj = {};

                if (typeof this.prefix === "undefined" || this.prefix == "") {
                    this.prefix = Utils.randomString(6);
                }
            },
            typeSelected: function (e) {
                if (typeof e.target === "undefined") {
                    this.type = e;
                } else {
                    this.type = e.target.defaultValue;
                }
                console.log("type:", this.type);
            },
            _updateVariant: function (e) {
                this.variant = e.srcElement.id;
            },
            changeToVariantTab: function (neo, old) {
                this.showVariant = true;
                $('.nav-tabs a[href="#' + this.prefix + 'VariantFilter"]').tab('show');
            },
            changeToFilterTab: function (neo, old) {
                this.showVariant = false;
                $('.nav-tabs a[href="#' + this.prefix + 'MainFilter"]').tab('show');
            },
            sampleGenotypeSelected: function (e) {
                if (typeof e !== "undefined") {
                    if (typeof this.sampleGenotypesObj[e.target.dataId] === "undefined") {
                        this.sampleGenotypesObj[e.target.dataId] = {};
                    }
                    this.sampleGenotypesObj[e.target.dataId][e.target.defaultValue] = e.target.checked;

                    let arr = [];
                    for (let sampleName in this.sampleGenotypesObj) {
                        let gts = [];
                        for (let sampleGT in this.sampleGenotypesObj[sampleName]) {
                            if (this.sampleGenotypesObj[sampleName][sampleGT] == true) {
                                gts.push(sampleGT);
                                gts.push(sampleGT.replace('/', '|'));
                            }
                        }
                        if (gts.length > 0) {
                            arr.push(sampleName + ':' + gts.join(','));
                        }
                    }
                    this.sampleGenotypes = arr.join(';');
                }
            },
            sampleChanged: function (neo, old) {
              // sample object -- > father, mother, child
//                if (seggretation == "dominant") {
//                    if (father.isAffected) {
//                        switch (true) {
//                            case mother.isAffected && child.isAffected:
//                                // 0/1, 1/1 for all
//                                break;
//                            case !mother.isAffected && child.isAffected:
//                                // father 0/1, 1/1
//                                // mother 0/0
//                                // child 0/1
//                                break;
//                            case mother.isAffected && !child.isAffected:
//                                // father 0/1
//                                // mother 0/1
//                                // child 0/0
//                                break;
//                            case !mother.isAffected && !child.isAffected:
//                                // father 0/1
//                                // mother 0/0
//                                // child 0/0
//                                break;
//                        }
//                    } else if (mother.isAffected) {
//                        switch (true) {
//                            case father.isAffected && child.isAffected:
//                                // 0/1, 1/1 for all
//                                break;
//                            case !father.isAffected && child.isAffected:
//                                // father 0/0
//                                // mother 0/1, 1/1
//                                // child 0/1
//                                break;
//                            case father.isAffected && !child.isAffected:
//                                // father 0/1
//                                // mother 0/1
//                                // child 0/0
//                                break;
//                            case !father.isAffected && !child.isAffected:
//                                // father 0/0
//                                // mother 0/1
//                                // child 0/0
//                                break;
//                        }
//                    }
//
//                }
            },
            handleCollapseAction: function (e) {
                let id = e.srcElement.dataId;
                let elem = $('#' + id)[0];
                elem.hidden = !elem.hidden;
                if (elem.hidden) {
                    elem.css = "fa fa-angle-double-right minus";
                } else {
                    elem.css = "fa fa-angle-double-down minus";
                }
            },
            fireClear: function () {
                // Position
                this.$$("#" + this.prefix + "LocationTextarea").value = "";
                this.$$("#" + this.prefix + "GeneSnpTextarea").value = "";
                // Type
                var types = this.$$("#" + this.prefix + "Type").querySelectorAll("input:checked");
                for (var i = 0; i < types.length; i++) {
                    var type = types[i];
                    type.checked = false;
                }
                // Freqs
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_ALL").value = "";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_ALL_op").value = "<";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_AMR").value = "";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_AMR_op").value = "<";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_SAS").value = "";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_SAS_op").value = "<";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_EAS").value = "";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_EAS_op").value = "<";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_AFR").value = "";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_AFR_op").value = "<";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_EUR").value = "";
                this.$$("#" + this.prefix + "1000GENOMES_phase_3_EUR_op").value = "<";


                this.$$("#" + this.prefix + "ESP_6500_EA").value = "";
                this.$$("#" + this.prefix + "ESP_6500_EA_op").value = "<";
                this.$$("#" + this.prefix + "ESP_6500_AA").value = "";
                this.$$("#" + this.prefix + "ESP_6500_AA_op").value = "<";
                this.$$("#" + this.prefix + "EXAC_ALL").value = "";
                this.$$("#" + this.prefix + "EXAC_ALL_op").value = "<";
                // Protein Substitution scores
                this.$$("#" + this.prefix + "SiftInput").value = "";
                this.$$("#" + this.prefix + "SiftOperator").value = "<";
                this.$$("#" + this.prefix + "PolyphenInput").value = "";
                this.$$("#" + this.prefix + "PolyphenOperator").value = "<";
                // Conservation
                this.$$("#" + this.prefix + "PhylopInput").value = "";
                this.$$("#" + this.prefix + "PhylopOperator").value = "<";
                this.$$("#" + this.prefix + "PhastconsInput").value = "";
                this.$$("#" + this.prefix + "PhastconsOperator").value = "<";
                // TODO add consequence type
                this.$$("#" + this.prefix + "GeneOntologyTextarea").value = "";
                this.$$("#" + this.prefix + "HumanPhenotypeOntologyTextarea").value = "";
            },
            fireFilter: function () {

            },
            fireSearch: function () {
                var query = {};

                // Type
                var types = this.$$("#" + this.prefix + "Type").querySelectorAll("input:checked");
                var typesAux = [];
                if (types != "") {
                    for (var i = 0; i < types.length; i++) {
                        typesAux.push(types[i].value);
                    }
                    query["type"] = typesAux;
                }

                // Population Frequencies
                // Population minor allele frequency: {study}:{population}[<|>|<=|>=]{number}
                var popFreq = [];

                // 1000GENOMES_phase_3
                if (this.$$("#" + this.prefix + "1000GENOMES_phase_3_ALL").value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "ALL", "phase3"));
                }
                if (this.$$("#" + this.prefix + "1000GENOMES_phase_3_AMR").value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "AMR", "phase3"));
                }
                if (this.$$("#" + this.prefix + "1000GENOMES_phase_3_SAS").value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "SAS", "phase3"));
                }
                if (this.$$("#" + this.prefix + "1000GENOMES_phase_3_EAS").value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "EAS", "phase3"));
                }
                if (this.$$("#" + this.prefix + "1000GENOMES_phase_3_AFR").value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "AFR", "phase3"));
                }
                if (this.$$("#" + this.prefix + "1000GENOMES_phase_3_EUR").value != "") {
                    popFreq.push(this._getPopulationQuery("1000GENOMES_phase_3", "EUR", "phase3"));
                }

                //ESP_6500
                if (this.$$("#" + this.prefix + "ESP_6500_EA").value != "") {
                    popFreq.push(this._getPopulationQuery("ESP_6500", "EA", "ESP"));
                }
                if (this.$$("#" + this.prefix + "ESP_6500_AA").value != "") {
                    popFreq.push(this._getPopulationQuery("ESP_6500", "AA", "ESP"));
                }

                if (this.$$("#" + this.prefix + "EXAC_ALL").value != "") {
                    popFreq.push(this._getPopulationQuery("EXAC", "ALL", "exac"));
                }

                if (popFreq.length > 0) {
                    query['annot-population-maf'] = popFreq.join(";");
                    if (query['annot-population-maf'].indexOf("error") >= 0) {
                        return;
                    }
                }

                this.populationFreq = popFreq.join(';');

                // Protein Substitution scores
                var sift;
                var polyphen;
                if (this.$$("#" + this.prefix + "SiftInput").value != "") {
                    sift = this.$$("#" + this.prefix + "SiftOperator").value + this.$$("#" + this.prefix + "SiftInput").value;
                }
                this.sift = sift;
                if (this.$$("#" + this.prefix + "PolyphenInput").value != "") {
                    polyphen = this.$$("#" + this.prefix + "PolyphenOperator").value + this.$$("#" + this.prefix + "PolyphenInput").value;
                }
                this.polyphen = polyphen;

                // Conservation
                var conserArr = [];
                if (this.$$("#" + this.prefix + "PhylopInput").value != "") {
                    let phylop = "phylop" + this.$$("#" + this.prefix + "PhylopOperator").value + this.$$("#" + this.prefix + "PhylopInput").value;
                    conserArr.push(phylop);
                }
                if (this.$$("#" + this.prefix + "PhastconsInput").value != "") {
                    let phastCons = "phastCons" + this.$$("#" + this.prefix + "PhastconsOperator").value + this.$$("#" + this.prefix + "PhastconsInput").value;
                    conserArr.push(phastCons);
                }
                this.conservation = conserArr.join(',');

                query.timeout = 30000;

                this.set('query', query);

                console.log(query);
                // this.search(query);

            },
            _getPopulationQuery: function (study, population, type) {
                var value = parseFloat(this.$$("#" + this.prefix + study + "_" + population).value);
                var value_op = this.$$("#" + this.prefix + study + "_" + population + "_op").value;
                value = study + ":" + population + value_op + value;
                return value;
            },
            _setPopulationValue: function (population, value) {
                var aux = value.split("");
                var n = 0;
                var pop = "";
                for (i = 0; i < 5; i++) {
                    if (isNaN(aux[i]) && aux[i] != '.') {
                        pop += aux[i];
                        n++;
                    }
                }
                var val = "";
                if (pop.length == 4) {
                    this.$$("#" + this.prefix + population + "_op").value = aux[3];
                } else if (pop.length == 5) {
                    this.$$("#" + this.prefix + population + "_op").value = aux[3] + aux[4];
                }
                for (var i = n; i < aux.length; i++) {
                    val += aux[i];
                }
                this.$$("#" + this.prefix + population).value = val;
            },
            search: function (query) {
                query.sid = Cookies("bioinfo_sid");
                query.skipCount = false;
                query.sort = true;

                //****//
                // var sampleFiles = {};
                // var filesIdAux = [];
                var me = this;
                // var n = 0;
                //
                // for (var i = 0; i < this.samples.length; i++) {
                //     var sample = this.samples[i];
                //     if (sample.status == 'READY') {
                //         if (sampleFiles[sample.source] == null) {
                //             sampleFiles[sample.source] = 1;
                //             n++;
                //         }
                //     }
                // }
                // if (n > 0) {
                var studyId = this.study.id;
                OpencgaManager.studies.files({
                    id: studyId,
                    query: {
                        sid: Cookies('bioinfo_sid'),
                    },
                    request: {
                        async: true,
                        success: function (response) {
                            if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                                debugger
                                // var result = response.response[0].result;
                                // for (var i = 0; i < result.length; i++) {
                                //     if (result[i].type == "FILE") {
                                //         if (sampleFiles[result[i].name] != null && result[i].index != null && result[i].index.status == 'READY') {
                                //             filesIdAux.push(result[i].id);
                                //         }
                                //     }
                                // }
                                // me.set('filesId', filesIdAux);
                            } else {
                                console.log(response.response[0].errorMsg);
                            }
                        },
                        error: function () {
                            console.log('Server error, try again later.');
                        }
                    }
                });
                // }

            }
        });
    </script>
</dom-module>
