<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel="import" href="variant-browser-grid.html">
<link rel="import" href="../../cellbase/variation/cellbase-variantannotation-view.html">
<link rel="import" href="../../cellbase/genome-context.html">

<dom-module id="variant-prioritization-view">
    <template>
        <style is="custom-style" include="jso-styles"></style>
        <style>
            .nav-pills > .highlight {
                background: whitesmoke;
            }

            .variant-menu-link:hover {
                cursor: pointer;
                background-color: #EEEEEE;
                text-decoration: none;
            }
        </style>

        <div>

            <div>
                <template is="dom-if" if="{{study.name != ''}}">
                    <h2>{{title}}</h2>
                </template>

                <template is="dom-if" if="{{!resultsViewActive}}">
                    <div class="btn-group" role="group" aria-label="...">
                        <button id="{{prefix}}Results" type="button" class="btn btn-primary" on-click="_triggerChange">Back to Results</button>
                    </div>
                </template>

                <div style="float: right" aria-label="...">
                    <span>
                        <!--<i class="fa fa-area-chart"></i>-->
                        <i class="fa fa-credit-card"></i>
                        <a id="{{prefix}}GenomeContext" class="variant-menu-link" on-click="_triggerChange">GENOME CONTEXT</a>
                    </span>
                    <span>&nbsp;</span>
                    <span>
                        <i class="fa fa-search-plus"></i>
                        <a id="{{prefix}}Annotation" class="variant-menu-link" on-click="_triggerChange">ADVANCED ANNOTATION</a>
                    </span>
                    <span>&nbsp;</span>
                    <span>
                        <i class="fa fa-file-text-o"></i>
                        <a id="{{prefix}}Files" class="variant-menu-link" on-click="_triggerChange">FILE INFO</a>
                    </span>
                    <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                    <span>
                        <i class="fa fa-user-md"></i>
                        <a id="{{prefix}}Family" class="variant-menu-link" on-click="_triggerChange">FAMILY DATA</a>
                    </span>
                    <span>&nbsp;</span>
                    <span>
                        <i class="fa fa-save"></i>
                        <a id="{{prefix}}Save" class="variant-menu-link" on-click="_triggerChange">SAVE</a>
                    </span>
                    <!--<button id="{{prefix}}GenomeContext" type="button" class="btn btn-default" on-click="_triggerChange">Genome Context</button>-->
                    <!--<button id="{{prefix}}Annotation" type="button" class="btn btn-default" on-click="_triggerChange">Advance Annotation</button>-->
                    <!--<button id="{{prefix}}Files" type="button" class="btn btn-default" on-click="_triggerChange">File Info</button>-->
                    <!--<button id="{{prefix}}SampleComparator" type="button" class="btn btn-default" on-click="_triggerChange">Clinical Data</button>-->
                    <!--<button id="{{prefix}}Save" type="button" class="btn btn-default" on-click="_triggerChange">Save</button>-->
                </div>



                <!-- CONTENT -->
                <br>
                <div class="">
                    <div class$="{{prefix}}Content" id="{{prefix}}ResultsDiv">
                        <h3>Variant result</h3>

                        <!-- Variant Browser Grid -->
                        <div style="padding: 10px;">
                            <variant-browser-grid mode="{{mode}}" study="{{study}}" project="{{project}}" prefix="{{prefix}}" opencga-client="{{opencgaClient}}"
                                                  cellbase-client="{{cellbaseClient}}" population-frequencies="{{populationFrequencies}}"
                                                  samples="{{samples}}" protein-substitution-scores="{{proteinSubstitutionScores}}"
                                                  query="{{query}}" variant="{{variant}}" on-selected="selectedGene"></variant-browser-grid>
                        </div>
                    </div>

                    <div class$="{{prefix}}Content" id="{{prefix}}GenomeContextDiv" style="display: none">
                        <br><h3>Genome context for {{variant}}</h3><br>
                        <!--<genome-context></genome-context>-->
                        No yet
                    </div>

                    <!--Annotation Tab-->
                    <div class$="{{prefix}}Content" id="{{prefix}}AnnotationDiv"  style="display: none">
                        <br><h3>Variant annotation for {{variant}}</h3><br>
                        <cellbase-variantannotation-view data="{{variant}}" prefix="{{prefix}}" cellbase-client="{{cellbaseClient}}" mode="horizontal"></cellbase-variantannotation-view>
                    </div>

                    <!--Files Tab-->
                    <div class$="{{prefix}}Content" id="{{prefix}}FilesDiv" style="display: none">
                        Files
                    </div>

                    <!--Sample comparator-->
                    <div class$="{{prefix}}Content" id="{{prefix}}SampleComparatorDiv" style="display: none">
                        Sample Comparator
                    </div>
                </div>



                <!--<ul id="{{prefix}}ViewTabs" class="nav nav-pills" style="float: right" role="tablist">-->
                <!--<li role="presentation" class="active highlight" on-click="_triggerChange"><a href="#{{prefix}}BrowserTable" role="tab" data-toggle="tab">-->
                <!--<b>Results</b></a>-->
                <!--</li>-->
                <!--<li role="presentation"><a href="#{{prefix}}GenomeView" role="tab" data-toggle="tab">Genome Context</a></li>-->
                <!--<li role="presentation" on-click="_triggerChangeVariantTab"><a href="#{{prefix}}Annotation" role="tab" data-toggle="tab">Annotation</a></li>-->
                <!--<li role="presentation"><a href="#{{prefix}}Files" role="tab" data-toggle="tab">Files</a></li>-->
                <!--<li role="presentation"><a href="#{{prefix}}SampleComparator" role="tab" data-toggle="tab">Sample Comparator</a></li>-->
                <!--</ul>-->

                <!--<div class="tab-content">-->
                <!--&lt;!&ndash;Results Table&ndash;&gt;-->
                <!--<div role="tabpanel" class="tab-pane fade in active" id="{{prefix}}BrowserTable" style="padding: 10px;">-->
                <!--<br>-->
                <!--<table id="{{prefix}}VariantBrowserGrid" data-search="true" data-show-columns="true" data-pagination="true" data-page-list="[10, 25, 50]"-->
                <!--data-show-pagination-switch="true" data-show-export="true">-->
                <!--<thead style="background-color: #eee"></thead>-->
                <!--</table>-->
                <!--</div>-->
                <!--&lt;!&ndash;Genome Context Tab&ndash;&gt;-->
                <!--<div role="tabpanel" class="tab-pane fade" id="{{prefix}}GenomeView">-->
                <!--<br>-->
                <!--<genome-context></genome-context>-->
                <!--</div>-->

                <!--&lt;!&ndash;Annotation Tab&ndash;&gt;-->
                <!--<div role="tabpanel" class="tab-pane fade" id="{{prefix}}Annotation">-->
                <!--<br>-->
                <!--<cellbase-variantannotation-view data="{{variant}}" prefix="{{prefix}}" cellbase-client="{{cellbaseClient}}" mode="vertical"></cellbase-variantannotation-view>-->
                <!--</div>-->

                <!--&lt;!&ndash;Files Tab&ndash;&gt;-->
                <!--<div role="tabpanel" class="tab-pane fade" id="{{prefix}}Files">-->
                <!--Files-->
                <!--</div>-->

                <!--&lt;!&ndash;Sample comparator&ndash;&gt;-->
                <!--<div role="tabpanel" class="tab-pane fade" id="{{prefix}}SampleComparator">-->
                <!--Sample Comparator-->
                <!--</div>-->
                <!--</div>-->
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'variant-prioritization-view',
            properties: {
                mode: {
                    type: String
                },
                title: {
                    type: String
                },
                project: {
                    type: String
                },
                study: {
                    type: Object
                },
                data: {
                    type: Array,
                    value: []
                },
                opencgaClient: {
                    type: Object
                },
                samples: {
                    type: Array
                },
                cellbaseClient: {
                    type: Object
                },
                populationFrequencies: {
                    type: Object
                },
                proteinSubstitutionScores: {
                    type: Object
                },
                query: {
                    type: Object
                },
                prefix: {
                    type: String
                },
                variant: {
                    type: String,
                    value: "No variant selected"
                }
//                variantList: {
//                    type: Array,
//                    value: [],
//                    notify: true
//                },
//                changeToDefault: {
//                    type: String,
//                    notify: true
//                },
//                changeVariantTab: {
//                    type: String,
//                    notify: true
//                }
            },
            ready: function () {

                // To allow more than 'prioritization instance in the same web application we add a prefix to all elements ID
                if (typeof this.prefix === "undefined" || this.prefix == "") {
                    this.prefix = Utils.randomString(6);
                }

                this.resultsViewActive = true;

            },
            _triggerChange: function (e) {
                e.preventDefault(); // prevents the hash change to "#" and allows to manipulate the hash fragment as needed
                $('.' + this.prefix + 'Content').hide(); // hides all content divs
                if (typeof e.srcElement.id !== "undefined") {
                    $('#' + e.srcElement.id + 'Div').show(); // get the href and use it find which div to show
                }

                // Set Results view button visible or hidden
                this.resultsViewActive = (e.srcElement.id == this.prefix + "Results");

                if (e.srcElement.id == (this.prefix + "Annotation")) {
                    this.changeVariantTab = Utils.randomString(6);
                } else {
                    this.changeToDefault = Utils.randomString(6);
                }
            },
            _triggerChangeVariantTab: function (e) {
                this.changeVariantTab = Utils.randomString(6);
            },
            selectedGene: function (e) {
                this.fire('propagate', {gene: e.detail.gene});
            }
        });
    </script>
</dom-module>
