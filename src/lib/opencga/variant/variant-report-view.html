<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->


<dom-module id="variant-report-view">
    <template>
        <style is="custom-style" include="jso-styles">
            label {
                padding-top: 10px;
            }
        </style>

        <br>
        <div id="{{prefix}}reportDiv" class="panel panel-default" style="overflow-y: auto; height:550px;">
            <div class="panel-body">
                <h2 style="margin: 10px 5px 15px 25px">{{title}} Report</h2>
                <div style="float: right; padding: 0px 0px 10px 5px">
                    <span>{{requestDate}}</span>
                </div>
                <br>

                <!-- Analysis Information -->

                <div style="margin: 10px 5px 15px 50px" class="analysis-information" id="{{prefix}}analysisInformationDiv">
                    <h4>Analysis Information</h4>
                    <hr>
                    <div style="margin: 10px 5px 15px 15px" class="analysis-information" id="{{prefix}}analysisInformationDiv">
                        <ul>
                            <div class="form-group row" id="{{prefix}}analysisInformationID">
                                <label for="{{prefix}}analysisID" class="col-xs-2 col-form-label">Analysis ID</label>
                                <div class="col-xs-2">
                                    <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}analysisID" name="analysisID" readonly value="AN-28">
                                </div>
                            </div>
                            <div class="form-group row" id="{{prefix}}analysisInformationResume">
                                <label for="{{prefix}}samplesID" class="col-xs-2 col-form-label">Samples ID</label>
                                <div class="col-xs-2">
                                    <textarea type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}samplesID" name="samplesID" style="resize:none" readonly row="2">"HG00097, HG00098, HG00099"</textarea>
                                </div>
                                <label for="{{prefix}}typeAnalysis" class="col-xs-2 col-form-label">Type of analysis</label>
                                <div class="col-xs-2">
                                    <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}typeAnalysis" name="typeAnalysis" readonly value="Trio">
                                </div>
                                <label for="{{prefix}}dateAnalysis" class="col-xs2 col-form-label">Date</label>
                                <div class="col-xs-2">
                                    <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}dateAnalysis" name="dateAnalysis" readonly value="05/05/2017">
                                </div>
                            </div>

                        </ul>




                    </div>
                    <br>

                </div>

                <div style="margin: 10px 5px 15px 25px" class="sample-information" id="{{prefix}}sampleInformationDiv">
                    <h4>Sample Information</h4>
                    <hr>
                    Some infromation related to the sample or samples. If the anlaysis is related to more than one sample (i.e. a family), then, all fields related to individual and variable
                    set can be included from the case. For the rest of parents, sample IDs can be shown.
                    <br>


                    <!-- Sample information related to individual -->

                    <ul>
                        <div class="form-group row" id="{{prefix}}individualIDDiv">
                            <label for="{{prefix}}IndividualID" class="col-sm-2 col-form-label">Individual ID</label>
                            <div class="col-sm-2">
                                <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}IndividualID" name="individualID" readonly value="NUS2344234">
                            </div>
                        </div>
                        <div class="form-group row" id="{{prefix}}chromosomalGenderDiv">
                            <label for="{{prefix}}ChromosomalGender" class="col-sm-2 col-form-label">Chromosomal Gender</label>
                            <div class="col-sm-2">
                                <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}ChromosomalGender" name="chromosomalGender" readonly value="XX">
                            </div>
                        </div>
                        <div class="form-group row" id="{{prefix}}yearBirthDiv">
                            <label for="{{prefix}}BirthYear" class="col-sm-2 col-form-label">Year of birth</label>
                            <div class="col-sm-2">
                                <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}BirthYear" name="birthYear" readonly value="1982">
                            </div>
                        </div>
                        <div class="form-group row" id="{{prefix}}birthPlaceDiv" hidden>
                            <label for="{{prefix}}BirthPlace" class="col-sm-2 col-form-label">Birth place</label>
                            <div class="col-sm-2">
                                <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}BirthPlace" name="birthPlace" readonly value="Spain">
                            </div>
                        </div>
                        <div class="form-group row" id="{{prefix}}ethnicityDiv">
                            <label for="{{prefix}}Ethnicity" class="col-sm-2 col-form-label">Ethnicity</label>
                            <div class="col-sm-2">
                                <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}Ethnicity" name="ethnicity" readonly value="white mediterranean">
                            </div>
                        </div>
                        <div class="form-group row" id="{{prefix}}HPODiv">
                            <label for="{{prefix}}HPO" class="col-sm-2 col-form-label">HPO</label>
                            <div class="col-sm-3">
                                 <textarea class$="form-control {{prefix}}TextInput" id="{{prefix}}HPO" name="HPO"
                                           readonly rows="2" style="resize:none">"HP:0000947"</textarea>
                            </div>
                        </div>
                        <div class="form-group row" id="{{prefix}}diagnosisDiv">
                            <label for="{{prefix}}Diagnosis" class="col-sm-2 col-form-label">Diagnosis</label>
                            <div class="col-sm-3">
                                 <textarea class$="form-control {{prefix}}TextInput" id="{{prefix}}diagnosis" name="diagnosis"
                                           readonly rows="2" style="resize:none">Disorders of thyroid gland (E00-E07)</textarea>
                            </div>
                        </div>


                        <!-- Sample information related to variable set -->

                        <template id="{{prefix}}VariableTemplate" is="dom-repeat" items="{{variables}}" as="variable" sort="_sortVariables">
                            <div class="form-group row" id="{{prefix}}{{variable.name}}Div">
                                <label for="{{prefix}}{{variable.name}}" class="col-sm-2 col-form-label">{{variable.title}}</label>
                                <div class="col-sm-3">
                                    <input type="text" class$="form-control {{prefix}}TextInput" id="{{prefix}}{{variable.name}}" readonly name="{{variable.name}}">
                                </div>
                            </div>
                        </template>

                    </ul>
                </div>

                <div style="margin: 10px 5px 15px 25px" class="prioritization-information" id="prioritizationInformationDiv">
                    <h4>Prioritization Information</h4>
                    <hr>
                    Information related to prioritization can be included according to left panel, including generic data (number of varaints), variants table and the filter used to
                    generate the table
                    <br>
                    <ul>
                    </ul>
                </div>

                <div style="margin: 10px 5px 15px 25px" class="other-information" id="otherInformationDiv">
                    <h4>Other Information</h4>
                    <hr>
                    A text are can be included to write some conclusions or free text
                    <br>
                    <ul>
                    </ul>
                </div>


            </div>
        </div>


    </template>

    <script>
        Polymer({
            is: 'variant-report-view',
            properties: {
                opencgaClient: {
                    type: Object
                },
                study: {
                    type: Object
                },
                prefix: {
                    type: String
                },
                config: {
                    type: Object
                },
                selection: {
                    type: Array,
                    observer: 'fetchSelection'
                },
                title: {
                    type: String,
                    value: ""
                },
                expReport: {
                    type: Boolean,
                    observer: 'handleExportPDF',
                    notify: true
                },
                variables: {
                    type: Array
                },
                analysisId: {
                    type: Array,
                    observer: 'loadAnalysis'
                }

            },
            ready: function() {
                if (typeof this.prefix === "undefined" || this.prefix == "") {
                    this.prefix = Utils.randomString(6);
                }

                let date = new Date();
                this.requestDate = date.toLocaleString();

            },
            loadAnalysis: function() {
                console.log(this);
                debugger;

                if (typeof this.analysisId !== "undefined") {

                    let petete=3;

                }

                let date = new Date();
                this.requestDate = date.toLocaleString();

            },
            fetchSelection: function () {

                let _numFalseElements = 0;

                if (typeof this.selection !== "undefined") {
                    for (let i = 0; i < this.selection.length; i++) {
                        this.$$("#" + this.prefix + this.selection[i].name + "Div").hidden = !this.selection[i].value;
                        if (this.selection[i].value == false)
                        {_numFalseElements++;}

                    }

                    if (_numFalseElements == this.selection.length)
                    {
                        this.$$("#" + this.prefix + "sampleInformationDiv").hidden = true;
                    }
                    else
                    {
                        this.$$("#" + this.prefix + "sampleInformationDiv").hidden = false;
                    }

                    let _a = 2;

                }



                //$("#"+ this.prefix + "birthYearDiv").show();
                //$('#'+this.prefix + 'birthPlaceDiv')[0].hidden = !$('#'+this.prefix + 'birthPlaceDiv')[0].hidden;

                //this.$[divId].hidden = !this.$[divId].hidden;

            },
            print: function(data) {

                var mywindow = window.open('', '', 'height=1000,width=1000');
                mywindow.document.write('<html><head>');
                /* var styles = document.getElementsByTagName('style');

                 mywindow.document.write('<style>');
                 for (var i = 0; i < styles.length; i++) {
                 mywindow.document.write(styles[i].innerHTML);
                 }
                 mywindow.document.write('</style>');*/

                mywindow.document.write('</head><body>');
                mywindow.document.write(data);
                mywindow.document.write('</body></html>');

                mywindow.document.close(); // necessary for IE >= 10
                mywindow.focus(); // necessary for IE >= 10
                mywindow.print();
                mywindow.close();

            },
            _getTextInfo: function() {
                let elem =  this.$$("#" + this.prefix + "sampleInformationDiv").querySelectorAll("input");
                let reportFields = [];
                for (var i = 0; i < elem.length; i++) {
                    reportFields.push({name: elem[i].name , value: elem[i].value});
                }
                this.reportFields = reportFields;

            },
            handleExportPDF: function(e) {
                console.log(this);
                debugger;
                //this._getTextInfo();
                //this.print($('#' + this.prefix + "report")[0].innerHTML);
                this.print(this.$$('#' + this.prefix + "reportDiv").innerHTML);
                this.expReport = false; // Reset export report button again

            },
            _sortVariables: function (a, b) {
                if (a.rank < b.rank) {
                    return -1;
                }
                return 1;
            },

        });
    </script>
</dom-module>
